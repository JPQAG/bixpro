{"ast":null,"code":"'use strict'; //  ---------------------------------------------------------------------------\n\nconst Exchange = require('./base/Exchange');\n\nconst {\n  AddressPending,\n  AuthenticationError,\n  ExchangeError,\n  NotSupported,\n  PermissionDenied,\n  ArgumentsRequired\n} = require('./base/errors');\n\nconst Precise = require('./base/Precise'); //  ---------------------------------------------------------------------------\n\n\nmodule.exports = class buda extends Exchange {\n  describe() {\n    return this.deepExtend(super.describe(), {\n      'id': 'buda',\n      'name': 'Buda',\n      'countries': ['AR', 'CL', 'CO', 'PE'],\n      'rateLimit': 1000,\n      'version': 'v2',\n      'has': {\n        'cancelOrder': true,\n        'CORS': false,\n        'createDepositAddress': true,\n        'createOrder': true,\n        'fetchBalance': true,\n        'fetchClosedOrders': true,\n        'fetchCurrencies': true,\n        'fetchDepositAddress': true,\n        'fetchDeposits': true,\n        'fetchFundingFees': true,\n        'fetchMarkets': true,\n        'fetchMyTrades': false,\n        'fetchOHLCV': true,\n        'fetchOpenOrders': true,\n        'fetchOrder': true,\n        'fetchOrderBook': true,\n        'fetchOrders': true,\n        'fetchTrades': true,\n        'fetchTicker': true,\n        'fetchWithdrawals': true,\n        'withdraw': true\n      },\n      'urls': {\n        'logo': 'https://user-images.githubusercontent.com/1294454/47380619-8a029200-d706-11e8-91e0-8a391fe48de3.jpg',\n        'api': 'https://www.buda.com/api',\n        'www': 'https://www.buda.com',\n        'doc': 'https://api.buda.com',\n        'fees': 'https://www.buda.com/comisiones'\n      },\n      'status': {\n        'status': 'error',\n        'updated': undefined,\n        'eta': undefined,\n        'url': undefined\n      },\n      'api': {\n        'public': {\n          'get': ['pairs', 'markets', 'currencies', 'markets/{market}', 'markets/{market}/ticker', 'markets/{market}/volume', 'markets/{market}/order_book', 'markets/{market}/trades', 'currencies/{currency}/fees/deposit', 'currencies/{currency}/fees/withdrawal', 'tv/history'],\n          'post': ['markets/{market}/quotations']\n        },\n        'private': {\n          'get': ['balances', 'balances/{currency}', 'currencies/{currency}/balances', 'orders', 'orders/{id}', 'markets/{market}/orders', 'deposits', 'currencies/{currency}/deposits', 'withdrawals', 'currencies/{currency}/withdrawals', 'currencies/{currency}/receive_addresses', 'currencies/{currency}/receive_addresses/{id}'],\n          'post': ['markets/{market}/orders', 'currencies/{currency}/deposits', 'currencies/{currency}/withdrawals', 'currencies/{currency}/simulated_withdrawals', 'currencies/{currency}/receive_addresses'],\n          'put': ['orders/{id}']\n        }\n      },\n      'timeframes': {\n        '1m': '1',\n        '5m': '5',\n        '30m': '30',\n        '1h': '60',\n        '2h': '120',\n        '1d': 'D',\n        '1w': 'W'\n      },\n      'fees': {\n        'trading': {\n          'tierBased': true,\n          'percentage': true,\n          'taker': 0.008,\n          // 0.8%\n          'maker': 0.004,\n          // 0.4%\n          'tiers': {\n            'taker': [[0, 0.008], // 0.8%\n            [2000, 0.007], // 0.7%\n            [20000, 0.006], // 0.6%\n            [100000, 0.005], // 0.5%\n            [500000, 0.004], // 0.4%\n            [2500000, 0.003], // 0.3%\n            [12500000, 0.002] // 0.2%\n            ],\n            'maker': [[0, 0.004], // 0.4%\n            [2000, 0.0035], // 0.35%\n            [20000, 0.003], // 0.3%\n            [100000, 0.0025], // 0.25%\n            [500000, 0.002], // 0.2%\n            [2500000, 0.0015], // 0.15%\n            [12500000, 0.001] // 0.1%\n            ]\n          }\n        }\n      },\n      'exceptions': {\n        'not_authorized': AuthenticationError,\n        // { message: 'Invalid credentials', code: 'not_authorized' }\n        'forbidden': PermissionDenied,\n        // { message: 'You dont have access to this resource', code: 'forbidden' }\n        'invalid_record': ExchangeError,\n        // { message: 'Validation Failed', code: 'invalid_record', errors: [] }\n        'not_found': ExchangeError,\n        // { message: 'Not found', code: 'not_found' }\n        'parameter_missing': ExchangeError,\n        // { message: 'Parameter missing', code: 'parameter_missing' }\n        'bad_parameter': ExchangeError // { message: 'Bad Parameter format', code: 'bad_parameter' }\n\n      }\n    });\n  }\n\n  async fetchCurrencyInfo(currency, currencies = undefined) {\n    if (!currencies) {\n      const response = await this.publicGetCurrencies();\n      currencies = this.safeValue(response, 'currencies');\n    }\n\n    for (let i = 0; i < currencies.length; i++) {\n      const currencyInfo = currencies[i];\n\n      if (currencyInfo['id'] === currency) {\n        return currencyInfo;\n      }\n    }\n\n    return undefined;\n  }\n\n  async fetchMarkets(params = {}) {\n    const marketsResponse = await this.publicGetMarkets(params);\n    const markets = this.safeValue(marketsResponse, 'markets');\n    const currenciesResponse = await this.publicGetCurrencies();\n    const currencies = this.safeValue(currenciesResponse, 'currencies');\n    const result = [];\n\n    for (let i = 0; i < markets.length; i++) {\n      const market = markets[i];\n      const id = this.safeString(market, 'id');\n      const baseId = this.safeString(market, 'base_currency');\n      const quoteId = this.safeString(market, 'quote_currency');\n      const base = this.safeCurrencyCode(baseId);\n      const quote = this.safeCurrencyCode(quoteId);\n      const baseInfo = await this.fetchCurrencyInfo(baseId, currencies);\n      const quoteInfo = await this.fetchCurrencyInfo(quoteId, currencies);\n      const symbol = base + '/' + quote;\n      const pricePrecisionString = this.safeString(quoteInfo, 'input_decimals');\n      const priceLimit = this.parsePrecision(pricePrecisionString);\n      const precision = {\n        'amount': this.safeInteger(baseInfo, 'input_decimals'),\n        'price': parseInt(pricePrecisionString)\n      };\n      const minimumOrderAmount = this.safeValue(market, 'minimum_order_amount', []);\n      const limits = {\n        'amount': {\n          'min': this.safeNumber(minimumOrderAmount, 0),\n          'max': undefined\n        },\n        'price': {\n          'min': priceLimit,\n          'max': undefined\n        },\n        'cost': {\n          'min': undefined,\n          'max': undefined\n        }\n      };\n      result.push({\n        'id': id,\n        'symbol': symbol,\n        'base': base,\n        'quote': quote,\n        'baseId': baseId,\n        'quoteId': quoteId,\n        'active': true,\n        'precision': precision,\n        'limits': limits,\n        'info': market\n      });\n    }\n\n    return result;\n  }\n\n  async fetchCurrencies(params = {}) {\n    const response = await this.publicGetCurrencies();\n    const currencies = response['currencies'];\n    const result = {};\n\n    for (let i = 0; i < currencies.length; i++) {\n      const currency = currencies[i];\n\n      if (!currency['managed']) {\n        continue;\n      }\n\n      const id = this.safeString(currency, 'id');\n      const code = this.safeCurrencyCode(id);\n      const precision = this.safeNumber(currency, 'input_decimals');\n      const minimum = Math.pow(10, -precision);\n      result[code] = {\n        'id': id,\n        'code': code,\n        'info': currency,\n        'name': undefined,\n        'active': true,\n        'fee': undefined,\n        'precision': precision,\n        'limits': {\n          'amount': {\n            'min': minimum,\n            'max': undefined\n          },\n          'deposit': {\n            'min': parseFloat(currency['deposit_minimum'][0]),\n            'max': undefined\n          },\n          'withdraw': {\n            'min': parseFloat(currency['withdrawal_minimum'][0])\n          }\n        }\n      };\n    }\n\n    return result;\n  }\n\n  async fetchFundingFees(codes = undefined, params = {}) {\n    //  by default it will try load withdrawal fees of all currencies (with separate requests)\n    //  however if you define codes = [ 'ETH', 'BTC' ] in args it will only load those\n    await this.loadMarkets();\n    const withdrawFees = {};\n    const depositFees = {};\n    const info = {};\n\n    if (codes === undefined) {\n      codes = Object.keys(this.currencies);\n    }\n\n    for (let i = 0; i < codes.length; i++) {\n      const code = codes[i];\n      const currency = this.currency(code);\n      const request = {\n        'currency': currency['id']\n      };\n      const withdrawResponse = await this.publicGetCurrenciesCurrencyFeesWithdrawal(request);\n      const depositResponse = await this.publicGetCurrenciesCurrencyFeesDeposit(request);\n      withdrawFees[code] = this.parseFundingFee(withdrawResponse['fee']);\n      depositFees[code] = this.parseFundingFee(depositResponse['fee']);\n      info[code] = {\n        'withdraw': withdrawResponse,\n        'deposit': depositResponse\n      };\n    }\n\n    return {\n      'withdraw': withdrawFees,\n      'deposit': depositFees,\n      'info': info\n    };\n  }\n\n  parseFundingFee(fee, type = undefined) {\n    if (type === undefined) {\n      type = fee['name'];\n    }\n\n    if (type === 'withdrawal') {\n      type = 'withdraw';\n    }\n\n    return {\n      'type': type,\n      'currency': fee['base'][1],\n      'rate': fee['percent'],\n      'cost': parseFloat(fee['base'][0])\n    };\n  }\n\n  async fetchTicker(symbol, params = {}) {\n    await this.loadMarkets();\n    const market = this.market(symbol);\n    const request = {\n      'market': market['id']\n    };\n    const response = await this.publicGetMarketsMarketTicker(this.extend(request, params));\n    const ticker = this.safeValue(response, 'ticker');\n    return this.parseTicker(ticker, market);\n  }\n\n  parseTicker(ticker, market = undefined) {\n    const timestamp = this.milliseconds();\n    let symbol = undefined;\n\n    if (market !== undefined) {\n      symbol = market['symbol'];\n    }\n\n    const last = parseFloat(ticker['last_price'][0]);\n    const percentage = parseFloat(ticker['price_variation_24h']);\n    const open = parseFloat(this.priceToPrecision(symbol, last / (percentage + 1)));\n    const change = last - open;\n    const average = this.sum(last, open) / 2;\n    return {\n      'symbol': symbol,\n      'timestamp': timestamp,\n      'datetime': this.iso8601(timestamp),\n      'high': undefined,\n      'low': undefined,\n      'bid': parseFloat(ticker['max_bid'][0]),\n      'bidVolume': undefined,\n      'ask': parseFloat(ticker['min_ask'][0]),\n      'askVolume': undefined,\n      'vwap': undefined,\n      'open': open,\n      'close': last,\n      'last': last,\n      'previousClose': open,\n      'change': change,\n      'percentage': percentage * 100,\n      'average': average,\n      'baseVolume': parseFloat(ticker['volume'][0]),\n      'quoteVolume': undefined,\n      'info': ticker\n    };\n  }\n\n  async fetchTrades(symbol, since = undefined, limit = undefined, params = {}) {\n    await this.loadMarkets();\n    const market = this.market(symbol);\n    const request = {\n      'market': market['id']\n    }; // the since argument works backwards – returns trades up to the specified timestamp\n    // therefore not implemented here\n    // the method is still available for users to be able to traverse backwards in time\n    // by using the timestamp from the first received trade upon each iteration\n\n    if (limit !== undefined) {\n      request['limit'] = limit; // 50 max\n    }\n\n    const response = await this.publicGetMarketsMarketTrades(this.extend(request, params)); //\n    //     { trades: {      market_id:   \"ETH-BTC\",\n    //                      timestamp:    null,\n    //                 last_timestamp:   \"1536901277302\",\n    //                        entries: [ [ \"1540077456791\", \"0.0063767\", \"0.03\", \"sell\", 479842 ],\n    //                                   [ \"1539916642772\", \"0.01888263\", \"0.03019563\", \"sell\", 479438 ],\n    //                                   [ \"1539834081787\", \"0.023718648\", \"0.031001\", \"sell\", 479069 ],\n    //                                   ... ]\n    //\n\n    return this.parseTrades(response['trades']['entries'], market, since, limit);\n  }\n\n  parseTrade(trade, market = undefined) {\n    //\n    // fetchTrades (public)\n    //  [ \"1540077456791\", \"0.0063767\", \"0.03\", \"sell\", 479842 ]\n    //\n    let timestamp = undefined;\n    let side = undefined;\n    const type = undefined;\n    let priceString = undefined;\n    let amountString = undefined;\n    let id = undefined;\n    const order = undefined;\n    const fee = undefined;\n    let symbol = undefined;\n\n    if (market) {\n      symbol = market['symbol'];\n    }\n\n    if (Array.isArray(trade)) {\n      timestamp = this.safeInteger(trade, 0);\n      priceString = this.safeString(trade, 1);\n      amountString = this.safeString(trade, 2);\n      side = this.safeString(trade, 3);\n      id = this.safeString(trade, 4);\n    }\n\n    const price = this.parseNumber(priceString);\n    const amount = this.parseNumber(amountString);\n    const cost = this.parseNumber(Precise.stringMul(priceString, amountString));\n    return {\n      'id': id,\n      'order': order,\n      'info': trade,\n      'timestamp': timestamp,\n      'datetime': this.iso8601(timestamp),\n      'symbol': symbol,\n      'type': type,\n      'side': side,\n      'takerOrMaker': undefined,\n      'price': price,\n      'amount': amount,\n      'cost': cost,\n      'fee': fee\n    };\n  }\n\n  async fetchOrderBook(symbol, limit = undefined, params = {}) {\n    await this.loadMarkets();\n    const market = this.market(symbol);\n    const request = {\n      'market': market['id']\n    };\n    const response = await this.publicGetMarketsMarketOrderBook(this.extend(request, params));\n    const orderbook = this.safeValue(response, 'order_book');\n    return this.parseOrderBook(orderbook, symbol);\n  }\n\n  async fetchOHLCV(symbol, timeframe = '1m', since = undefined, limit = undefined, params = {}) {\n    await this.loadMarkets();\n    const market = this.market(symbol);\n\n    if (since === undefined) {\n      since = this.milliseconds() - 86400000;\n    }\n\n    const request = {\n      'symbol': market['id'],\n      'resolution': this.timeframes[timeframe],\n      'from': since / 1000,\n      'to': this.seconds()\n    };\n    const response = await this.publicGetTvHistory(this.extend(request, params));\n    return this.parseTradingViewOHLCV(response, market, timeframe, since, limit);\n  }\n\n  async fetchBalance(params = {}) {\n    await this.loadMarkets();\n    const response = await this.privateGetBalances(params);\n    const result = {\n      'info': response\n    };\n    const balances = this.safeValue(response, 'balances');\n\n    for (let i = 0; i < balances.length; i++) {\n      const balance = balances[i];\n      const currencyId = this.safeString(balance, 'id');\n      const code = this.safeCurrencyCode(currencyId);\n      const account = this.account();\n      account['free'] = this.safeString(balance['available_amount'], 0);\n      account['total'] = this.safeString(balance['amount'], 0);\n      result[code] = account;\n    }\n\n    return this.parseBalance(result, false);\n  }\n\n  async fetchOrder(id, symbol = undefined, params = {}) {\n    await this.loadMarkets();\n    const request = {\n      'id': parseInt(id)\n    };\n    const response = await this.privateGetOrdersId(this.extend(request, params));\n    const order = this.safeValue(response, 'order');\n    return this.parseOrder(order);\n  }\n\n  async fetchOrders(symbol = undefined, since = undefined, limit = undefined, params = {}) {\n    await this.loadMarkets();\n    let market = undefined;\n\n    if (symbol !== undefined) {\n      market = this.market(symbol);\n    }\n\n    const request = {\n      'market': market['id'],\n      'per': limit\n    };\n    const response = await this.privateGetMarketsMarketOrders(this.extend(request, params));\n    const orders = this.safeValue(response, 'orders');\n    return this.parseOrders(orders, market, since, limit);\n  }\n\n  async fetchOpenOrders(symbol = undefined, since = undefined, limit = undefined, params = {}) {\n    const request = {\n      'state': 'pending'\n    };\n    return await this.fetchOrders(symbol, since, limit, this.extend(request, params));\n  }\n\n  async fetchClosedOrders(symbol = undefined, since = undefined, limit = undefined, params = {}) {\n    const request = {\n      'state': 'traded'\n    };\n    return await this.fetchOrders(symbol, since, limit, this.extend(request, params));\n  }\n\n  async createOrder(symbol, type, side, amount, price = undefined, params = {}) {\n    await this.loadMarkets();\n    side = side === 'buy' ? 'Bid' : 'Ask';\n    const request = {\n      'market': this.marketId(symbol),\n      'price_type': type,\n      'type': side,\n      'amount': this.amountToPrecision(symbol, amount)\n    };\n\n    if (type === 'limit') {\n      request['limit'] = this.priceToPrecision(symbol, price);\n    }\n\n    const response = await this.privatePostMarketsMarketOrders(this.extend(request, params));\n    const order = this.safeValue(response, 'order');\n    return this.parseOrder(order);\n  }\n\n  async cancelOrder(id, symbol = undefined, params = {}) {\n    await this.loadMarkets();\n    const request = {\n      'id': parseInt(id),\n      'state': 'canceling'\n    };\n    const response = await this.privatePutOrdersId(this.extend(request, params));\n    const order = this.safeValue(response, 'order');\n    return this.parseOrder(order);\n  }\n\n  parseOrderStatus(status) {\n    const statuses = {\n      'traded': 'closed',\n      'received': 'open',\n      'canceling': 'canceled'\n    };\n    return this.safeString(statuses, status, status);\n  }\n\n  parseOrder(order, market = undefined) {\n    //\n    //     {\n    //         'id': 63679183,\n    //         'uuid': 'f9697bee-627e-4175-983f-0d5a41963fec',\n    //         'market_id': 'ETH-CLP',\n    //         'account_id': 51590,\n    //         'type': 'Ask',\n    //         'state': 'received',\n    //         'created_at': '2021-01-04T08:29:52.730Z',\n    //         'fee_currency': 'CLP',\n    //         'price_type': 'limit',\n    //         'source': None,\n    //         'limit': ['741000.0', 'CLP'],\n    //         'amount': ['0.001', 'ETH'],\n    //         'original_amount': ['0.001', 'ETH'],\n    //         'traded_amount': ['0.0', 'ETH'],\n    //         'total_exchanged': ['0.0', 'CLP'],\n    //         'paid_fee': ['0.0', 'CLP']\n    //     }\n    //\n    const id = this.safeString(order, 'id');\n    const timestamp = this.parse8601(this.safeString(order, 'created_at'));\n    const marketId = this.safeString(order, 'market_id');\n    const symbol = this.safeSymbol(marketId, market, '-');\n    const type = this.safeString(order, 'price_type');\n    const side = this.safeStringLower(order, 'type');\n    const status = this.parseOrderStatus(this.safeString(order, 'state'));\n    const originalAmount = this.safeValue(order, 'original_amount', []);\n    const amount = this.safeNumber(originalAmount, 0);\n    const remainingAmount = this.safeValue(order, 'amount', []);\n    const remaining = this.safeNumber(remainingAmount, 0);\n    const tradedAmount = this.safeValue(order, 'traded_amount', []);\n    const filled = this.safeNumber(tradedAmount, 0);\n    const totalExchanged = this.safeValue(order, 'totalExchanged', []);\n    const cost = this.safeNumber(totalExchanged, 0);\n    const limitPrice = this.safeValue(order, 'limit', []);\n    let price = this.safeNumber(limitPrice, 0);\n\n    if (price === undefined) {\n      if (limitPrice !== undefined) {\n        price = limitPrice;\n      }\n    }\n\n    const paidFee = this.safeValue(order, 'paid_fee', []);\n    const feeCost = this.safeNumber(paidFee, 0);\n    let fee = undefined;\n\n    if (feeCost !== undefined) {\n      const feeCurrencyId = this.safeString(paidFee, 1);\n      const feeCurrencyCode = this.safeCurrencyCode(feeCurrencyId);\n      fee = {\n        'cost': feeCost,\n        'code': feeCurrencyCode\n      };\n    }\n\n    return this.safeOrder({\n      'info': order,\n      'id': id,\n      'clientOrderId': undefined,\n      'datetime': this.iso8601(timestamp),\n      'timestamp': timestamp,\n      'lastTradeTimestamp': undefined,\n      'status': status,\n      'symbol': symbol,\n      'type': type,\n      'timeInForce': undefined,\n      'postOnly': undefined,\n      'side': side,\n      'price': price,\n      'stopPrice': undefined,\n      'average': undefined,\n      'cost': cost,\n      'amount': amount,\n      'filled': filled,\n      'remaining': remaining,\n      'trades': undefined,\n      'fee': fee\n    });\n  }\n\n  isFiat(code) {\n    const fiats = {\n      'ARS': true,\n      'CLP': true,\n      'COP': true,\n      'PEN': true\n    };\n    return this.safeValue(fiats, code, false);\n  }\n\n  async fetchDepositAddress(code, params = {}) {\n    await this.loadMarkets();\n    const currency = this.currency(code);\n\n    if (this.isFiat(code)) {\n      throw new NotSupported(this.id + ' fetchDepositAddress() for fiat ' + code + ' is not supported');\n    }\n\n    const request = {\n      'currency': currency['id']\n    };\n    const response = await this.privateGetCurrenciesCurrencyReceiveAddresses(this.extend(request, params));\n    const receiveAddresses = this.safeValue(response, 'receive_addresses');\n    const addressPool = [];\n\n    for (let i = 1; i < receiveAddresses.length; i++) {\n      const receiveAddress = receiveAddresses[i];\n\n      if (receiveAddress['ready']) {\n        const address = receiveAddress['address'];\n        this.checkAddress(address);\n        addressPool.push(address);\n      }\n    }\n\n    const addressPoolLength = addressPool.length;\n\n    if (addressPoolLength < 1) {\n      throw new AddressPending(this.id + ': there are no addresses ready for receiving ' + code + ', retry again later)');\n    }\n\n    const address = addressPool[0];\n    return {\n      'currency': code,\n      'address': address,\n      'tag': undefined,\n      'info': receiveAddresses\n    };\n  }\n\n  async createDepositAddress(code, params = {}) {\n    await this.loadMarkets();\n    const currency = this.currency(code);\n\n    if (this.isFiat(code)) {\n      throw new NotSupported(this.id + ': fiat fetchDepositAddress() for ' + code + ' is not supported');\n    }\n\n    const request = {\n      'currency': currency['id']\n    };\n    const response = await this.privatePostCurrenciesCurrencyReceiveAddresses(this.extend(request, params));\n    const address = this.safeString(response['receive_address'], 'address'); // the creation is async and returns a null address, returns only the id\n\n    return {\n      'currency': code,\n      'address': address,\n      'tag': undefined,\n      'info': response\n    };\n  }\n\n  parseTransactionStatus(status) {\n    const statuses = {\n      'rejected': 'failed',\n      'confirmed': 'ok',\n      'anulled': 'canceled',\n      'retained': 'canceled',\n      'pending_confirmation': 'pending'\n    };\n    return this.safeString(statuses, status, status);\n  }\n\n  parseTransaction(transaction, currency = undefined) {\n    const id = this.safeString(transaction, 'id');\n    const timestamp = this.parse8601(this.safeString(transaction, 'created_at'));\n    const currencyId = this.safeString(transaction, 'currency');\n    const code = this.safeCurrencyCode(currencyId, currency);\n    const amount = parseFloat(transaction['amount'][0]);\n    const fee = parseFloat(transaction['fee'][0]);\n    const feeCurrency = transaction['fee'][1];\n    const status = this.parseTransactionStatus(this.safeString(transaction, 'state'));\n    const type = 'deposit_data' in transaction ? 'deposit' : 'withdrawal';\n    const data = this.safeValue(transaction, type + '_data', {});\n    const address = this.safeValue(data, 'target_address');\n    const txid = this.safeString(data, 'tx_hash');\n    const updated = this.parse8601(this.safeString(data, 'updated_at'));\n    return {\n      'info': transaction,\n      'id': id,\n      'txid': txid,\n      'timestamp': timestamp,\n      'datetime': this.iso8601(timestamp),\n      'address': address,\n      'type': type,\n      'amount': amount,\n      'currency': code,\n      'status': status,\n      'updated': updated,\n      'fee': {\n        'cost': fee,\n        'rate': feeCurrency\n      }\n    };\n  }\n\n  async fetchDeposits(code = undefined, since = undefined, limit = undefined, params = {}) {\n    await this.loadMarkets();\n\n    if (code === undefined) {\n      throw new ArgumentsRequired(this.id + ': fetchDeposits() requires a currency code argument');\n    }\n\n    const currency = this.currency(code);\n    const request = {\n      'currency': currency['id'],\n      'per': limit\n    };\n    const response = await this.privateGetCurrenciesCurrencyDeposits(this.extend(request, params));\n    const deposits = this.safeValue(response, 'deposits');\n    return this.parseTransactions(deposits, currency, since, limit);\n  }\n\n  async fetchWithdrawals(code = undefined, since = undefined, limit = undefined, params = {}) {\n    await this.loadMarkets();\n\n    if (code === undefined) {\n      throw new ArgumentsRequired(this.id + ': fetchDeposits() requires a currency code argument');\n    }\n\n    const currency = this.currency(code);\n    const request = {\n      'currency': currency['id'],\n      'per': limit\n    };\n    const response = await this.privateGetCurrenciesCurrencyWithdrawals(this.extend(request, params));\n    const withdrawals = this.safeValue(response, 'withdrawals');\n    return this.parseTransactions(withdrawals, currency, since, limit);\n  }\n\n  async withdraw(code, amount, address, tag = undefined, params = {}) {\n    this.checkAddress(address);\n    await this.loadMarkets();\n    const currency = this.currency(code);\n    const request = {\n      'currency': currency['id'],\n      'amount': amount,\n      'withdrawal_data': {\n        'target_address': address\n      }\n    };\n    const response = await this.privatePostCurrenciesCurrencyWithdrawals(this.extend(request, params));\n    const withdrawal = this.safeValue(response, 'withdrawal');\n    return this.parseTransaction(withdrawal);\n  }\n\n  nonce() {\n    return this.microseconds();\n  }\n\n  sign(path, api = 'public', method = 'GET', params = {}, headers = undefined, body = undefined) {\n    let request = this.implodeParams(path, params);\n    const query = this.omit(params, this.extractParams(path));\n\n    if (Object.keys(query).length) {\n      if (method === 'GET') {\n        request += '?' + this.urlencode(query);\n      } else {\n        body = this.json(query);\n      }\n    }\n\n    const url = this.urls['api'] + '/' + this.version + '/' + request;\n\n    if (api === 'private') {\n      this.checkRequiredCredentials();\n      const nonce = this.nonce().toString();\n      const components = [method, '/api/' + this.version + '/' + request];\n\n      if (body) {\n        const base64Body = this.stringToBase64(body);\n        components.push(this.decode(base64Body));\n      }\n\n      components.push(nonce);\n      const message = components.join(' ');\n      const signature = this.hmac(this.encode(message), this.encode(this.secret), 'sha384');\n      headers = {\n        'X-SBTC-APIKEY': this.apiKey,\n        'X-SBTC-SIGNATURE': signature,\n        'X-SBTC-NONCE': nonce,\n        'Content-Type': 'application/json'\n      };\n    }\n\n    return {\n      'url': url,\n      'method': method,\n      'body': body,\n      'headers': headers\n    };\n  }\n\n  handleErrors(code, reason, url, method, headers, body, response, requestHeaders, requestBody) {\n    if (response === undefined) {\n      return; // fallback to default error handler\n    }\n\n    if (code >= 400) {\n      const errorCode = this.safeString(response, 'code');\n      const message = this.safeString(response, 'message', body);\n      const feedback = this.id + ' ' + message;\n\n      if (errorCode !== undefined) {\n        this.throwExactlyMatchedException(this.exceptions, errorCode, feedback);\n        throw new ExchangeError(feedback);\n      }\n    }\n  }\n\n};","map":{"version":3,"sources":["C:/Users/James Price/Documents/VS Code/bixpro/node_modules/ccxt/js/buda.js"],"names":["Exchange","require","AddressPending","AuthenticationError","ExchangeError","NotSupported","PermissionDenied","ArgumentsRequired","Precise","module","exports","buda","describe","deepExtend","undefined","fetchCurrencyInfo","currency","currencies","response","publicGetCurrencies","safeValue","i","length","currencyInfo","fetchMarkets","params","marketsResponse","publicGetMarkets","markets","currenciesResponse","result","market","id","safeString","baseId","quoteId","base","safeCurrencyCode","quote","baseInfo","quoteInfo","symbol","pricePrecisionString","priceLimit","parsePrecision","precision","safeInteger","parseInt","minimumOrderAmount","limits","safeNumber","push","fetchCurrencies","code","minimum","Math","pow","parseFloat","fetchFundingFees","codes","loadMarkets","withdrawFees","depositFees","info","Object","keys","request","withdrawResponse","publicGetCurrenciesCurrencyFeesWithdrawal","depositResponse","publicGetCurrenciesCurrencyFeesDeposit","parseFundingFee","fee","type","fetchTicker","publicGetMarketsMarketTicker","extend","ticker","parseTicker","timestamp","milliseconds","last","percentage","open","priceToPrecision","change","average","sum","iso8601","fetchTrades","since","limit","publicGetMarketsMarketTrades","parseTrades","parseTrade","trade","side","priceString","amountString","order","Array","isArray","price","parseNumber","amount","cost","stringMul","fetchOrderBook","publicGetMarketsMarketOrderBook","orderbook","parseOrderBook","fetchOHLCV","timeframe","timeframes","seconds","publicGetTvHistory","parseTradingViewOHLCV","fetchBalance","privateGetBalances","balances","balance","currencyId","account","parseBalance","fetchOrder","privateGetOrdersId","parseOrder","fetchOrders","privateGetMarketsMarketOrders","orders","parseOrders","fetchOpenOrders","fetchClosedOrders","createOrder","marketId","amountToPrecision","privatePostMarketsMarketOrders","cancelOrder","privatePutOrdersId","parseOrderStatus","status","statuses","parse8601","safeSymbol","safeStringLower","originalAmount","remainingAmount","remaining","tradedAmount","filled","totalExchanged","limitPrice","paidFee","feeCost","feeCurrencyId","feeCurrencyCode","safeOrder","isFiat","fiats","fetchDepositAddress","privateGetCurrenciesCurrencyReceiveAddresses","receiveAddresses","addressPool","receiveAddress","address","checkAddress","addressPoolLength","createDepositAddress","privatePostCurrenciesCurrencyReceiveAddresses","parseTransactionStatus","parseTransaction","transaction","feeCurrency","data","txid","updated","fetchDeposits","privateGetCurrenciesCurrencyDeposits","deposits","parseTransactions","fetchWithdrawals","privateGetCurrenciesCurrencyWithdrawals","withdrawals","withdraw","tag","privatePostCurrenciesCurrencyWithdrawals","withdrawal","nonce","microseconds","sign","path","api","method","headers","body","implodeParams","query","omit","extractParams","urlencode","json","url","urls","version","checkRequiredCredentials","toString","components","base64Body","stringToBase64","decode","message","join","signature","hmac","encode","secret","apiKey","handleErrors","reason","requestHeaders","requestBody","errorCode","feedback","throwExactlyMatchedException","exceptions"],"mappings":"AAAA,a,CAEA;;AAEA,MAAMA,QAAQ,GAAGC,OAAO,CAAE,iBAAF,CAAxB;;AACA,MAAM;AAAEC,EAAAA,cAAF;AAAkBC,EAAAA,mBAAlB;AAAuCC,EAAAA,aAAvC;AAAsDC,EAAAA,YAAtD;AAAoEC,EAAAA,gBAApE;AAAsFC,EAAAA;AAAtF,IAA4GN,OAAO,CAAE,eAAF,CAAzH;;AACA,MAAMO,OAAO,GAAGP,OAAO,CAAE,gBAAF,CAAvB,C,CAEA;;;AAEAQ,MAAM,CAACC,OAAP,GAAiB,MAAMC,IAAN,SAAmBX,QAAnB,CAA4B;AACzCY,EAAAA,QAAQ,GAAI;AACR,WAAO,KAAKC,UAAL,CAAiB,MAAMD,QAAN,EAAjB,EAAoC;AACvC,YAAM,MADiC;AAEvC,cAAQ,MAF+B;AAGvC,mBAAa,CAAE,IAAF,EAAQ,IAAR,EAAc,IAAd,EAAoB,IAApB,CAH0B;AAIvC,mBAAa,IAJ0B;AAKvC,iBAAW,IAL4B;AAMvC,aAAO;AACH,uBAAe,IADZ;AAEH,gBAAQ,KAFL;AAGH,gCAAwB,IAHrB;AAIH,uBAAe,IAJZ;AAKH,wBAAgB,IALb;AAMH,6BAAqB,IANlB;AAOH,2BAAmB,IAPhB;AAQH,+BAAuB,IARpB;AASH,yBAAiB,IATd;AAUH,4BAAoB,IAVjB;AAWH,wBAAgB,IAXb;AAYH,yBAAiB,KAZd;AAaH,sBAAc,IAbX;AAcH,2BAAmB,IAdhB;AAeH,sBAAc,IAfX;AAgBH,0BAAkB,IAhBf;AAiBH,uBAAe,IAjBZ;AAkBH,uBAAe,IAlBZ;AAmBH,uBAAe,IAnBZ;AAoBH,4BAAoB,IApBjB;AAqBH,oBAAY;AArBT,OANgC;AA6BvC,cAAQ;AACJ,gBAAQ,qGADJ;AAEJ,eAAO,0BAFH;AAGJ,eAAO,sBAHH;AAIJ,eAAO,sBAJH;AAKJ,gBAAQ;AALJ,OA7B+B;AAoCvC,gBAAU;AACN,kBAAU,OADJ;AAEN,mBAAWE,SAFL;AAGN,eAAOA,SAHD;AAIN,eAAOA;AAJD,OApC6B;AA0CvC,aAAO;AACH,kBAAU;AACN,iBAAO,CACH,OADG,EAEH,SAFG,EAGH,YAHG,EAIH,kBAJG,EAKH,yBALG,EAMH,yBANG,EAOH,6BAPG,EAQH,yBARG,EASH,oCATG,EAUH,uCAVG,EAWH,YAXG,CADD;AAcN,kBAAQ,CACJ,6BADI;AAdF,SADP;AAmBH,mBAAW;AACP,iBAAO,CACH,UADG,EAEH,qBAFG,EAGH,gCAHG,EAIH,QAJG,EAKH,aALG,EAMH,yBANG,EAOH,UAPG,EAQH,gCARG,EASH,aATG,EAUH,mCAVG,EAWH,yCAXG,EAYH,8CAZG,CADA;AAeP,kBAAQ,CACJ,yBADI,EAEJ,gCAFI,EAGJ,mCAHI,EAIJ,6CAJI,EAKJ,yCALI,CAfD;AAsBP,iBAAO,CACH,aADG;AAtBA;AAnBR,OA1CgC;AAwFvC,oBAAc;AACV,cAAM,GADI;AAEV,cAAM,GAFI;AAGV,eAAO,IAHG;AAIV,cAAM,IAJI;AAKV,cAAM,KALI;AAMV,cAAM,GANI;AAOV,cAAM;AAPI,OAxFyB;AAiGvC,cAAQ;AACJ,mBAAW;AACP,uBAAa,IADN;AAEP,wBAAc,IAFP;AAGP,mBAAS,KAHF;AAGU;AACjB,mBAAS,KAJF;AAIU;AACjB,mBAAS;AACL,qBAAS,CACL,CAAC,CAAD,EAAI,KAAJ,CADK,EACQ;AACb,aAAC,IAAD,EAAO,KAAP,CAFK,EAEW;AAChB,aAAC,KAAD,EAAQ,KAAR,CAHK,EAGY;AACjB,aAAC,MAAD,EAAS,KAAT,CAJK,EAIa;AAClB,aAAC,MAAD,EAAS,KAAT,CALK,EAKa;AAClB,aAAC,OAAD,EAAU,KAAV,CANK,EAMc;AACnB,aAAC,QAAD,EAAW,KAAX,CAPK,CAOe;AAPf,aADJ;AAUL,qBAAS,CACL,CAAC,CAAD,EAAI,KAAJ,CADK,EACQ;AACb,aAAC,IAAD,EAAO,MAAP,CAFK,EAEY;AACjB,aAAC,KAAD,EAAQ,KAAR,CAHK,EAGY;AACjB,aAAC,MAAD,EAAS,MAAT,CAJK,EAIc;AACnB,aAAC,MAAD,EAAS,KAAT,CALK,EAKa;AAClB,aAAC,OAAD,EAAU,MAAV,CANK,EAMe;AACpB,aAAC,QAAD,EAAW,KAAX,CAPK,CAOe;AAPf;AAVJ;AALF;AADP,OAjG+B;AA6HvC,oBAAc;AACV,0BAAkBX,mBADR;AAC8B;AACxC,qBAAaG,gBAFH;AAEsB;AAChC,0BAAkBF,aAHR;AAGwB;AAClC,qBAAaA,aAJH;AAImB;AAC7B,6BAAqBA,aALX;AAK2B;AACrC,yBAAiBA,aANP,CAMuB;;AANvB;AA7HyB,KAApC,CAAP;AAsIH;;AAED,QAAMW,iBAAN,CAAyBC,QAAzB,EAAmCC,UAAU,GAAGH,SAAhD,EAA2D;AACvD,QAAI,CAACG,UAAL,EAAiB;AACb,YAAMC,QAAQ,GAAG,MAAM,KAAKC,mBAAL,EAAvB;AACAF,MAAAA,UAAU,GAAG,KAAKG,SAAL,CAAgBF,QAAhB,EAA0B,YAA1B,CAAb;AACH;;AACD,SAAK,IAAIG,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGJ,UAAU,CAACK,MAA/B,EAAuCD,CAAC,EAAxC,EAA4C;AACxC,YAAME,YAAY,GAAGN,UAAU,CAACI,CAAD,CAA/B;;AACA,UAAIE,YAAY,CAAC,IAAD,CAAZ,KAAuBP,QAA3B,EAAqC;AACjC,eAAOO,YAAP;AACH;AACJ;;AACD,WAAOT,SAAP;AACH;;AAED,QAAMU,YAAN,CAAoBC,MAAM,GAAG,EAA7B,EAAiC;AAC7B,UAAMC,eAAe,GAAG,MAAM,KAAKC,gBAAL,CAAuBF,MAAvB,CAA9B;AACA,UAAMG,OAAO,GAAG,KAAKR,SAAL,CAAgBM,eAAhB,EAAiC,SAAjC,CAAhB;AACA,UAAMG,kBAAkB,GAAG,MAAM,KAAKV,mBAAL,EAAjC;AACA,UAAMF,UAAU,GAAG,KAAKG,SAAL,CAAgBS,kBAAhB,EAAoC,YAApC,CAAnB;AACA,UAAMC,MAAM,GAAG,EAAf;;AACA,SAAK,IAAIT,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGO,OAAO,CAACN,MAA5B,EAAoCD,CAAC,EAArC,EAAyC;AACrC,YAAMU,MAAM,GAAGH,OAAO,CAACP,CAAD,CAAtB;AACA,YAAMW,EAAE,GAAG,KAAKC,UAAL,CAAiBF,MAAjB,EAAyB,IAAzB,CAAX;AACA,YAAMG,MAAM,GAAG,KAAKD,UAAL,CAAiBF,MAAjB,EAAyB,eAAzB,CAAf;AACA,YAAMI,OAAO,GAAG,KAAKF,UAAL,CAAiBF,MAAjB,EAAyB,gBAAzB,CAAhB;AACA,YAAMK,IAAI,GAAG,KAAKC,gBAAL,CAAuBH,MAAvB,CAAb;AACA,YAAMI,KAAK,GAAG,KAAKD,gBAAL,CAAuBF,OAAvB,CAAd;AACA,YAAMI,QAAQ,GAAG,MAAM,KAAKxB,iBAAL,CAAwBmB,MAAxB,EAAgCjB,UAAhC,CAAvB;AACA,YAAMuB,SAAS,GAAG,MAAM,KAAKzB,iBAAL,CAAwBoB,OAAxB,EAAiClB,UAAjC,CAAxB;AACA,YAAMwB,MAAM,GAAGL,IAAI,GAAG,GAAP,GAAaE,KAA5B;AACA,YAAMI,oBAAoB,GAAG,KAAKT,UAAL,CAAiBO,SAAjB,EAA4B,gBAA5B,CAA7B;AACA,YAAMG,UAAU,GAAG,KAAKC,cAAL,CAAqBF,oBAArB,CAAnB;AACA,YAAMG,SAAS,GAAG;AACd,kBAAU,KAAKC,WAAL,CAAkBP,QAAlB,EAA4B,gBAA5B,CADI;AAEd,iBAASQ,QAAQ,CAAEL,oBAAF;AAFH,OAAlB;AAIA,YAAMM,kBAAkB,GAAG,KAAK5B,SAAL,CAAgBW,MAAhB,EAAwB,sBAAxB,EAAgD,EAAhD,CAA3B;AACA,YAAMkB,MAAM,GAAG;AACX,kBAAU;AACN,iBAAO,KAAKC,UAAL,CAAiBF,kBAAjB,EAAqC,CAArC,CADD;AAEN,iBAAOlC;AAFD,SADC;AAKX,iBAAS;AACL,iBAAO6B,UADF;AAEL,iBAAO7B;AAFF,SALE;AASX,gBAAQ;AACJ,iBAAOA,SADH;AAEJ,iBAAOA;AAFH;AATG,OAAf;AAcAgB,MAAAA,MAAM,CAACqB,IAAP,CAAa;AACT,cAAMnB,EADG;AAET,kBAAUS,MAFD;AAGT,gBAAQL,IAHC;AAIT,iBAASE,KAJA;AAKT,kBAAUJ,MALD;AAMT,mBAAWC,OANF;AAOT,kBAAU,IAPD;AAQT,qBAAaU,SARJ;AAST,kBAAUI,MATD;AAUT,gBAAQlB;AAVC,OAAb;AAYH;;AACD,WAAOD,MAAP;AACH;;AAED,QAAMsB,eAAN,CAAuB3B,MAAM,GAAG,EAAhC,EAAoC;AAChC,UAAMP,QAAQ,GAAG,MAAM,KAAKC,mBAAL,EAAvB;AACA,UAAMF,UAAU,GAAGC,QAAQ,CAAC,YAAD,CAA3B;AACA,UAAMY,MAAM,GAAG,EAAf;;AACA,SAAK,IAAIT,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGJ,UAAU,CAACK,MAA/B,EAAuCD,CAAC,EAAxC,EAA4C;AACxC,YAAML,QAAQ,GAAGC,UAAU,CAACI,CAAD,CAA3B;;AACA,UAAI,CAACL,QAAQ,CAAC,SAAD,CAAb,EAA0B;AACtB;AACH;;AACD,YAAMgB,EAAE,GAAG,KAAKC,UAAL,CAAiBjB,QAAjB,EAA2B,IAA3B,CAAX;AACA,YAAMqC,IAAI,GAAG,KAAKhB,gBAAL,CAAuBL,EAAvB,CAAb;AACA,YAAMa,SAAS,GAAG,KAAKK,UAAL,CAAiBlC,QAAjB,EAA2B,gBAA3B,CAAlB;AACA,YAAMsC,OAAO,GAAGC,IAAI,CAACC,GAAL,CAAU,EAAV,EAAc,CAACX,SAAf,CAAhB;AACAf,MAAAA,MAAM,CAACuB,IAAD,CAAN,GAAe;AACX,cAAMrB,EADK;AAEX,gBAAQqB,IAFG;AAGX,gBAAQrC,QAHG;AAIX,gBAAQF,SAJG;AAKX,kBAAU,IALC;AAMX,eAAOA,SANI;AAOX,qBAAa+B,SAPF;AAQX,kBAAU;AACN,oBAAU;AACN,mBAAOS,OADD;AAEN,mBAAOxC;AAFD,WADJ;AAKN,qBAAW;AACP,mBAAO2C,UAAU,CAAEzC,QAAQ,CAAC,iBAAD,CAAR,CAA4B,CAA5B,CAAF,CADV;AAEP,mBAAOF;AAFA,WALL;AASN,sBAAY;AACR,mBAAO2C,UAAU,CAAEzC,QAAQ,CAAC,oBAAD,CAAR,CAA+B,CAA/B,CAAF;AADT;AATN;AARC,OAAf;AAsBH;;AACD,WAAOc,MAAP;AACH;;AAED,QAAM4B,gBAAN,CAAwBC,KAAK,GAAG7C,SAAhC,EAA2CW,MAAM,GAAG,EAApD,EAAwD;AACpD;AACA;AACA,UAAM,KAAKmC,WAAL,EAAN;AACA,UAAMC,YAAY,GAAG,EAArB;AACA,UAAMC,WAAW,GAAG,EAApB;AACA,UAAMC,IAAI,GAAG,EAAb;;AACA,QAAIJ,KAAK,KAAK7C,SAAd,EAAyB;AACrB6C,MAAAA,KAAK,GAAGK,MAAM,CAACC,IAAP,CAAa,KAAKhD,UAAlB,CAAR;AACH;;AACD,SAAK,IAAII,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGsC,KAAK,CAACrC,MAA1B,EAAkCD,CAAC,EAAnC,EAAuC;AACnC,YAAMgC,IAAI,GAAGM,KAAK,CAACtC,CAAD,CAAlB;AACA,YAAML,QAAQ,GAAG,KAAKA,QAAL,CAAeqC,IAAf,CAAjB;AACA,YAAMa,OAAO,GAAG;AAAE,oBAAYlD,QAAQ,CAAC,IAAD;AAAtB,OAAhB;AACA,YAAMmD,gBAAgB,GAAG,MAAM,KAAKC,yCAAL,CAAgDF,OAAhD,CAA/B;AACA,YAAMG,eAAe,GAAG,MAAM,KAAKC,sCAAL,CAA6CJ,OAA7C,CAA9B;AACAL,MAAAA,YAAY,CAACR,IAAD,CAAZ,GAAqB,KAAKkB,eAAL,CAAsBJ,gBAAgB,CAAC,KAAD,CAAtC,CAArB;AACAL,MAAAA,WAAW,CAACT,IAAD,CAAX,GAAoB,KAAKkB,eAAL,CAAsBF,eAAe,CAAC,KAAD,CAArC,CAApB;AACAN,MAAAA,IAAI,CAACV,IAAD,CAAJ,GAAa;AACT,oBAAYc,gBADH;AAET,mBAAWE;AAFF,OAAb;AAIH;;AACD,WAAO;AACH,kBAAYR,YADT;AAEH,iBAAWC,WAFR;AAGH,cAAQC;AAHL,KAAP;AAKH;;AAEDQ,EAAAA,eAAe,CAAEC,GAAF,EAAOC,IAAI,GAAG3D,SAAd,EAAyB;AACpC,QAAI2D,IAAI,KAAK3D,SAAb,EAAwB;AACpB2D,MAAAA,IAAI,GAAGD,GAAG,CAAC,MAAD,CAAV;AACH;;AACD,QAAIC,IAAI,KAAK,YAAb,EAA2B;AACvBA,MAAAA,IAAI,GAAG,UAAP;AACH;;AACD,WAAO;AACH,cAAQA,IADL;AAEH,kBAAYD,GAAG,CAAC,MAAD,CAAH,CAAY,CAAZ,CAFT;AAGH,cAAQA,GAAG,CAAC,SAAD,CAHR;AAIH,cAAQf,UAAU,CAAEe,GAAG,CAAC,MAAD,CAAH,CAAY,CAAZ,CAAF;AAJf,KAAP;AAMH;;AAED,QAAME,WAAN,CAAmBjC,MAAnB,EAA2BhB,MAAM,GAAG,EAApC,EAAwC;AACpC,UAAM,KAAKmC,WAAL,EAAN;AACA,UAAM7B,MAAM,GAAG,KAAKA,MAAL,CAAaU,MAAb,CAAf;AACA,UAAMyB,OAAO,GAAG;AACZ,gBAAUnC,MAAM,CAAC,IAAD;AADJ,KAAhB;AAGA,UAAMb,QAAQ,GAAG,MAAM,KAAKyD,4BAAL,CAAmC,KAAKC,MAAL,CAAaV,OAAb,EAAsBzC,MAAtB,CAAnC,CAAvB;AACA,UAAMoD,MAAM,GAAG,KAAKzD,SAAL,CAAgBF,QAAhB,EAA0B,QAA1B,CAAf;AACA,WAAO,KAAK4D,WAAL,CAAkBD,MAAlB,EAA0B9C,MAA1B,CAAP;AACH;;AAED+C,EAAAA,WAAW,CAAED,MAAF,EAAU9C,MAAM,GAAGjB,SAAnB,EAA8B;AACrC,UAAMiE,SAAS,GAAG,KAAKC,YAAL,EAAlB;AACA,QAAIvC,MAAM,GAAG3B,SAAb;;AACA,QAAIiB,MAAM,KAAKjB,SAAf,EAA0B;AACtB2B,MAAAA,MAAM,GAAGV,MAAM,CAAC,QAAD,CAAf;AACH;;AACD,UAAMkD,IAAI,GAAGxB,UAAU,CAAEoB,MAAM,CAAC,YAAD,CAAN,CAAqB,CAArB,CAAF,CAAvB;AACA,UAAMK,UAAU,GAAGzB,UAAU,CAAEoB,MAAM,CAAC,qBAAD,CAAR,CAA7B;AACA,UAAMM,IAAI,GAAG1B,UAAU,CAAE,KAAK2B,gBAAL,CAAuB3C,MAAvB,EAA+BwC,IAAI,IAAIC,UAAU,GAAG,CAAjB,CAAnC,CAAF,CAAvB;AACA,UAAMG,MAAM,GAAGJ,IAAI,GAAGE,IAAtB;AACA,UAAMG,OAAO,GAAG,KAAKC,GAAL,CAAUN,IAAV,EAAgBE,IAAhB,IAAwB,CAAxC;AACA,WAAO;AACH,gBAAU1C,MADP;AAEH,mBAAasC,SAFV;AAGH,kBAAY,KAAKS,OAAL,CAAcT,SAAd,CAHT;AAIH,cAAQjE,SAJL;AAKH,aAAOA,SALJ;AAMH,aAAO2C,UAAU,CAAEoB,MAAM,CAAC,SAAD,CAAN,CAAkB,CAAlB,CAAF,CANd;AAOH,mBAAa/D,SAPV;AAQH,aAAO2C,UAAU,CAAEoB,MAAM,CAAC,SAAD,CAAN,CAAkB,CAAlB,CAAF,CARd;AASH,mBAAa/D,SATV;AAUH,cAAQA,SAVL;AAWH,cAAQqE,IAXL;AAYH,eAASF,IAZN;AAaH,cAAQA,IAbL;AAcH,uBAAiBE,IAdd;AAeH,gBAAUE,MAfP;AAgBH,oBAAcH,UAAU,GAAG,GAhBxB;AAiBH,iBAAWI,OAjBR;AAkBH,oBAAc7B,UAAU,CAAEoB,MAAM,CAAC,QAAD,CAAN,CAAiB,CAAjB,CAAF,CAlBrB;AAmBH,qBAAe/D,SAnBZ;AAoBH,cAAQ+D;AApBL,KAAP;AAsBH;;AAED,QAAMY,WAAN,CAAmBhD,MAAnB,EAA2BiD,KAAK,GAAG5E,SAAnC,EAA8C6E,KAAK,GAAG7E,SAAtD,EAAiEW,MAAM,GAAG,EAA1E,EAA8E;AAC1E,UAAM,KAAKmC,WAAL,EAAN;AACA,UAAM7B,MAAM,GAAG,KAAKA,MAAL,CAAaU,MAAb,CAAf;AACA,UAAMyB,OAAO,GAAG;AACZ,gBAAUnC,MAAM,CAAC,IAAD;AADJ,KAAhB,CAH0E,CAM1E;AACA;AACA;AACA;;AACA,QAAI4D,KAAK,KAAK7E,SAAd,EAAyB;AACrBoD,MAAAA,OAAO,CAAC,OAAD,CAAP,GAAmByB,KAAnB,CADqB,CACK;AAC7B;;AACD,UAAMzE,QAAQ,GAAG,MAAM,KAAK0E,4BAAL,CAAmC,KAAKhB,MAAL,CAAaV,OAAb,EAAsBzC,MAAtB,CAAnC,CAAvB,CAb0E,CAc1E;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AACA,WAAO,KAAKoE,WAAL,CAAkB3E,QAAQ,CAAC,QAAD,CAAR,CAAmB,SAAnB,CAAlB,EAAiDa,MAAjD,EAAyD2D,KAAzD,EAAgEC,KAAhE,CAAP;AACH;;AAEDG,EAAAA,UAAU,CAAEC,KAAF,EAAShE,MAAM,GAAGjB,SAAlB,EAA6B;AACnC;AACA;AACA;AACA;AACA,QAAIiE,SAAS,GAAGjE,SAAhB;AACA,QAAIkF,IAAI,GAAGlF,SAAX;AACA,UAAM2D,IAAI,GAAG3D,SAAb;AACA,QAAImF,WAAW,GAAGnF,SAAlB;AACA,QAAIoF,YAAY,GAAGpF,SAAnB;AACA,QAAIkB,EAAE,GAAGlB,SAAT;AACA,UAAMqF,KAAK,GAAGrF,SAAd;AACA,UAAM0D,GAAG,GAAG1D,SAAZ;AACA,QAAI2B,MAAM,GAAG3B,SAAb;;AACA,QAAIiB,MAAJ,EAAY;AACRU,MAAAA,MAAM,GAAGV,MAAM,CAAC,QAAD,CAAf;AACH;;AACD,QAAIqE,KAAK,CAACC,OAAN,CAAeN,KAAf,CAAJ,EAA2B;AACvBhB,MAAAA,SAAS,GAAG,KAAKjC,WAAL,CAAkBiD,KAAlB,EAAyB,CAAzB,CAAZ;AACAE,MAAAA,WAAW,GAAG,KAAKhE,UAAL,CAAiB8D,KAAjB,EAAwB,CAAxB,CAAd;AACAG,MAAAA,YAAY,GAAG,KAAKjE,UAAL,CAAiB8D,KAAjB,EAAwB,CAAxB,CAAf;AACAC,MAAAA,IAAI,GAAG,KAAK/D,UAAL,CAAiB8D,KAAjB,EAAwB,CAAxB,CAAP;AACA/D,MAAAA,EAAE,GAAG,KAAKC,UAAL,CAAiB8D,KAAjB,EAAwB,CAAxB,CAAL;AACH;;AACD,UAAMO,KAAK,GAAG,KAAKC,WAAL,CAAkBN,WAAlB,CAAd;AACA,UAAMO,MAAM,GAAG,KAAKD,WAAL,CAAkBL,YAAlB,CAAf;AACA,UAAMO,IAAI,GAAG,KAAKF,WAAL,CAAkB/F,OAAO,CAACkG,SAAR,CAAmBT,WAAnB,EAAgCC,YAAhC,CAAlB,CAAb;AACA,WAAO;AACH,YAAMlE,EADH;AAEH,eAASmE,KAFN;AAGH,cAAQJ,KAHL;AAIH,mBAAahB,SAJV;AAKH,kBAAY,KAAKS,OAAL,CAAcT,SAAd,CALT;AAMH,gBAAUtC,MANP;AAOH,cAAQgC,IAPL;AAQH,cAAQuB,IARL;AASH,sBAAgBlF,SATb;AAUH,eAASwF,KAVN;AAWH,gBAAUE,MAXP;AAYH,cAAQC,IAZL;AAaH,aAAOjC;AAbJ,KAAP;AAeH;;AAED,QAAMmC,cAAN,CAAsBlE,MAAtB,EAA8BkD,KAAK,GAAG7E,SAAtC,EAAiDW,MAAM,GAAG,EAA1D,EAA8D;AAC1D,UAAM,KAAKmC,WAAL,EAAN;AACA,UAAM7B,MAAM,GAAG,KAAKA,MAAL,CAAaU,MAAb,CAAf;AACA,UAAMyB,OAAO,GAAG;AACZ,gBAAUnC,MAAM,CAAC,IAAD;AADJ,KAAhB;AAGA,UAAMb,QAAQ,GAAG,MAAM,KAAK0F,+BAAL,CAAsC,KAAKhC,MAAL,CAAaV,OAAb,EAAsBzC,MAAtB,CAAtC,CAAvB;AACA,UAAMoF,SAAS,GAAG,KAAKzF,SAAL,CAAgBF,QAAhB,EAA0B,YAA1B,CAAlB;AACA,WAAO,KAAK4F,cAAL,CAAqBD,SAArB,EAAgCpE,MAAhC,CAAP;AACH;;AAED,QAAMsE,UAAN,CAAkBtE,MAAlB,EAA0BuE,SAAS,GAAG,IAAtC,EAA4CtB,KAAK,GAAG5E,SAApD,EAA+D6E,KAAK,GAAG7E,SAAvE,EAAkFW,MAAM,GAAG,EAA3F,EAA+F;AAC3F,UAAM,KAAKmC,WAAL,EAAN;AACA,UAAM7B,MAAM,GAAG,KAAKA,MAAL,CAAaU,MAAb,CAAf;;AACA,QAAIiD,KAAK,KAAK5E,SAAd,EAAyB;AACrB4E,MAAAA,KAAK,GAAG,KAAKV,YAAL,KAAuB,QAA/B;AACH;;AACD,UAAMd,OAAO,GAAG;AACZ,gBAAUnC,MAAM,CAAC,IAAD,CADJ;AAEZ,oBAAc,KAAKkF,UAAL,CAAgBD,SAAhB,CAFF;AAGZ,cAAQtB,KAAK,GAAG,IAHJ;AAIZ,YAAM,KAAKwB,OAAL;AAJM,KAAhB;AAMA,UAAMhG,QAAQ,GAAG,MAAM,KAAKiG,kBAAL,CAAyB,KAAKvC,MAAL,CAAaV,OAAb,EAAsBzC,MAAtB,CAAzB,CAAvB;AACA,WAAO,KAAK2F,qBAAL,CAA4BlG,QAA5B,EAAsCa,MAAtC,EAA8CiF,SAA9C,EAAyDtB,KAAzD,EAAgEC,KAAhE,CAAP;AACH;;AAED,QAAM0B,YAAN,CAAoB5F,MAAM,GAAG,EAA7B,EAAiC;AAC7B,UAAM,KAAKmC,WAAL,EAAN;AACA,UAAM1C,QAAQ,GAAG,MAAM,KAAKoG,kBAAL,CAAyB7F,MAAzB,CAAvB;AACA,UAAMK,MAAM,GAAG;AAAE,cAAQZ;AAAV,KAAf;AACA,UAAMqG,QAAQ,GAAG,KAAKnG,SAAL,CAAgBF,QAAhB,EAA0B,UAA1B,CAAjB;;AACA,SAAK,IAAIG,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGkG,QAAQ,CAACjG,MAA7B,EAAqCD,CAAC,EAAtC,EAA0C;AACtC,YAAMmG,OAAO,GAAGD,QAAQ,CAAClG,CAAD,CAAxB;AACA,YAAMoG,UAAU,GAAG,KAAKxF,UAAL,CAAiBuF,OAAjB,EAA0B,IAA1B,CAAnB;AACA,YAAMnE,IAAI,GAAG,KAAKhB,gBAAL,CAAuBoF,UAAvB,CAAb;AACA,YAAMC,OAAO,GAAG,KAAKA,OAAL,EAAhB;AACAA,MAAAA,OAAO,CAAC,MAAD,CAAP,GAAkB,KAAKzF,UAAL,CAAiBuF,OAAO,CAAC,kBAAD,CAAxB,EAA8C,CAA9C,CAAlB;AACAE,MAAAA,OAAO,CAAC,OAAD,CAAP,GAAmB,KAAKzF,UAAL,CAAiBuF,OAAO,CAAC,QAAD,CAAxB,EAAoC,CAApC,CAAnB;AACA1F,MAAAA,MAAM,CAACuB,IAAD,CAAN,GAAeqE,OAAf;AACH;;AACD,WAAO,KAAKC,YAAL,CAAmB7F,MAAnB,EAA2B,KAA3B,CAAP;AACH;;AAED,QAAM8F,UAAN,CAAkB5F,EAAlB,EAAsBS,MAAM,GAAG3B,SAA/B,EAA0CW,MAAM,GAAG,EAAnD,EAAuD;AACnD,UAAM,KAAKmC,WAAL,EAAN;AACA,UAAMM,OAAO,GAAG;AACZ,YAAMnB,QAAQ,CAAEf,EAAF;AADF,KAAhB;AAGA,UAAMd,QAAQ,GAAG,MAAM,KAAK2G,kBAAL,CAAyB,KAAKjD,MAAL,CAAaV,OAAb,EAAsBzC,MAAtB,CAAzB,CAAvB;AACA,UAAM0E,KAAK,GAAG,KAAK/E,SAAL,CAAgBF,QAAhB,EAA0B,OAA1B,CAAd;AACA,WAAO,KAAK4G,UAAL,CAAiB3B,KAAjB,CAAP;AACH;;AAED,QAAM4B,WAAN,CAAmBtF,MAAM,GAAG3B,SAA5B,EAAuC4E,KAAK,GAAG5E,SAA/C,EAA0D6E,KAAK,GAAG7E,SAAlE,EAA6EW,MAAM,GAAG,EAAtF,EAA0F;AACtF,UAAM,KAAKmC,WAAL,EAAN;AACA,QAAI7B,MAAM,GAAGjB,SAAb;;AACA,QAAI2B,MAAM,KAAK3B,SAAf,EAA0B;AACtBiB,MAAAA,MAAM,GAAG,KAAKA,MAAL,CAAaU,MAAb,CAAT;AACH;;AACD,UAAMyB,OAAO,GAAG;AACZ,gBAAUnC,MAAM,CAAC,IAAD,CADJ;AAEZ,aAAO4D;AAFK,KAAhB;AAIA,UAAMzE,QAAQ,GAAG,MAAM,KAAK8G,6BAAL,CAAoC,KAAKpD,MAAL,CAAaV,OAAb,EAAsBzC,MAAtB,CAApC,CAAvB;AACA,UAAMwG,MAAM,GAAG,KAAK7G,SAAL,CAAgBF,QAAhB,EAA0B,QAA1B,CAAf;AACA,WAAO,KAAKgH,WAAL,CAAkBD,MAAlB,EAA0BlG,MAA1B,EAAkC2D,KAAlC,EAAyCC,KAAzC,CAAP;AACH;;AAED,QAAMwC,eAAN,CAAuB1F,MAAM,GAAG3B,SAAhC,EAA2C4E,KAAK,GAAG5E,SAAnD,EAA8D6E,KAAK,GAAG7E,SAAtE,EAAiFW,MAAM,GAAG,EAA1F,EAA8F;AAC1F,UAAMyC,OAAO,GAAG;AACZ,eAAS;AADG,KAAhB;AAGA,WAAO,MAAM,KAAK6D,WAAL,CAAkBtF,MAAlB,EAA0BiD,KAA1B,EAAiCC,KAAjC,EAAwC,KAAKf,MAAL,CAAaV,OAAb,EAAsBzC,MAAtB,CAAxC,CAAb;AACH;;AAED,QAAM2G,iBAAN,CAAyB3F,MAAM,GAAG3B,SAAlC,EAA6C4E,KAAK,GAAG5E,SAArD,EAAgE6E,KAAK,GAAG7E,SAAxE,EAAmFW,MAAM,GAAG,EAA5F,EAAgG;AAC5F,UAAMyC,OAAO,GAAG;AACZ,eAAS;AADG,KAAhB;AAGA,WAAO,MAAM,KAAK6D,WAAL,CAAkBtF,MAAlB,EAA0BiD,KAA1B,EAAiCC,KAAjC,EAAwC,KAAKf,MAAL,CAAaV,OAAb,EAAsBzC,MAAtB,CAAxC,CAAb;AACH;;AAED,QAAM4G,WAAN,CAAmB5F,MAAnB,EAA2BgC,IAA3B,EAAiCuB,IAAjC,EAAuCQ,MAAvC,EAA+CF,KAAK,GAAGxF,SAAvD,EAAkEW,MAAM,GAAG,EAA3E,EAA+E;AAC3E,UAAM,KAAKmC,WAAL,EAAN;AACAoC,IAAAA,IAAI,GAAIA,IAAI,KAAK,KAAV,GAAmB,KAAnB,GAA2B,KAAlC;AACA,UAAM9B,OAAO,GAAG;AACZ,gBAAU,KAAKoE,QAAL,CAAe7F,MAAf,CADE;AAEZ,oBAAcgC,IAFF;AAGZ,cAAQuB,IAHI;AAIZ,gBAAU,KAAKuC,iBAAL,CAAwB9F,MAAxB,EAAgC+D,MAAhC;AAJE,KAAhB;;AAMA,QAAI/B,IAAI,KAAK,OAAb,EAAsB;AAClBP,MAAAA,OAAO,CAAC,OAAD,CAAP,GAAmB,KAAKkB,gBAAL,CAAuB3C,MAAvB,EAA+B6D,KAA/B,CAAnB;AACH;;AACD,UAAMpF,QAAQ,GAAG,MAAM,KAAKsH,8BAAL,CAAqC,KAAK5D,MAAL,CAAaV,OAAb,EAAsBzC,MAAtB,CAArC,CAAvB;AACA,UAAM0E,KAAK,GAAG,KAAK/E,SAAL,CAAgBF,QAAhB,EAA0B,OAA1B,CAAd;AACA,WAAO,KAAK4G,UAAL,CAAiB3B,KAAjB,CAAP;AACH;;AAED,QAAMsC,WAAN,CAAmBzG,EAAnB,EAAuBS,MAAM,GAAG3B,SAAhC,EAA2CW,MAAM,GAAG,EAApD,EAAwD;AACpD,UAAM,KAAKmC,WAAL,EAAN;AACA,UAAMM,OAAO,GAAG;AACZ,YAAMnB,QAAQ,CAAEf,EAAF,CADF;AAEZ,eAAS;AAFG,KAAhB;AAIA,UAAMd,QAAQ,GAAG,MAAM,KAAKwH,kBAAL,CAAyB,KAAK9D,MAAL,CAAaV,OAAb,EAAsBzC,MAAtB,CAAzB,CAAvB;AACA,UAAM0E,KAAK,GAAG,KAAK/E,SAAL,CAAgBF,QAAhB,EAA0B,OAA1B,CAAd;AACA,WAAO,KAAK4G,UAAL,CAAiB3B,KAAjB,CAAP;AACH;;AAEDwC,EAAAA,gBAAgB,CAAEC,MAAF,EAAU;AACtB,UAAMC,QAAQ,GAAG;AACb,gBAAU,QADG;AAEb,kBAAY,MAFC;AAGb,mBAAa;AAHA,KAAjB;AAKA,WAAO,KAAK5G,UAAL,CAAiB4G,QAAjB,EAA2BD,MAA3B,EAAmCA,MAAnC,CAAP;AACH;;AAEDd,EAAAA,UAAU,CAAE3B,KAAF,EAASpE,MAAM,GAAGjB,SAAlB,EAA6B;AACnC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,UAAMkB,EAAE,GAAG,KAAKC,UAAL,CAAiBkE,KAAjB,EAAwB,IAAxB,CAAX;AACA,UAAMpB,SAAS,GAAG,KAAK+D,SAAL,CAAgB,KAAK7G,UAAL,CAAiBkE,KAAjB,EAAwB,YAAxB,CAAhB,CAAlB;AACA,UAAMmC,QAAQ,GAAG,KAAKrG,UAAL,CAAiBkE,KAAjB,EAAwB,WAAxB,CAAjB;AACA,UAAM1D,MAAM,GAAG,KAAKsG,UAAL,CAAiBT,QAAjB,EAA2BvG,MAA3B,EAAmC,GAAnC,CAAf;AACA,UAAM0C,IAAI,GAAG,KAAKxC,UAAL,CAAiBkE,KAAjB,EAAwB,YAAxB,CAAb;AACA,UAAMH,IAAI,GAAG,KAAKgD,eAAL,CAAsB7C,KAAtB,EAA6B,MAA7B,CAAb;AACA,UAAMyC,MAAM,GAAG,KAAKD,gBAAL,CAAuB,KAAK1G,UAAL,CAAiBkE,KAAjB,EAAwB,OAAxB,CAAvB,CAAf;AACA,UAAM8C,cAAc,GAAG,KAAK7H,SAAL,CAAgB+E,KAAhB,EAAuB,iBAAvB,EAA0C,EAA1C,CAAvB;AACA,UAAMK,MAAM,GAAG,KAAKtD,UAAL,CAAiB+F,cAAjB,EAAiC,CAAjC,CAAf;AACA,UAAMC,eAAe,GAAG,KAAK9H,SAAL,CAAgB+E,KAAhB,EAAuB,QAAvB,EAAiC,EAAjC,CAAxB;AACA,UAAMgD,SAAS,GAAG,KAAKjG,UAAL,CAAiBgG,eAAjB,EAAkC,CAAlC,CAAlB;AACA,UAAME,YAAY,GAAG,KAAKhI,SAAL,CAAgB+E,KAAhB,EAAuB,eAAvB,EAAwC,EAAxC,CAArB;AACA,UAAMkD,MAAM,GAAG,KAAKnG,UAAL,CAAiBkG,YAAjB,EAA+B,CAA/B,CAAf;AACA,UAAME,cAAc,GAAG,KAAKlI,SAAL,CAAgB+E,KAAhB,EAAuB,gBAAvB,EAAyC,EAAzC,CAAvB;AACA,UAAMM,IAAI,GAAG,KAAKvD,UAAL,CAAiBoG,cAAjB,EAAiC,CAAjC,CAAb;AACA,UAAMC,UAAU,GAAG,KAAKnI,SAAL,CAAgB+E,KAAhB,EAAuB,OAAvB,EAAgC,EAAhC,CAAnB;AACA,QAAIG,KAAK,GAAG,KAAKpD,UAAL,CAAiBqG,UAAjB,EAA6B,CAA7B,CAAZ;;AACA,QAAIjD,KAAK,KAAKxF,SAAd,EAAyB;AACrB,UAAIyI,UAAU,KAAKzI,SAAnB,EAA8B;AAC1BwF,QAAAA,KAAK,GAAGiD,UAAR;AACH;AACJ;;AACD,UAAMC,OAAO,GAAG,KAAKpI,SAAL,CAAgB+E,KAAhB,EAAuB,UAAvB,EAAmC,EAAnC,CAAhB;AACA,UAAMsD,OAAO,GAAG,KAAKvG,UAAL,CAAiBsG,OAAjB,EAA0B,CAA1B,CAAhB;AACA,QAAIhF,GAAG,GAAG1D,SAAV;;AACA,QAAI2I,OAAO,KAAK3I,SAAhB,EAA2B;AACvB,YAAM4I,aAAa,GAAG,KAAKzH,UAAL,CAAiBuH,OAAjB,EAA0B,CAA1B,CAAtB;AACA,YAAMG,eAAe,GAAG,KAAKtH,gBAAL,CAAuBqH,aAAvB,CAAxB;AACAlF,MAAAA,GAAG,GAAG;AACF,gBAAQiF,OADN;AAEF,gBAAQE;AAFN,OAAN;AAIH;;AACD,WAAO,KAAKC,SAAL,CAAgB;AACnB,cAAQzD,KADW;AAEnB,YAAMnE,EAFa;AAGnB,uBAAiBlB,SAHE;AAInB,kBAAY,KAAK0E,OAAL,CAAcT,SAAd,CAJO;AAKnB,mBAAaA,SALM;AAMnB,4BAAsBjE,SANH;AAOnB,gBAAU8H,MAPS;AAQnB,gBAAUnG,MARS;AASnB,cAAQgC,IATW;AAUnB,qBAAe3D,SAVI;AAWnB,kBAAYA,SAXO;AAYnB,cAAQkF,IAZW;AAanB,eAASM,KAbU;AAcnB,mBAAaxF,SAdM;AAenB,iBAAWA,SAfQ;AAgBnB,cAAQ2F,IAhBW;AAiBnB,gBAAUD,MAjBS;AAkBnB,gBAAU6C,MAlBS;AAmBnB,mBAAaF,SAnBM;AAoBnB,gBAAUrI,SApBS;AAqBnB,aAAO0D;AArBY,KAAhB,CAAP;AAuBH;;AAEDqF,EAAAA,MAAM,CAAExG,IAAF,EAAQ;AACV,UAAMyG,KAAK,GAAG;AACV,aAAO,IADG;AAEV,aAAO,IAFG;AAGV,aAAO,IAHG;AAIV,aAAO;AAJG,KAAd;AAMA,WAAO,KAAK1I,SAAL,CAAgB0I,KAAhB,EAAuBzG,IAAvB,EAA6B,KAA7B,CAAP;AACH;;AAED,QAAM0G,mBAAN,CAA2B1G,IAA3B,EAAiC5B,MAAM,GAAG,EAA1C,EAA8C;AAC1C,UAAM,KAAKmC,WAAL,EAAN;AACA,UAAM5C,QAAQ,GAAG,KAAKA,QAAL,CAAeqC,IAAf,CAAjB;;AACA,QAAI,KAAKwG,MAAL,CAAaxG,IAAb,CAAJ,EAAwB;AACpB,YAAM,IAAIhD,YAAJ,CAAkB,KAAK2B,EAAL,GAAU,kCAAV,GAA+CqB,IAA/C,GAAsD,mBAAxE,CAAN;AACH;;AACD,UAAMa,OAAO,GAAG;AACZ,kBAAYlD,QAAQ,CAAC,IAAD;AADR,KAAhB;AAGA,UAAME,QAAQ,GAAG,MAAM,KAAK8I,4CAAL,CAAmD,KAAKpF,MAAL,CAAaV,OAAb,EAAsBzC,MAAtB,CAAnD,CAAvB;AACA,UAAMwI,gBAAgB,GAAG,KAAK7I,SAAL,CAAgBF,QAAhB,EAA0B,mBAA1B,CAAzB;AACA,UAAMgJ,WAAW,GAAG,EAApB;;AACA,SAAK,IAAI7I,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG4I,gBAAgB,CAAC3I,MAArC,EAA6CD,CAAC,EAA9C,EAAkD;AAC9C,YAAM8I,cAAc,GAAGF,gBAAgB,CAAC5I,CAAD,CAAvC;;AACA,UAAI8I,cAAc,CAAC,OAAD,CAAlB,EAA6B;AACzB,cAAMC,OAAO,GAAGD,cAAc,CAAC,SAAD,CAA9B;AACA,aAAKE,YAAL,CAAmBD,OAAnB;AACAF,QAAAA,WAAW,CAAC/G,IAAZ,CAAkBiH,OAAlB;AACH;AACJ;;AACD,UAAME,iBAAiB,GAAGJ,WAAW,CAAC5I,MAAtC;;AACA,QAAIgJ,iBAAiB,GAAG,CAAxB,EAA2B;AACvB,YAAM,IAAIpK,cAAJ,CAAoB,KAAK8B,EAAL,GAAU,+CAAV,GAA4DqB,IAA5D,GAAmE,sBAAvF,CAAN;AACH;;AACD,UAAM+G,OAAO,GAAGF,WAAW,CAAC,CAAD,CAA3B;AACA,WAAO;AACH,kBAAY7G,IADT;AAEH,iBAAW+G,OAFR;AAGH,aAAOtJ,SAHJ;AAIH,cAAQmJ;AAJL,KAAP;AAMH;;AAED,QAAMM,oBAAN,CAA4BlH,IAA5B,EAAkC5B,MAAM,GAAG,EAA3C,EAA+C;AAC3C,UAAM,KAAKmC,WAAL,EAAN;AACA,UAAM5C,QAAQ,GAAG,KAAKA,QAAL,CAAeqC,IAAf,CAAjB;;AACA,QAAI,KAAKwG,MAAL,CAAaxG,IAAb,CAAJ,EAAwB;AACpB,YAAM,IAAIhD,YAAJ,CAAkB,KAAK2B,EAAL,GAAU,mCAAV,GAAgDqB,IAAhD,GAAuD,mBAAzE,CAAN;AACH;;AACD,UAAMa,OAAO,GAAG;AACZ,kBAAYlD,QAAQ,CAAC,IAAD;AADR,KAAhB;AAGA,UAAME,QAAQ,GAAG,MAAM,KAAKsJ,6CAAL,CAAoD,KAAK5F,MAAL,CAAaV,OAAb,EAAsBzC,MAAtB,CAApD,CAAvB;AACA,UAAM2I,OAAO,GAAG,KAAKnI,UAAL,CAAiBf,QAAQ,CAAC,iBAAD,CAAzB,EAA8C,SAA9C,CAAhB,CAV2C,CAUgC;;AAC3E,WAAO;AACH,kBAAYmC,IADT;AAEH,iBAAW+G,OAFR;AAGH,aAAOtJ,SAHJ;AAIH,cAAQI;AAJL,KAAP;AAMH;;AAEDuJ,EAAAA,sBAAsB,CAAE7B,MAAF,EAAU;AAC5B,UAAMC,QAAQ,GAAG;AACb,kBAAY,QADC;AAEb,mBAAa,IAFA;AAGb,iBAAW,UAHE;AAIb,kBAAY,UAJC;AAKb,8BAAwB;AALX,KAAjB;AAOA,WAAO,KAAK5G,UAAL,CAAiB4G,QAAjB,EAA2BD,MAA3B,EAAmCA,MAAnC,CAAP;AACH;;AAED8B,EAAAA,gBAAgB,CAAEC,WAAF,EAAe3J,QAAQ,GAAGF,SAA1B,EAAqC;AACjD,UAAMkB,EAAE,GAAG,KAAKC,UAAL,CAAiB0I,WAAjB,EAA8B,IAA9B,CAAX;AACA,UAAM5F,SAAS,GAAG,KAAK+D,SAAL,CAAgB,KAAK7G,UAAL,CAAiB0I,WAAjB,EAA8B,YAA9B,CAAhB,CAAlB;AACA,UAAMlD,UAAU,GAAG,KAAKxF,UAAL,CAAiB0I,WAAjB,EAA8B,UAA9B,CAAnB;AACA,UAAMtH,IAAI,GAAG,KAAKhB,gBAAL,CAAuBoF,UAAvB,EAAmCzG,QAAnC,CAAb;AACA,UAAMwF,MAAM,GAAG/C,UAAU,CAAEkH,WAAW,CAAC,QAAD,CAAX,CAAsB,CAAtB,CAAF,CAAzB;AACA,UAAMnG,GAAG,GAAGf,UAAU,CAAEkH,WAAW,CAAC,KAAD,CAAX,CAAmB,CAAnB,CAAF,CAAtB;AACA,UAAMC,WAAW,GAAGD,WAAW,CAAC,KAAD,CAAX,CAAmB,CAAnB,CAApB;AACA,UAAM/B,MAAM,GAAG,KAAK6B,sBAAL,CAA6B,KAAKxI,UAAL,CAAiB0I,WAAjB,EAA8B,OAA9B,CAA7B,CAAf;AACA,UAAMlG,IAAI,GAAI,kBAAkBkG,WAAnB,GAAkC,SAAlC,GAA8C,YAA3D;AACA,UAAME,IAAI,GAAG,KAAKzJ,SAAL,CAAgBuJ,WAAhB,EAA6BlG,IAAI,GAAG,OAApC,EAA6C,EAA7C,CAAb;AACA,UAAM2F,OAAO,GAAG,KAAKhJ,SAAL,CAAgByJ,IAAhB,EAAsB,gBAAtB,CAAhB;AACA,UAAMC,IAAI,GAAG,KAAK7I,UAAL,CAAiB4I,IAAjB,EAAuB,SAAvB,CAAb;AACA,UAAME,OAAO,GAAG,KAAKjC,SAAL,CAAgB,KAAK7G,UAAL,CAAiB4I,IAAjB,EAAuB,YAAvB,CAAhB,CAAhB;AACA,WAAO;AACH,cAAQF,WADL;AAEH,YAAM3I,EAFH;AAGH,cAAQ8I,IAHL;AAIH,mBAAa/F,SAJV;AAKH,kBAAY,KAAKS,OAAL,CAAcT,SAAd,CALT;AAMH,iBAAWqF,OANR;AAOH,cAAQ3F,IAPL;AAQH,gBAAU+B,MARP;AASH,kBAAYnD,IATT;AAUH,gBAAUuF,MAVP;AAWH,iBAAWmC,OAXR;AAYH,aAAO;AACH,gBAAQvG,GADL;AAEH,gBAAQoG;AAFL;AAZJ,KAAP;AAiBH;;AAED,QAAMI,aAAN,CAAqB3H,IAAI,GAAGvC,SAA5B,EAAuC4E,KAAK,GAAG5E,SAA/C,EAA0D6E,KAAK,GAAG7E,SAAlE,EAA6EW,MAAM,GAAG,EAAtF,EAA0F;AACtF,UAAM,KAAKmC,WAAL,EAAN;;AACA,QAAIP,IAAI,KAAKvC,SAAb,EAAwB;AACpB,YAAM,IAAIP,iBAAJ,CAAuB,KAAKyB,EAAL,GAAU,qDAAjC,CAAN;AACH;;AACD,UAAMhB,QAAQ,GAAG,KAAKA,QAAL,CAAeqC,IAAf,CAAjB;AACA,UAAMa,OAAO,GAAG;AACZ,kBAAYlD,QAAQ,CAAC,IAAD,CADR;AAEZ,aAAO2E;AAFK,KAAhB;AAIA,UAAMzE,QAAQ,GAAG,MAAM,KAAK+J,oCAAL,CAA2C,KAAKrG,MAAL,CAAaV,OAAb,EAAsBzC,MAAtB,CAA3C,CAAvB;AACA,UAAMyJ,QAAQ,GAAG,KAAK9J,SAAL,CAAgBF,QAAhB,EAA0B,UAA1B,CAAjB;AACA,WAAO,KAAKiK,iBAAL,CAAwBD,QAAxB,EAAkClK,QAAlC,EAA4C0E,KAA5C,EAAmDC,KAAnD,CAAP;AACH;;AAED,QAAMyF,gBAAN,CAAwB/H,IAAI,GAAGvC,SAA/B,EAA0C4E,KAAK,GAAG5E,SAAlD,EAA6D6E,KAAK,GAAG7E,SAArE,EAAgFW,MAAM,GAAG,EAAzF,EAA6F;AACzF,UAAM,KAAKmC,WAAL,EAAN;;AACA,QAAIP,IAAI,KAAKvC,SAAb,EAAwB;AACpB,YAAM,IAAIP,iBAAJ,CAAuB,KAAKyB,EAAL,GAAU,qDAAjC,CAAN;AACH;;AACD,UAAMhB,QAAQ,GAAG,KAAKA,QAAL,CAAeqC,IAAf,CAAjB;AACA,UAAMa,OAAO,GAAG;AACZ,kBAAYlD,QAAQ,CAAC,IAAD,CADR;AAEZ,aAAO2E;AAFK,KAAhB;AAIA,UAAMzE,QAAQ,GAAG,MAAM,KAAKmK,uCAAL,CAA8C,KAAKzG,MAAL,CAAaV,OAAb,EAAsBzC,MAAtB,CAA9C,CAAvB;AACA,UAAM6J,WAAW,GAAG,KAAKlK,SAAL,CAAgBF,QAAhB,EAA0B,aAA1B,CAApB;AACA,WAAO,KAAKiK,iBAAL,CAAwBG,WAAxB,EAAqCtK,QAArC,EAA+C0E,KAA/C,EAAsDC,KAAtD,CAAP;AACH;;AAED,QAAM4F,QAAN,CAAgBlI,IAAhB,EAAsBmD,MAAtB,EAA8B4D,OAA9B,EAAuCoB,GAAG,GAAG1K,SAA7C,EAAwDW,MAAM,GAAG,EAAjE,EAAqE;AACjE,SAAK4I,YAAL,CAAmBD,OAAnB;AACA,UAAM,KAAKxG,WAAL,EAAN;AACA,UAAM5C,QAAQ,GAAG,KAAKA,QAAL,CAAeqC,IAAf,CAAjB;AACA,UAAMa,OAAO,GAAG;AACZ,kBAAYlD,QAAQ,CAAC,IAAD,CADR;AAEZ,gBAAUwF,MAFE;AAGZ,yBAAmB;AACf,0BAAkB4D;AADH;AAHP,KAAhB;AAOA,UAAMlJ,QAAQ,GAAG,MAAM,KAAKuK,wCAAL,CAA+C,KAAK7G,MAAL,CAAaV,OAAb,EAAsBzC,MAAtB,CAA/C,CAAvB;AACA,UAAMiK,UAAU,GAAG,KAAKtK,SAAL,CAAgBF,QAAhB,EAA0B,YAA1B,CAAnB;AACA,WAAO,KAAKwJ,gBAAL,CAAuBgB,UAAvB,CAAP;AACH;;AAEDC,EAAAA,KAAK,GAAI;AACL,WAAO,KAAKC,YAAL,EAAP;AACH;;AAEDC,EAAAA,IAAI,CAAEC,IAAF,EAAQC,GAAG,GAAG,QAAd,EAAwBC,MAAM,GAAG,KAAjC,EAAwCvK,MAAM,GAAG,EAAjD,EAAqDwK,OAAO,GAAGnL,SAA/D,EAA0EoL,IAAI,GAAGpL,SAAjF,EAA4F;AAC5F,QAAIoD,OAAO,GAAG,KAAKiI,aAAL,CAAoBL,IAApB,EAA0BrK,MAA1B,CAAd;AACA,UAAM2K,KAAK,GAAG,KAAKC,IAAL,CAAW5K,MAAX,EAAmB,KAAK6K,aAAL,CAAoBR,IAApB,CAAnB,CAAd;;AACA,QAAI9H,MAAM,CAACC,IAAP,CAAamI,KAAb,EAAoB9K,MAAxB,EAAgC;AAC5B,UAAI0K,MAAM,KAAK,KAAf,EAAsB;AAClB9H,QAAAA,OAAO,IAAI,MAAM,KAAKqI,SAAL,CAAgBH,KAAhB,CAAjB;AACH,OAFD,MAEO;AACHF,QAAAA,IAAI,GAAG,KAAKM,IAAL,CAAWJ,KAAX,CAAP;AACH;AACJ;;AACD,UAAMK,GAAG,GAAG,KAAKC,IAAL,CAAU,KAAV,IAAmB,GAAnB,GAAyB,KAAKC,OAA9B,GAAwC,GAAxC,GAA8CzI,OAA1D;;AACA,QAAI6H,GAAG,KAAK,SAAZ,EAAuB;AACnB,WAAKa,wBAAL;AACA,YAAMjB,KAAK,GAAG,KAAKA,KAAL,GAAckB,QAAd,EAAd;AACA,YAAMC,UAAU,GAAG,CAAEd,MAAF,EAAU,UAAU,KAAKW,OAAf,GAAyB,GAAzB,GAA+BzI,OAAzC,CAAnB;;AACA,UAAIgI,IAAJ,EAAU;AACN,cAAMa,UAAU,GAAG,KAAKC,cAAL,CAAqBd,IAArB,CAAnB;AACAY,QAAAA,UAAU,CAAC3J,IAAX,CAAiB,KAAK8J,MAAL,CAAaF,UAAb,CAAjB;AACH;;AACDD,MAAAA,UAAU,CAAC3J,IAAX,CAAiBwI,KAAjB;AACA,YAAMuB,OAAO,GAAGJ,UAAU,CAACK,IAAX,CAAiB,GAAjB,CAAhB;AACA,YAAMC,SAAS,GAAG,KAAKC,IAAL,CAAW,KAAKC,MAAL,CAAaJ,OAAb,CAAX,EAAkC,KAAKI,MAAL,CAAa,KAAKC,MAAlB,CAAlC,EAA6D,QAA7D,CAAlB;AACAtB,MAAAA,OAAO,GAAG;AACN,yBAAiB,KAAKuB,MADhB;AAEN,4BAAoBJ,SAFd;AAGN,wBAAgBzB,KAHV;AAIN,wBAAgB;AAJV,OAAV;AAMH;;AACD,WAAO;AAAE,aAAOc,GAAT;AAAc,gBAAUT,MAAxB;AAAgC,cAAQE,IAAxC;AAA8C,iBAAWD;AAAzD,KAAP;AACH;;AAEDwB,EAAAA,YAAY,CAAEpK,IAAF,EAAQqK,MAAR,EAAgBjB,GAAhB,EAAqBT,MAArB,EAA6BC,OAA7B,EAAsCC,IAAtC,EAA4ChL,QAA5C,EAAsDyM,cAAtD,EAAsEC,WAAtE,EAAmF;AAC3F,QAAI1M,QAAQ,KAAKJ,SAAjB,EAA4B;AACxB,aADwB,CAChB;AACX;;AACD,QAAIuC,IAAI,IAAI,GAAZ,EAAiB;AACb,YAAMwK,SAAS,GAAG,KAAK5L,UAAL,CAAiBf,QAAjB,EAA2B,MAA3B,CAAlB;AACA,YAAMgM,OAAO,GAAG,KAAKjL,UAAL,CAAiBf,QAAjB,EAA2B,SAA3B,EAAsCgL,IAAtC,CAAhB;AACA,YAAM4B,QAAQ,GAAG,KAAK9L,EAAL,GAAU,GAAV,GAAgBkL,OAAjC;;AACA,UAAIW,SAAS,KAAK/M,SAAlB,EAA6B;AACzB,aAAKiN,4BAAL,CAAmC,KAAKC,UAAxC,EAAoDH,SAApD,EAA+DC,QAA/D;AACA,cAAM,IAAI1N,aAAJ,CAAmB0N,QAAnB,CAAN;AACH;AACJ;AACJ;;AAryBwC,CAA7C","sourcesContent":["'use strict';\n\n//  ---------------------------------------------------------------------------\n\nconst Exchange = require ('./base/Exchange');\nconst { AddressPending, AuthenticationError, ExchangeError, NotSupported, PermissionDenied, ArgumentsRequired } = require ('./base/errors');\nconst Precise = require ('./base/Precise');\n\n//  ---------------------------------------------------------------------------\n\nmodule.exports = class buda extends Exchange {\n    describe () {\n        return this.deepExtend (super.describe (), {\n            'id': 'buda',\n            'name': 'Buda',\n            'countries': [ 'AR', 'CL', 'CO', 'PE' ],\n            'rateLimit': 1000,\n            'version': 'v2',\n            'has': {\n                'cancelOrder': true,\n                'CORS': false,\n                'createDepositAddress': true,\n                'createOrder': true,\n                'fetchBalance': true,\n                'fetchClosedOrders': true,\n                'fetchCurrencies': true,\n                'fetchDepositAddress': true,\n                'fetchDeposits': true,\n                'fetchFundingFees': true,\n                'fetchMarkets': true,\n                'fetchMyTrades': false,\n                'fetchOHLCV': true,\n                'fetchOpenOrders': true,\n                'fetchOrder': true,\n                'fetchOrderBook': true,\n                'fetchOrders': true,\n                'fetchTrades': true,\n                'fetchTicker': true,\n                'fetchWithdrawals': true,\n                'withdraw': true,\n            },\n            'urls': {\n                'logo': 'https://user-images.githubusercontent.com/1294454/47380619-8a029200-d706-11e8-91e0-8a391fe48de3.jpg',\n                'api': 'https://www.buda.com/api',\n                'www': 'https://www.buda.com',\n                'doc': 'https://api.buda.com',\n                'fees': 'https://www.buda.com/comisiones',\n            },\n            'status': {\n                'status': 'error',\n                'updated': undefined,\n                'eta': undefined,\n                'url': undefined,\n            },\n            'api': {\n                'public': {\n                    'get': [\n                        'pairs',\n                        'markets',\n                        'currencies',\n                        'markets/{market}',\n                        'markets/{market}/ticker',\n                        'markets/{market}/volume',\n                        'markets/{market}/order_book',\n                        'markets/{market}/trades',\n                        'currencies/{currency}/fees/deposit',\n                        'currencies/{currency}/fees/withdrawal',\n                        'tv/history',\n                    ],\n                    'post': [\n                        'markets/{market}/quotations',\n                    ],\n                },\n                'private': {\n                    'get': [\n                        'balances',\n                        'balances/{currency}',\n                        'currencies/{currency}/balances',\n                        'orders',\n                        'orders/{id}',\n                        'markets/{market}/orders',\n                        'deposits',\n                        'currencies/{currency}/deposits',\n                        'withdrawals',\n                        'currencies/{currency}/withdrawals',\n                        'currencies/{currency}/receive_addresses',\n                        'currencies/{currency}/receive_addresses/{id}',\n                    ],\n                    'post': [\n                        'markets/{market}/orders',\n                        'currencies/{currency}/deposits',\n                        'currencies/{currency}/withdrawals',\n                        'currencies/{currency}/simulated_withdrawals',\n                        'currencies/{currency}/receive_addresses',\n                    ],\n                    'put': [\n                        'orders/{id}',\n                    ],\n                },\n            },\n            'timeframes': {\n                '1m': '1',\n                '5m': '5',\n                '30m': '30',\n                '1h': '60',\n                '2h': '120',\n                '1d': 'D',\n                '1w': 'W',\n            },\n            'fees': {\n                'trading': {\n                    'tierBased': true,\n                    'percentage': true,\n                    'taker': 0.008,  // 0.8%\n                    'maker': 0.004,  // 0.4%\n                    'tiers': {\n                        'taker': [\n                            [0, 0.008],  // 0.8%\n                            [2000, 0.007],  // 0.7%\n                            [20000, 0.006],  // 0.6%\n                            [100000, 0.005],  // 0.5%\n                            [500000, 0.004],  // 0.4%\n                            [2500000, 0.003],  // 0.3%\n                            [12500000, 0.002],  // 0.2%\n                        ],\n                        'maker': [\n                            [0, 0.004],  // 0.4%\n                            [2000, 0.0035],  // 0.35%\n                            [20000, 0.003],  // 0.3%\n                            [100000, 0.0025],  // 0.25%\n                            [500000, 0.002],  // 0.2%\n                            [2500000, 0.0015],  // 0.15%\n                            [12500000, 0.001],  // 0.1%\n                        ],\n                    },\n                },\n            },\n            'exceptions': {\n                'not_authorized': AuthenticationError,  // { message: 'Invalid credentials', code: 'not_authorized' }\n                'forbidden': PermissionDenied,  // { message: 'You dont have access to this resource', code: 'forbidden' }\n                'invalid_record': ExchangeError,  // { message: 'Validation Failed', code: 'invalid_record', errors: [] }\n                'not_found': ExchangeError,  // { message: 'Not found', code: 'not_found' }\n                'parameter_missing': ExchangeError,  // { message: 'Parameter missing', code: 'parameter_missing' }\n                'bad_parameter': ExchangeError,  // { message: 'Bad Parameter format', code: 'bad_parameter' }\n            },\n        });\n    }\n\n    async fetchCurrencyInfo (currency, currencies = undefined) {\n        if (!currencies) {\n            const response = await this.publicGetCurrencies ();\n            currencies = this.safeValue (response, 'currencies');\n        }\n        for (let i = 0; i < currencies.length; i++) {\n            const currencyInfo = currencies[i];\n            if (currencyInfo['id'] === currency) {\n                return currencyInfo;\n            }\n        }\n        return undefined;\n    }\n\n    async fetchMarkets (params = {}) {\n        const marketsResponse = await this.publicGetMarkets (params);\n        const markets = this.safeValue (marketsResponse, 'markets');\n        const currenciesResponse = await this.publicGetCurrencies ();\n        const currencies = this.safeValue (currenciesResponse, 'currencies');\n        const result = [];\n        for (let i = 0; i < markets.length; i++) {\n            const market = markets[i];\n            const id = this.safeString (market, 'id');\n            const baseId = this.safeString (market, 'base_currency');\n            const quoteId = this.safeString (market, 'quote_currency');\n            const base = this.safeCurrencyCode (baseId);\n            const quote = this.safeCurrencyCode (quoteId);\n            const baseInfo = await this.fetchCurrencyInfo (baseId, currencies);\n            const quoteInfo = await this.fetchCurrencyInfo (quoteId, currencies);\n            const symbol = base + '/' + quote;\n            const pricePrecisionString = this.safeString (quoteInfo, 'input_decimals');\n            const priceLimit = this.parsePrecision (pricePrecisionString);\n            const precision = {\n                'amount': this.safeInteger (baseInfo, 'input_decimals'),\n                'price': parseInt (pricePrecisionString),\n            };\n            const minimumOrderAmount = this.safeValue (market, 'minimum_order_amount', []);\n            const limits = {\n                'amount': {\n                    'min': this.safeNumber (minimumOrderAmount, 0),\n                    'max': undefined,\n                },\n                'price': {\n                    'min': priceLimit,\n                    'max': undefined,\n                },\n                'cost': {\n                    'min': undefined,\n                    'max': undefined,\n                },\n            };\n            result.push ({\n                'id': id,\n                'symbol': symbol,\n                'base': base,\n                'quote': quote,\n                'baseId': baseId,\n                'quoteId': quoteId,\n                'active': true,\n                'precision': precision,\n                'limits': limits,\n                'info': market,\n            });\n        }\n        return result;\n    }\n\n    async fetchCurrencies (params = {}) {\n        const response = await this.publicGetCurrencies ();\n        const currencies = response['currencies'];\n        const result = {};\n        for (let i = 0; i < currencies.length; i++) {\n            const currency = currencies[i];\n            if (!currency['managed']) {\n                continue;\n            }\n            const id = this.safeString (currency, 'id');\n            const code = this.safeCurrencyCode (id);\n            const precision = this.safeNumber (currency, 'input_decimals');\n            const minimum = Math.pow (10, -precision);\n            result[code] = {\n                'id': id,\n                'code': code,\n                'info': currency,\n                'name': undefined,\n                'active': true,\n                'fee': undefined,\n                'precision': precision,\n                'limits': {\n                    'amount': {\n                        'min': minimum,\n                        'max': undefined,\n                    },\n                    'deposit': {\n                        'min': parseFloat (currency['deposit_minimum'][0]),\n                        'max': undefined,\n                    },\n                    'withdraw': {\n                        'min': parseFloat (currency['withdrawal_minimum'][0]),\n                    },\n                },\n            };\n        }\n        return result;\n    }\n\n    async fetchFundingFees (codes = undefined, params = {}) {\n        //  by default it will try load withdrawal fees of all currencies (with separate requests)\n        //  however if you define codes = [ 'ETH', 'BTC' ] in args it will only load those\n        await this.loadMarkets ();\n        const withdrawFees = {};\n        const depositFees = {};\n        const info = {};\n        if (codes === undefined) {\n            codes = Object.keys (this.currencies);\n        }\n        for (let i = 0; i < codes.length; i++) {\n            const code = codes[i];\n            const currency = this.currency (code);\n            const request = { 'currency': currency['id'] };\n            const withdrawResponse = await this.publicGetCurrenciesCurrencyFeesWithdrawal (request);\n            const depositResponse = await this.publicGetCurrenciesCurrencyFeesDeposit (request);\n            withdrawFees[code] = this.parseFundingFee (withdrawResponse['fee']);\n            depositFees[code] = this.parseFundingFee (depositResponse['fee']);\n            info[code] = {\n                'withdraw': withdrawResponse,\n                'deposit': depositResponse,\n            };\n        }\n        return {\n            'withdraw': withdrawFees,\n            'deposit': depositFees,\n            'info': info,\n        };\n    }\n\n    parseFundingFee (fee, type = undefined) {\n        if (type === undefined) {\n            type = fee['name'];\n        }\n        if (type === 'withdrawal') {\n            type = 'withdraw';\n        }\n        return {\n            'type': type,\n            'currency': fee['base'][1],\n            'rate': fee['percent'],\n            'cost': parseFloat (fee['base'][0]),\n        };\n    }\n\n    async fetchTicker (symbol, params = {}) {\n        await this.loadMarkets ();\n        const market = this.market (symbol);\n        const request = {\n            'market': market['id'],\n        };\n        const response = await this.publicGetMarketsMarketTicker (this.extend (request, params));\n        const ticker = this.safeValue (response, 'ticker');\n        return this.parseTicker (ticker, market);\n    }\n\n    parseTicker (ticker, market = undefined) {\n        const timestamp = this.milliseconds ();\n        let symbol = undefined;\n        if (market !== undefined) {\n            symbol = market['symbol'];\n        }\n        const last = parseFloat (ticker['last_price'][0]);\n        const percentage = parseFloat (ticker['price_variation_24h']);\n        const open = parseFloat (this.priceToPrecision (symbol, last / (percentage + 1)));\n        const change = last - open;\n        const average = this.sum (last, open) / 2;\n        return {\n            'symbol': symbol,\n            'timestamp': timestamp,\n            'datetime': this.iso8601 (timestamp),\n            'high': undefined,\n            'low': undefined,\n            'bid': parseFloat (ticker['max_bid'][0]),\n            'bidVolume': undefined,\n            'ask': parseFloat (ticker['min_ask'][0]),\n            'askVolume': undefined,\n            'vwap': undefined,\n            'open': open,\n            'close': last,\n            'last': last,\n            'previousClose': open,\n            'change': change,\n            'percentage': percentage * 100,\n            'average': average,\n            'baseVolume': parseFloat (ticker['volume'][0]),\n            'quoteVolume': undefined,\n            'info': ticker,\n        };\n    }\n\n    async fetchTrades (symbol, since = undefined, limit = undefined, params = {}) {\n        await this.loadMarkets ();\n        const market = this.market (symbol);\n        const request = {\n            'market': market['id'],\n        };\n        // the since argument works backwards – returns trades up to the specified timestamp\n        // therefore not implemented here\n        // the method is still available for users to be able to traverse backwards in time\n        // by using the timestamp from the first received trade upon each iteration\n        if (limit !== undefined) {\n            request['limit'] = limit; // 50 max\n        }\n        const response = await this.publicGetMarketsMarketTrades (this.extend (request, params));\n        //\n        //     { trades: {      market_id:   \"ETH-BTC\",\n        //                      timestamp:    null,\n        //                 last_timestamp:   \"1536901277302\",\n        //                        entries: [ [ \"1540077456791\", \"0.0063767\", \"0.03\", \"sell\", 479842 ],\n        //                                   [ \"1539916642772\", \"0.01888263\", \"0.03019563\", \"sell\", 479438 ],\n        //                                   [ \"1539834081787\", \"0.023718648\", \"0.031001\", \"sell\", 479069 ],\n        //                                   ... ]\n        //\n        return this.parseTrades (response['trades']['entries'], market, since, limit);\n    }\n\n    parseTrade (trade, market = undefined) {\n        //\n        // fetchTrades (public)\n        //  [ \"1540077456791\", \"0.0063767\", \"0.03\", \"sell\", 479842 ]\n        //\n        let timestamp = undefined;\n        let side = undefined;\n        const type = undefined;\n        let priceString = undefined;\n        let amountString = undefined;\n        let id = undefined;\n        const order = undefined;\n        const fee = undefined;\n        let symbol = undefined;\n        if (market) {\n            symbol = market['symbol'];\n        }\n        if (Array.isArray (trade)) {\n            timestamp = this.safeInteger (trade, 0);\n            priceString = this.safeString (trade, 1);\n            amountString = this.safeString (trade, 2);\n            side = this.safeString (trade, 3);\n            id = this.safeString (trade, 4);\n        }\n        const price = this.parseNumber (priceString);\n        const amount = this.parseNumber (amountString);\n        const cost = this.parseNumber (Precise.stringMul (priceString, amountString));\n        return {\n            'id': id,\n            'order': order,\n            'info': trade,\n            'timestamp': timestamp,\n            'datetime': this.iso8601 (timestamp),\n            'symbol': symbol,\n            'type': type,\n            'side': side,\n            'takerOrMaker': undefined,\n            'price': price,\n            'amount': amount,\n            'cost': cost,\n            'fee': fee,\n        };\n    }\n\n    async fetchOrderBook (symbol, limit = undefined, params = {}) {\n        await this.loadMarkets ();\n        const market = this.market (symbol);\n        const request = {\n            'market': market['id'],\n        };\n        const response = await this.publicGetMarketsMarketOrderBook (this.extend (request, params));\n        const orderbook = this.safeValue (response, 'order_book');\n        return this.parseOrderBook (orderbook, symbol);\n    }\n\n    async fetchOHLCV (symbol, timeframe = '1m', since = undefined, limit = undefined, params = {}) {\n        await this.loadMarkets ();\n        const market = this.market (symbol);\n        if (since === undefined) {\n            since = this.milliseconds () - 86400000;\n        }\n        const request = {\n            'symbol': market['id'],\n            'resolution': this.timeframes[timeframe],\n            'from': since / 1000,\n            'to': this.seconds (),\n        };\n        const response = await this.publicGetTvHistory (this.extend (request, params));\n        return this.parseTradingViewOHLCV (response, market, timeframe, since, limit);\n    }\n\n    async fetchBalance (params = {}) {\n        await this.loadMarkets ();\n        const response = await this.privateGetBalances (params);\n        const result = { 'info': response };\n        const balances = this.safeValue (response, 'balances');\n        for (let i = 0; i < balances.length; i++) {\n            const balance = balances[i];\n            const currencyId = this.safeString (balance, 'id');\n            const code = this.safeCurrencyCode (currencyId);\n            const account = this.account ();\n            account['free'] = this.safeString (balance['available_amount'], 0);\n            account['total'] = this.safeString (balance['amount'], 0);\n            result[code] = account;\n        }\n        return this.parseBalance (result, false);\n    }\n\n    async fetchOrder (id, symbol = undefined, params = {}) {\n        await this.loadMarkets ();\n        const request = {\n            'id': parseInt (id),\n        };\n        const response = await this.privateGetOrdersId (this.extend (request, params));\n        const order = this.safeValue (response, 'order');\n        return this.parseOrder (order);\n    }\n\n    async fetchOrders (symbol = undefined, since = undefined, limit = undefined, params = {}) {\n        await this.loadMarkets ();\n        let market = undefined;\n        if (symbol !== undefined) {\n            market = this.market (symbol);\n        }\n        const request = {\n            'market': market['id'],\n            'per': limit,\n        };\n        const response = await this.privateGetMarketsMarketOrders (this.extend (request, params));\n        const orders = this.safeValue (response, 'orders');\n        return this.parseOrders (orders, market, since, limit);\n    }\n\n    async fetchOpenOrders (symbol = undefined, since = undefined, limit = undefined, params = {}) {\n        const request = {\n            'state': 'pending',\n        };\n        return await this.fetchOrders (symbol, since, limit, this.extend (request, params));\n    }\n\n    async fetchClosedOrders (symbol = undefined, since = undefined, limit = undefined, params = {}) {\n        const request = {\n            'state': 'traded',\n        };\n        return await this.fetchOrders (symbol, since, limit, this.extend (request, params));\n    }\n\n    async createOrder (symbol, type, side, amount, price = undefined, params = {}) {\n        await this.loadMarkets ();\n        side = (side === 'buy') ? 'Bid' : 'Ask';\n        const request = {\n            'market': this.marketId (symbol),\n            'price_type': type,\n            'type': side,\n            'amount': this.amountToPrecision (symbol, amount),\n        };\n        if (type === 'limit') {\n            request['limit'] = this.priceToPrecision (symbol, price);\n        }\n        const response = await this.privatePostMarketsMarketOrders (this.extend (request, params));\n        const order = this.safeValue (response, 'order');\n        return this.parseOrder (order);\n    }\n\n    async cancelOrder (id, symbol = undefined, params = {}) {\n        await this.loadMarkets ();\n        const request = {\n            'id': parseInt (id),\n            'state': 'canceling',\n        };\n        const response = await this.privatePutOrdersId (this.extend (request, params));\n        const order = this.safeValue (response, 'order');\n        return this.parseOrder (order);\n    }\n\n    parseOrderStatus (status) {\n        const statuses = {\n            'traded': 'closed',\n            'received': 'open',\n            'canceling': 'canceled',\n        };\n        return this.safeString (statuses, status, status);\n    }\n\n    parseOrder (order, market = undefined) {\n        //\n        //     {\n        //         'id': 63679183,\n        //         'uuid': 'f9697bee-627e-4175-983f-0d5a41963fec',\n        //         'market_id': 'ETH-CLP',\n        //         'account_id': 51590,\n        //         'type': 'Ask',\n        //         'state': 'received',\n        //         'created_at': '2021-01-04T08:29:52.730Z',\n        //         'fee_currency': 'CLP',\n        //         'price_type': 'limit',\n        //         'source': None,\n        //         'limit': ['741000.0', 'CLP'],\n        //         'amount': ['0.001', 'ETH'],\n        //         'original_amount': ['0.001', 'ETH'],\n        //         'traded_amount': ['0.0', 'ETH'],\n        //         'total_exchanged': ['0.0', 'CLP'],\n        //         'paid_fee': ['0.0', 'CLP']\n        //     }\n        //\n        const id = this.safeString (order, 'id');\n        const timestamp = this.parse8601 (this.safeString (order, 'created_at'));\n        const marketId = this.safeString (order, 'market_id');\n        const symbol = this.safeSymbol (marketId, market, '-');\n        const type = this.safeString (order, 'price_type');\n        const side = this.safeStringLower (order, 'type');\n        const status = this.parseOrderStatus (this.safeString (order, 'state'));\n        const originalAmount = this.safeValue (order, 'original_amount', []);\n        const amount = this.safeNumber (originalAmount, 0);\n        const remainingAmount = this.safeValue (order, 'amount', []);\n        const remaining = this.safeNumber (remainingAmount, 0);\n        const tradedAmount = this.safeValue (order, 'traded_amount', []);\n        const filled = this.safeNumber (tradedAmount, 0);\n        const totalExchanged = this.safeValue (order, 'totalExchanged', []);\n        const cost = this.safeNumber (totalExchanged, 0);\n        const limitPrice = this.safeValue (order, 'limit', []);\n        let price = this.safeNumber (limitPrice, 0);\n        if (price === undefined) {\n            if (limitPrice !== undefined) {\n                price = limitPrice;\n            }\n        }\n        const paidFee = this.safeValue (order, 'paid_fee', []);\n        const feeCost = this.safeNumber (paidFee, 0);\n        let fee = undefined;\n        if (feeCost !== undefined) {\n            const feeCurrencyId = this.safeString (paidFee, 1);\n            const feeCurrencyCode = this.safeCurrencyCode (feeCurrencyId);\n            fee = {\n                'cost': feeCost,\n                'code': feeCurrencyCode,\n            };\n        }\n        return this.safeOrder ({\n            'info': order,\n            'id': id,\n            'clientOrderId': undefined,\n            'datetime': this.iso8601 (timestamp),\n            'timestamp': timestamp,\n            'lastTradeTimestamp': undefined,\n            'status': status,\n            'symbol': symbol,\n            'type': type,\n            'timeInForce': undefined,\n            'postOnly': undefined,\n            'side': side,\n            'price': price,\n            'stopPrice': undefined,\n            'average': undefined,\n            'cost': cost,\n            'amount': amount,\n            'filled': filled,\n            'remaining': remaining,\n            'trades': undefined,\n            'fee': fee,\n        });\n    }\n\n    isFiat (code) {\n        const fiats = {\n            'ARS': true,\n            'CLP': true,\n            'COP': true,\n            'PEN': true,\n        };\n        return this.safeValue (fiats, code, false);\n    }\n\n    async fetchDepositAddress (code, params = {}) {\n        await this.loadMarkets ();\n        const currency = this.currency (code);\n        if (this.isFiat (code)) {\n            throw new NotSupported (this.id + ' fetchDepositAddress() for fiat ' + code + ' is not supported');\n        }\n        const request = {\n            'currency': currency['id'],\n        };\n        const response = await this.privateGetCurrenciesCurrencyReceiveAddresses (this.extend (request, params));\n        const receiveAddresses = this.safeValue (response, 'receive_addresses');\n        const addressPool = [];\n        for (let i = 1; i < receiveAddresses.length; i++) {\n            const receiveAddress = receiveAddresses[i];\n            if (receiveAddress['ready']) {\n                const address = receiveAddress['address'];\n                this.checkAddress (address);\n                addressPool.push (address);\n            }\n        }\n        const addressPoolLength = addressPool.length;\n        if (addressPoolLength < 1) {\n            throw new AddressPending (this.id + ': there are no addresses ready for receiving ' + code + ', retry again later)');\n        }\n        const address = addressPool[0];\n        return {\n            'currency': code,\n            'address': address,\n            'tag': undefined,\n            'info': receiveAddresses,\n        };\n    }\n\n    async createDepositAddress (code, params = {}) {\n        await this.loadMarkets ();\n        const currency = this.currency (code);\n        if (this.isFiat (code)) {\n            throw new NotSupported (this.id + ': fiat fetchDepositAddress() for ' + code + ' is not supported');\n        }\n        const request = {\n            'currency': currency['id'],\n        };\n        const response = await this.privatePostCurrenciesCurrencyReceiveAddresses (this.extend (request, params));\n        const address = this.safeString (response['receive_address'], 'address');  // the creation is async and returns a null address, returns only the id\n        return {\n            'currency': code,\n            'address': address,\n            'tag': undefined,\n            'info': response,\n        };\n    }\n\n    parseTransactionStatus (status) {\n        const statuses = {\n            'rejected': 'failed',\n            'confirmed': 'ok',\n            'anulled': 'canceled',\n            'retained': 'canceled',\n            'pending_confirmation': 'pending',\n        };\n        return this.safeString (statuses, status, status);\n    }\n\n    parseTransaction (transaction, currency = undefined) {\n        const id = this.safeString (transaction, 'id');\n        const timestamp = this.parse8601 (this.safeString (transaction, 'created_at'));\n        const currencyId = this.safeString (transaction, 'currency');\n        const code = this.safeCurrencyCode (currencyId, currency);\n        const amount = parseFloat (transaction['amount'][0]);\n        const fee = parseFloat (transaction['fee'][0]);\n        const feeCurrency = transaction['fee'][1];\n        const status = this.parseTransactionStatus (this.safeString (transaction, 'state'));\n        const type = ('deposit_data' in transaction) ? 'deposit' : 'withdrawal';\n        const data = this.safeValue (transaction, type + '_data', {});\n        const address = this.safeValue (data, 'target_address');\n        const txid = this.safeString (data, 'tx_hash');\n        const updated = this.parse8601 (this.safeString (data, 'updated_at'));\n        return {\n            'info': transaction,\n            'id': id,\n            'txid': txid,\n            'timestamp': timestamp,\n            'datetime': this.iso8601 (timestamp),\n            'address': address,\n            'type': type,\n            'amount': amount,\n            'currency': code,\n            'status': status,\n            'updated': updated,\n            'fee': {\n                'cost': fee,\n                'rate': feeCurrency,\n            },\n        };\n    }\n\n    async fetchDeposits (code = undefined, since = undefined, limit = undefined, params = {}) {\n        await this.loadMarkets ();\n        if (code === undefined) {\n            throw new ArgumentsRequired (this.id + ': fetchDeposits() requires a currency code argument');\n        }\n        const currency = this.currency (code);\n        const request = {\n            'currency': currency['id'],\n            'per': limit,\n        };\n        const response = await this.privateGetCurrenciesCurrencyDeposits (this.extend (request, params));\n        const deposits = this.safeValue (response, 'deposits');\n        return this.parseTransactions (deposits, currency, since, limit);\n    }\n\n    async fetchWithdrawals (code = undefined, since = undefined, limit = undefined, params = {}) {\n        await this.loadMarkets ();\n        if (code === undefined) {\n            throw new ArgumentsRequired (this.id + ': fetchDeposits() requires a currency code argument');\n        }\n        const currency = this.currency (code);\n        const request = {\n            'currency': currency['id'],\n            'per': limit,\n        };\n        const response = await this.privateGetCurrenciesCurrencyWithdrawals (this.extend (request, params));\n        const withdrawals = this.safeValue (response, 'withdrawals');\n        return this.parseTransactions (withdrawals, currency, since, limit);\n    }\n\n    async withdraw (code, amount, address, tag = undefined, params = {}) {\n        this.checkAddress (address);\n        await this.loadMarkets ();\n        const currency = this.currency (code);\n        const request = {\n            'currency': currency['id'],\n            'amount': amount,\n            'withdrawal_data': {\n                'target_address': address,\n            },\n        };\n        const response = await this.privatePostCurrenciesCurrencyWithdrawals (this.extend (request, params));\n        const withdrawal = this.safeValue (response, 'withdrawal');\n        return this.parseTransaction (withdrawal);\n    }\n\n    nonce () {\n        return this.microseconds ();\n    }\n\n    sign (path, api = 'public', method = 'GET', params = {}, headers = undefined, body = undefined) {\n        let request = this.implodeParams (path, params);\n        const query = this.omit (params, this.extractParams (path));\n        if (Object.keys (query).length) {\n            if (method === 'GET') {\n                request += '?' + this.urlencode (query);\n            } else {\n                body = this.json (query);\n            }\n        }\n        const url = this.urls['api'] + '/' + this.version + '/' + request;\n        if (api === 'private') {\n            this.checkRequiredCredentials ();\n            const nonce = this.nonce ().toString ();\n            const components = [ method, '/api/' + this.version + '/' + request ];\n            if (body) {\n                const base64Body = this.stringToBase64 (body);\n                components.push (this.decode (base64Body));\n            }\n            components.push (nonce);\n            const message = components.join (' ');\n            const signature = this.hmac (this.encode (message), this.encode (this.secret), 'sha384');\n            headers = {\n                'X-SBTC-APIKEY': this.apiKey,\n                'X-SBTC-SIGNATURE': signature,\n                'X-SBTC-NONCE': nonce,\n                'Content-Type': 'application/json',\n            };\n        }\n        return { 'url': url, 'method': method, 'body': body, 'headers': headers };\n    }\n\n    handleErrors (code, reason, url, method, headers, body, response, requestHeaders, requestBody) {\n        if (response === undefined) {\n            return; // fallback to default error handler\n        }\n        if (code >= 400) {\n            const errorCode = this.safeString (response, 'code');\n            const message = this.safeString (response, 'message', body);\n            const feedback = this.id + ' ' + message;\n            if (errorCode !== undefined) {\n                this.throwExactlyMatchedException (this.exceptions, errorCode, feedback);\n                throw new ExchangeError (feedback);\n            }\n        }\n    }\n};\n"]},"metadata":{},"sourceType":"script"}