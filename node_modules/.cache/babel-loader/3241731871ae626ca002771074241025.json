{"ast":null,"code":"'use strict'; //  ---------------------------------------------------------------------------\n\nconst Exchange = require('./base/Exchange');\n\nconst {\n  ExchangeError,\n  ArgumentsRequired,\n  InvalidOrder\n} = require('./base/errors');\n\nconst Precise = require('./base/Precise'); //  ---------------------------------------------------------------------------\n\n\nmodule.exports = class mercado extends Exchange {\n  describe() {\n    return this.deepExtend(super.describe(), {\n      'id': 'mercado',\n      'name': 'Mercado Bitcoin',\n      'countries': ['BR'],\n      // Brazil\n      'rateLimit': 1000,\n      'version': 'v3',\n      'has': {\n        'cancelOrder': true,\n        'CORS': true,\n        'createMarketOrder': true,\n        'createOrder': true,\n        'fetchBalance': true,\n        'fetchMarkets': true,\n        'fetchMyTrades': 'emulated',\n        'fetchOHLCV': true,\n        'fetchOpenOrders': true,\n        'fetchOrder': true,\n        'fetchOrderBook': true,\n        'fetchOrders': true,\n        'fetchTicker': true,\n        'fetchTickers': false,\n        'fetchTrades': true,\n        'withdraw': true\n      },\n      'timeframes': {\n        '1m': '1m',\n        '5m': '5m',\n        '15m': '15m',\n        '30m': '30m',\n        '1h': '1h',\n        '6h': '6h',\n        '12h': '12h',\n        '1d': '1d',\n        '3d': '3d',\n        '1w': '1w',\n        '2w': '2w'\n      },\n      'urls': {\n        'logo': 'https://user-images.githubusercontent.com/1294454/27837060-e7c58714-60ea-11e7-9192-f05e86adb83f.jpg',\n        'api': {\n          'public': 'https://www.mercadobitcoin.net/api',\n          'private': 'https://www.mercadobitcoin.net/tapi',\n          'v4Public': 'https://www.mercadobitcoin.com.br/v4'\n        },\n        'www': 'https://www.mercadobitcoin.com.br',\n        'doc': ['https://www.mercadobitcoin.com.br/api-doc', 'https://www.mercadobitcoin.com.br/trade-api']\n      },\n      'api': {\n        'public': {\n          'get': ['coins', '{coin}/orderbook/', // last slash critical\n          '{coin}/ticker/', '{coin}/trades/', '{coin}/trades/{from}/', '{coin}/trades/{from}/{to}', '{coin}/day-summary/{year}/{month}/{day}/']\n        },\n        'private': {\n          'post': ['cancel_order', 'get_account_info', 'get_order', 'get_withdrawal', 'list_system_messages', 'list_orders', 'list_orderbook', 'place_buy_order', 'place_sell_order', 'place_market_buy_order', 'place_market_sell_order', 'withdraw_coin']\n        },\n        'v4Public': {\n          'get': ['{coin}/candle/']\n        }\n      },\n      'fees': {\n        'trading': {\n          'maker': 0.003,\n          'taker': 0.007\n        }\n      },\n      'options': {\n        'limits': {\n          'BTC': 0.001,\n          'BCH': 0.001,\n          'ETH': 0.01,\n          'LTC': 0.01,\n          'XRP': 0.1\n        }\n      }\n    });\n  }\n\n  async fetchMarkets(params = {}) {\n    const response = await this.publicGetCoins(params); //\n    //     [\n    //         \"BCH\",\n    //         \"BTC\",\n    //         \"ETH\",\n    //         \"LTC\",\n    //         \"XRP\",\n    //         \"MBPRK01\",\n    //         \"MBPRK02\",\n    //         \"MBPRK03\",\n    //         \"MBPRK04\",\n    //         \"MBCONS01\",\n    //         \"USDC\",\n    //         \"WBX\",\n    //         \"CHZ\",\n    //         \"MBCONS02\",\n    //         \"PAXG\",\n    //         \"MBVASCO01\",\n    //         \"LINK\"\n    //     ]\n    //\n\n    const result = [];\n    const amountLimits = this.safeValue(this.options, 'limits', {});\n\n    for (let i = 0; i < response.length; i++) {\n      const coin = response[i];\n      const baseId = coin;\n      const quoteId = 'BRL';\n      const base = this.safeCurrencyCode(baseId);\n      const quote = this.safeCurrencyCode(quoteId);\n      const symbol = base + '/' + quote;\n      const id = quote + base;\n      const precision = {\n        'amount': 8,\n        'price': 5\n      };\n      const priceLimit = '1e-5';\n      result.push({\n        'id': id,\n        'symbol': symbol,\n        'base': base,\n        'quote': quote,\n        'baseId': baseId,\n        'quoteId': quoteId,\n        'active': undefined,\n        'info': coin,\n        'precision': precision,\n        'limits': {\n          'amount': {\n            'min': this.safeNumber(amountLimits, baseId),\n            'max': undefined\n          },\n          'price': {\n            'min': this.parseNumber(priceLimit),\n            'max': undefined\n          },\n          'cost': {\n            'min': undefined,\n            'max': undefined\n          }\n        }\n      });\n    }\n\n    return result;\n  }\n\n  async fetchOrderBook(symbol, limit = undefined, params = {}) {\n    await this.loadMarkets();\n    const market = this.market(symbol);\n    const request = {\n      'coin': market['base']\n    };\n    const response = await this.publicGetCoinOrderbook(this.extend(request, params));\n    return this.parseOrderBook(response, symbol);\n  }\n\n  async fetchTicker(symbol, params = {}) {\n    await this.loadMarkets();\n    const market = this.market(symbol);\n    const request = {\n      'coin': market['base']\n    };\n    const response = await this.publicGetCoinTicker(this.extend(request, params));\n    const ticker = this.safeValue(response, 'ticker', {});\n    const timestamp = this.safeTimestamp(ticker, 'date');\n    const last = this.safeNumber(ticker, 'last');\n    return {\n      'symbol': symbol,\n      'timestamp': timestamp,\n      'datetime': this.iso8601(timestamp),\n      'high': this.safeNumber(ticker, 'high'),\n      'low': this.safeNumber(ticker, 'low'),\n      'bid': this.safeNumber(ticker, 'buy'),\n      'bidVolume': undefined,\n      'ask': this.safeNumber(ticker, 'sell'),\n      'askVolume': undefined,\n      'vwap': undefined,\n      'open': undefined,\n      'close': last,\n      'last': last,\n      'previousClose': undefined,\n      'change': undefined,\n      'percentage': undefined,\n      'average': undefined,\n      'baseVolume': this.safeNumber(ticker, 'vol'),\n      'quoteVolume': undefined,\n      'info': ticker\n    };\n  }\n\n  parseTrade(trade, market = undefined) {\n    const timestamp = this.safeTimestamp2(trade, 'date', 'executed_timestamp');\n    let symbol = undefined;\n\n    if (market !== undefined) {\n      symbol = market['symbol'];\n    }\n\n    const id = this.safeString2(trade, 'tid', 'operation_id');\n    const type = undefined;\n    const side = this.safeString(trade, 'type');\n    const priceString = this.safeString(trade, 'price');\n    const amountString = this.safeString2(trade, 'amount', 'quantity');\n    const price = this.parseNumber(priceString);\n    const amount = this.parseNumber(amountString);\n    const cost = this.parseNumber(Precise.stringMul(priceString, amountString));\n    const feeCost = this.safeNumber(trade, 'fee_rate');\n    let fee = undefined;\n\n    if (feeCost !== undefined) {\n      fee = {\n        'cost': feeCost,\n        'currency': undefined\n      };\n    }\n\n    return {\n      'id': id,\n      'info': trade,\n      'timestamp': timestamp,\n      'datetime': this.iso8601(timestamp),\n      'symbol': symbol,\n      'order': undefined,\n      'type': type,\n      'side': side,\n      'takerOrMaker': undefined,\n      'price': price,\n      'amount': amount,\n      'cost': cost,\n      'fee': fee\n    };\n  }\n\n  async fetchTrades(symbol, since = undefined, limit = undefined, params = {}) {\n    await this.loadMarkets();\n    const market = this.market(symbol);\n    let method = 'publicGetCoinTrades';\n    const request = {\n      'coin': market['base']\n    };\n\n    if (since !== undefined) {\n      method += 'From';\n      request['from'] = parseInt(since / 1000);\n    }\n\n    const to = this.safeInteger(params, 'to');\n\n    if (to !== undefined) {\n      method += 'To';\n    }\n\n    const response = await this[method](this.extend(request, params));\n    return this.parseTrades(response, market, since, limit);\n  }\n\n  async fetchBalance(params = {}) {\n    await this.loadMarkets();\n    const response = await this.privatePostGetAccountInfo(params);\n    const data = this.safeValue(response, 'response_data', {});\n    const balances = this.safeValue(data, 'balance', {});\n    const result = {\n      'info': response\n    };\n    const currencyIds = Object.keys(balances);\n\n    for (let i = 0; i < currencyIds.length; i++) {\n      const currencyId = currencyIds[i];\n      const code = this.safeCurrencyCode(currencyId);\n\n      if (currencyId in balances) {\n        const balance = this.safeValue(balances, currencyId, {});\n        const account = this.account();\n        account['free'] = this.safeString(balance, 'available');\n        account['total'] = this.safeString(balance, 'total');\n        result[code] = account;\n      }\n    }\n\n    return this.parseBalance(result, false);\n  }\n\n  async createOrder(symbol, type, side, amount, price = undefined, params = {}) {\n    await this.loadMarkets();\n    const request = {\n      'coin_pair': this.marketId(symbol)\n    };\n    let method = this.capitalize(side) + 'Order';\n\n    if (type === 'limit') {\n      method = 'privatePostPlace' + method;\n      request['limit_price'] = this.priceToPrecision(symbol, price);\n      request['quantity'] = this.amountToPrecision(symbol, amount);\n    } else {\n      method = 'privatePostPlaceMarket' + method;\n\n      if (side === 'buy') {\n        if (price === undefined) {\n          throw new InvalidOrder(this.id + ' createOrder() requires the price argument with market buy orders to calculate total order cost (amount to spend), where cost = amount * price. Supply a price argument to createOrder() call if you want the cost to be calculated for you from price and amount');\n        }\n\n        request['cost'] = this.priceToPrecision(symbol, amount * price);\n      } else {\n        request['quantity'] = this.amountToPrecision(symbol, amount);\n      }\n    }\n\n    const response = await this[method](this.extend(request, params)); // TODO: replace this with a call to parseOrder for unification\n\n    return {\n      'info': response,\n      'id': response['response_data']['order']['order_id'].toString()\n    };\n  }\n\n  async cancelOrder(id, symbol = undefined, params = {}) {\n    if (symbol === undefined) {\n      throw new ArgumentsRequired(this.id + ' cancelOrder () requires a symbol argument');\n    }\n\n    await this.loadMarkets();\n    const market = this.market(symbol);\n    const request = {\n      'coin_pair': market['id'],\n      'order_id': id\n    };\n    const response = await this.privatePostCancelOrder(this.extend(request, params)); //\n    //     {\n    //         response_data: {\n    //             order: {\n    //                 order_id: 2176769,\n    //                 coin_pair: 'BRLBCH',\n    //                 order_type: 2,\n    //                 status: 3,\n    //                 has_fills: false,\n    //                 quantity: '0.10000000',\n    //                 limit_price: '1996.15999',\n    //                 executed_quantity: '0.00000000',\n    //                 executed_price_avg: '0.00000',\n    //                 fee: '0.00000000',\n    //                 created_timestamp: '1536956488',\n    //                 updated_timestamp: '1536956499',\n    //                 operations: []\n    //             }\n    //         },\n    //         status_code: 100,\n    //         server_unix_timestamp: '1536956499'\n    //     }\n    //\n\n    const responseData = this.safeValue(response, 'response_data', {});\n    const order = this.safeValue(responseData, 'order', {});\n    return this.parseOrder(order, market);\n  }\n\n  parseOrderStatus(status) {\n    const statuses = {\n      '2': 'open',\n      '3': 'canceled',\n      '4': 'closed'\n    };\n    return this.safeString(statuses, status, status);\n  }\n\n  parseOrder(order, market = undefined) {\n    //\n    //     {\n    //         \"order_id\": 4,\n    //         \"coin_pair\": \"BRLBTC\",\n    //         \"order_type\": 1,\n    //         \"status\": 2,\n    //         \"has_fills\": true,\n    //         \"quantity\": \"2.00000000\",\n    //         \"limit_price\": \"900.00000\",\n    //         \"executed_quantity\": \"1.00000000\",\n    //         \"executed_price_avg\": \"900.00000\",\n    //         \"fee\": \"0.00300000\",\n    //         \"created_timestamp\": \"1453838494\",\n    //         \"updated_timestamp\": \"1453838494\",\n    //         \"operations\": [\n    //             {\n    //                 \"operation_id\": 1,\n    //                 \"quantity\": \"1.00000000\",\n    //                 \"price\": \"900.00000\",\n    //                 \"fee_rate\": \"0.30\",\n    //                 \"executed_timestamp\": \"1453838494\",\n    //             },\n    //         ],\n    //     }\n    //\n    const id = this.safeString(order, 'order_id');\n    const order_type = this.safeString(order, 'order_type');\n    let side = undefined;\n\n    if ('order_type' in order) {\n      side = order_type === '1' ? 'buy' : 'sell';\n    }\n\n    const status = this.parseOrderStatus(this.safeString(order, 'status'));\n    const marketId = this.safeString(order, 'coin_pair');\n    market = this.safeMarket(marketId, market);\n    const timestamp = this.safeTimestamp(order, 'created_timestamp');\n    const fee = {\n      'cost': this.safeNumber(order, 'fee'),\n      'currency': market['quote']\n    };\n    const price = this.safeNumber(order, 'limit_price'); // price = this.safeNumber (order, 'executed_price_avg', price);\n\n    const average = this.safeNumber(order, 'executed_price_avg');\n    const amount = this.safeNumber(order, 'quantity');\n    const filled = this.safeNumber(order, 'executed_quantity');\n    const lastTradeTimestamp = this.safeTimestamp(order, 'updated_timestamp');\n    const rawTrades = this.safeValue(order, 'operations', []);\n    const trades = this.parseTrades(rawTrades, market, undefined, undefined, {\n      'side': side,\n      'order': id\n    });\n    return this.safeOrder({\n      'info': order,\n      'id': id,\n      'clientOrderId': undefined,\n      'timestamp': timestamp,\n      'datetime': this.iso8601(timestamp),\n      'lastTradeTimestamp': lastTradeTimestamp,\n      'symbol': market['symbol'],\n      'type': 'limit',\n      'timeInForce': undefined,\n      'postOnly': undefined,\n      'side': side,\n      'price': price,\n      'stopPrice': undefined,\n      'cost': undefined,\n      'average': average,\n      'amount': amount,\n      'filled': filled,\n      'remaining': undefined,\n      'status': status,\n      'fee': fee,\n      'trades': trades\n    });\n  }\n\n  async fetchOrder(id, symbol = undefined, params = {}) {\n    if (symbol === undefined) {\n      throw new ArgumentsRequired(this.id + ' fetchOrder () requires a symbol argument');\n    }\n\n    await this.loadMarkets();\n    const market = this.market(symbol);\n    const request = {\n      'coin_pair': market['id'],\n      'order_id': parseInt(id)\n    };\n    const response = await this.privatePostGetOrder(this.extend(request, params));\n    const responseData = this.safeValue(response, 'response_data', {});\n    const order = this.safeValue(responseData, 'order');\n    return this.parseOrder(order, market);\n  }\n\n  async withdraw(code, amount, address, tag = undefined, params = {}) {\n    this.checkAddress(address);\n    await this.loadMarkets();\n    const currency = this.currency(code);\n    const request = {\n      'coin': currency['id'],\n      'quantity': amount.toFixed(10),\n      'address': address\n    };\n\n    if (code === 'BRL') {\n      const account_ref = ('account_ref' in params);\n\n      if (!account_ref) {\n        throw new ArgumentsRequired(this.id + ' withdraw() requires account_ref parameter to withdraw ' + code);\n      }\n    } else if (code !== 'LTC') {\n      const tx_fee = ('tx_fee' in params);\n\n      if (!tx_fee) {\n        throw new ArgumentsRequired(this.id + ' withdraw() requires tx_fee parameter to withdraw ' + code);\n      }\n\n      if (code === 'XRP') {\n        if (tag === undefined) {\n          if (!('destination_tag' in params)) {\n            throw new ArgumentsRequired(this.id + ' withdraw() requires a tag argument or destination_tag parameter to withdraw ' + code);\n          }\n        } else {\n          request['destination_tag'] = tag;\n        }\n      }\n    }\n\n    const response = await this.privatePostWithdrawCoin(this.extend(request, params));\n    return {\n      'info': response,\n      'id': response['response_data']['withdrawal']['id']\n    };\n  }\n\n  parseOHLCV(ohlcv, market = undefined) {\n    return [this.safeTimestamp(ohlcv, 'timestamp'), this.safeNumber(ohlcv, 'open'), this.safeNumber(ohlcv, 'high'), this.safeNumber(ohlcv, 'low'), this.safeNumber(ohlcv, 'close'), this.safeNumber(ohlcv, 'volume')];\n  }\n\n  async fetchOHLCV(symbol, timeframe = '5m', since = undefined, limit = undefined, params = {}) {\n    await this.loadMarkets();\n    const market = this.market(symbol);\n    const request = {\n      'precision': this.timeframes[timeframe],\n      'coin': market['id'].toLowerCase()\n    };\n\n    if (limit !== undefined && since !== undefined) {\n      request['from'] = parseInt(since / 1000);\n      request['to'] = this.sum(request['from'], limit * this.parseTimeframe(timeframe));\n    } else if (since !== undefined) {\n      request['from'] = parseInt(since / 1000);\n      request['to'] = this.sum(this.seconds(), 1);\n    } else if (limit !== undefined) {\n      request['to'] = this.seconds();\n      request['from'] = request['to'] - limit * this.parseTimeframe(timeframe);\n    }\n\n    const response = await this.v4PublicGetCoinCandle(this.extend(request, params));\n    const candles = this.safeValue(response, 'candles', []);\n    return this.parseOHLCVs(candles, market, timeframe, since, limit);\n  }\n\n  async fetchOrders(symbol = undefined, since = undefined, limit = undefined, params = {}) {\n    if (symbol === undefined) {\n      throw new ArgumentsRequired(this.id + ' fetchOrders () requires a symbol argument');\n    }\n\n    await this.loadMarkets();\n    const market = this.market(symbol);\n    const request = {\n      'coin_pair': market['id']\n    };\n    const response = await this.privatePostListOrders(this.extend(request, params));\n    const responseData = this.safeValue(response, 'response_data', {});\n    const orders = this.safeValue(responseData, 'orders', []);\n    return this.parseOrders(orders, market, since, limit);\n  }\n\n  async fetchOpenOrders(symbol = undefined, since = undefined, limit = undefined, params = {}) {\n    if (symbol === undefined) {\n      throw new ArgumentsRequired(this.id + ' fetchOpenOrders () requires a symbol argument');\n    }\n\n    await this.loadMarkets();\n    const market = this.market(symbol);\n    const request = {\n      'coin_pair': market['id'],\n      'status_list': '[2]' // open only\n\n    };\n    const response = await this.privatePostListOrders(this.extend(request, params));\n    const responseData = this.safeValue(response, 'response_data', {});\n    const orders = this.safeValue(responseData, 'orders', []);\n    return this.parseOrders(orders, market, since, limit);\n  }\n\n  async fetchMyTrades(symbol = undefined, since = undefined, limit = undefined, params = {}) {\n    if (symbol === undefined) {\n      throw new ArgumentsRequired(this.id + ' fetchMyTrades () requires a symbol argument');\n    }\n\n    await this.loadMarkets();\n    const market = this.market(symbol);\n    const request = {\n      'coin_pair': market['id'],\n      'has_fills': true\n    };\n    const response = await this.privatePostListOrders(this.extend(request, params));\n    const responseData = this.safeValue(response, 'response_data', {});\n    const ordersRaw = this.safeValue(responseData, 'orders', []);\n    const orders = this.parseOrders(ordersRaw, market, since, limit);\n    const trades = this.ordersToTrades(orders);\n    return this.filterBySymbolSinceLimit(trades, symbol, since, limit);\n  }\n\n  ordersToTrades(orders) {\n    const result = [];\n\n    for (let i = 0; i < orders.length; i++) {\n      const trades = this.safeValue(orders[i], 'trades', []);\n\n      for (let y = 0; y < trades.length; y++) {\n        result.push(trades[y]);\n      }\n    }\n\n    return result;\n  }\n\n  sign(path, api = 'public', method = 'GET', params = {}, headers = undefined, body = undefined) {\n    let url = this.urls['api'][api] + '/';\n    const query = this.omit(params, this.extractParams(path));\n\n    if (api === 'public' || api === 'v4Public') {\n      url += this.implodeParams(path, params);\n\n      if (Object.keys(query).length) {\n        url += '?' + this.urlencode(query);\n      }\n    } else {\n      this.checkRequiredCredentials();\n      url += this.version + '/';\n      const nonce = this.nonce();\n      body = this.urlencode(this.extend({\n        'tapi_method': path,\n        'tapi_nonce': nonce\n      }, params));\n      const auth = '/tapi/' + this.version + '/' + '?' + body;\n      headers = {\n        'Content-Type': 'application/x-www-form-urlencoded',\n        'TAPI-ID': this.apiKey,\n        'TAPI-MAC': this.hmac(this.encode(auth), this.encode(this.secret), 'sha512')\n      };\n    }\n\n    return {\n      'url': url,\n      'method': method,\n      'body': body,\n      'headers': headers\n    };\n  }\n\n  async request(path, api = 'public', method = 'GET', params = {}, headers = undefined, body = undefined) {\n    const response = await this.fetch2(path, api, method, params, headers, body);\n\n    if ('error_message' in response) {\n      throw new ExchangeError(this.id + ' ' + this.json(response));\n    }\n\n    return response;\n  }\n\n};","map":{"version":3,"sources":["C:/Users/James Price/Documents/VS Code/bixpro/node_modules/ccxt/js/mercado.js"],"names":["Exchange","require","ExchangeError","ArgumentsRequired","InvalidOrder","Precise","module","exports","mercado","describe","deepExtend","fetchMarkets","params","response","publicGetCoins","result","amountLimits","safeValue","options","i","length","coin","baseId","quoteId","base","safeCurrencyCode","quote","symbol","id","precision","priceLimit","push","undefined","safeNumber","parseNumber","fetchOrderBook","limit","loadMarkets","market","request","publicGetCoinOrderbook","extend","parseOrderBook","fetchTicker","publicGetCoinTicker","ticker","timestamp","safeTimestamp","last","iso8601","parseTrade","trade","safeTimestamp2","safeString2","type","side","safeString","priceString","amountString","price","amount","cost","stringMul","feeCost","fee","fetchTrades","since","method","parseInt","to","safeInteger","parseTrades","fetchBalance","privatePostGetAccountInfo","data","balances","currencyIds","Object","keys","currencyId","code","balance","account","parseBalance","createOrder","marketId","capitalize","priceToPrecision","amountToPrecision","toString","cancelOrder","privatePostCancelOrder","responseData","order","parseOrder","parseOrderStatus","status","statuses","order_type","safeMarket","average","filled","lastTradeTimestamp","rawTrades","trades","safeOrder","fetchOrder","privatePostGetOrder","withdraw","address","tag","checkAddress","currency","toFixed","account_ref","tx_fee","privatePostWithdrawCoin","parseOHLCV","ohlcv","fetchOHLCV","timeframe","timeframes","toLowerCase","sum","parseTimeframe","seconds","v4PublicGetCoinCandle","candles","parseOHLCVs","fetchOrders","privatePostListOrders","orders","parseOrders","fetchOpenOrders","fetchMyTrades","ordersRaw","ordersToTrades","filterBySymbolSinceLimit","y","sign","path","api","headers","body","url","urls","query","omit","extractParams","implodeParams","urlencode","checkRequiredCredentials","version","nonce","auth","apiKey","hmac","encode","secret","fetch2","json"],"mappings":"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","sourcesContent":["'use strict';\n\n//  ---------------------------------------------------------------------------\n\nconst Exchange = require ('./base/Exchange');\nconst { ExchangeError, ArgumentsRequired, InvalidOrder } = require ('./base/errors');\nconst Precise = require ('./base/Precise');\n\n//  ---------------------------------------------------------------------------\n\nmodule.exports = class mercado extends Exchange {\n    describe () {\n        return this.deepExtend (super.describe (), {\n            'id': 'mercado',\n            'name': 'Mercado Bitcoin',\n            'countries': [ 'BR' ], // Brazil\n            'rateLimit': 1000,\n            'version': 'v3',\n            'has': {\n                'cancelOrder': true,\n                'CORS': true,\n                'createMarketOrder': true,\n                'createOrder': true,\n                'fetchBalance': true,\n                'fetchMarkets': true,\n                'fetchMyTrades': 'emulated',\n                'fetchOHLCV': true,\n                'fetchOpenOrders': true,\n                'fetchOrder': true,\n                'fetchOrderBook': true,\n                'fetchOrders': true,\n                'fetchTicker': true,\n                'fetchTickers': false,\n                'fetchTrades': true,\n                'withdraw': true,\n            },\n            'timeframes': {\n                '1m': '1m',\n                '5m': '5m',\n                '15m': '15m',\n                '30m': '30m',\n                '1h': '1h',\n                '6h': '6h',\n                '12h': '12h',\n                '1d': '1d',\n                '3d': '3d',\n                '1w': '1w',\n                '2w': '2w',\n            },\n            'urls': {\n                'logo': 'https://user-images.githubusercontent.com/1294454/27837060-e7c58714-60ea-11e7-9192-f05e86adb83f.jpg',\n                'api': {\n                    'public': 'https://www.mercadobitcoin.net/api',\n                    'private': 'https://www.mercadobitcoin.net/tapi',\n                    'v4Public': 'https://www.mercadobitcoin.com.br/v4',\n                },\n                'www': 'https://www.mercadobitcoin.com.br',\n                'doc': [\n                    'https://www.mercadobitcoin.com.br/api-doc',\n                    'https://www.mercadobitcoin.com.br/trade-api',\n                ],\n            },\n            'api': {\n                'public': {\n                    'get': [\n                        'coins',\n                        '{coin}/orderbook/', // last slash critical\n                        '{coin}/ticker/',\n                        '{coin}/trades/',\n                        '{coin}/trades/{from}/',\n                        '{coin}/trades/{from}/{to}',\n                        '{coin}/day-summary/{year}/{month}/{day}/',\n                    ],\n                },\n                'private': {\n                    'post': [\n                        'cancel_order',\n                        'get_account_info',\n                        'get_order',\n                        'get_withdrawal',\n                        'list_system_messages',\n                        'list_orders',\n                        'list_orderbook',\n                        'place_buy_order',\n                        'place_sell_order',\n                        'place_market_buy_order',\n                        'place_market_sell_order',\n                        'withdraw_coin',\n                    ],\n                },\n                'v4Public': {\n                    'get': [\n                        '{coin}/candle/',\n                    ],\n                },\n            },\n            'fees': {\n                'trading': {\n                    'maker': 0.003,\n                    'taker': 0.007,\n                },\n            },\n            'options': {\n                'limits': {\n                    'BTC': 0.001,\n                    'BCH': 0.001,\n                    'ETH': 0.01,\n                    'LTC': 0.01,\n                    'XRP': 0.1,\n                },\n            },\n        });\n    }\n\n    async fetchMarkets (params = {}) {\n        const response = await this.publicGetCoins (params);\n        //\n        //     [\n        //         \"BCH\",\n        //         \"BTC\",\n        //         \"ETH\",\n        //         \"LTC\",\n        //         \"XRP\",\n        //         \"MBPRK01\",\n        //         \"MBPRK02\",\n        //         \"MBPRK03\",\n        //         \"MBPRK04\",\n        //         \"MBCONS01\",\n        //         \"USDC\",\n        //         \"WBX\",\n        //         \"CHZ\",\n        //         \"MBCONS02\",\n        //         \"PAXG\",\n        //         \"MBVASCO01\",\n        //         \"LINK\"\n        //     ]\n        //\n        const result = [];\n        const amountLimits = this.safeValue (this.options, 'limits', {});\n        for (let i = 0; i < response.length; i++) {\n            const coin = response[i];\n            const baseId = coin;\n            const quoteId = 'BRL';\n            const base = this.safeCurrencyCode (baseId);\n            const quote = this.safeCurrencyCode (quoteId);\n            const symbol = base + '/' + quote;\n            const id = quote + base;\n            const precision = {\n                'amount': 8,\n                'price': 5,\n            };\n            const priceLimit = '1e-5';\n            result.push ({\n                'id': id,\n                'symbol': symbol,\n                'base': base,\n                'quote': quote,\n                'baseId': baseId,\n                'quoteId': quoteId,\n                'active': undefined,\n                'info': coin,\n                'precision': precision,\n                'limits': {\n                    'amount': {\n                        'min': this.safeNumber (amountLimits, baseId),\n                        'max': undefined,\n                    },\n                    'price': {\n                        'min': this.parseNumber (priceLimit),\n                        'max': undefined,\n                    },\n                    'cost': {\n                        'min': undefined,\n                        'max': undefined,\n                    },\n                },\n            });\n        }\n        return result;\n    }\n\n    async fetchOrderBook (symbol, limit = undefined, params = {}) {\n        await this.loadMarkets ();\n        const market = this.market (symbol);\n        const request = {\n            'coin': market['base'],\n        };\n        const response = await this.publicGetCoinOrderbook (this.extend (request, params));\n        return this.parseOrderBook (response, symbol);\n    }\n\n    async fetchTicker (symbol, params = {}) {\n        await this.loadMarkets ();\n        const market = this.market (symbol);\n        const request = {\n            'coin': market['base'],\n        };\n        const response = await this.publicGetCoinTicker (this.extend (request, params));\n        const ticker = this.safeValue (response, 'ticker', {});\n        const timestamp = this.safeTimestamp (ticker, 'date');\n        const last = this.safeNumber (ticker, 'last');\n        return {\n            'symbol': symbol,\n            'timestamp': timestamp,\n            'datetime': this.iso8601 (timestamp),\n            'high': this.safeNumber (ticker, 'high'),\n            'low': this.safeNumber (ticker, 'low'),\n            'bid': this.safeNumber (ticker, 'buy'),\n            'bidVolume': undefined,\n            'ask': this.safeNumber (ticker, 'sell'),\n            'askVolume': undefined,\n            'vwap': undefined,\n            'open': undefined,\n            'close': last,\n            'last': last,\n            'previousClose': undefined,\n            'change': undefined,\n            'percentage': undefined,\n            'average': undefined,\n            'baseVolume': this.safeNumber (ticker, 'vol'),\n            'quoteVolume': undefined,\n            'info': ticker,\n        };\n    }\n\n    parseTrade (trade, market = undefined) {\n        const timestamp = this.safeTimestamp2 (trade, 'date', 'executed_timestamp');\n        let symbol = undefined;\n        if (market !== undefined) {\n            symbol = market['symbol'];\n        }\n        const id = this.safeString2 (trade, 'tid', 'operation_id');\n        const type = undefined;\n        const side = this.safeString (trade, 'type');\n        const priceString = this.safeString (trade, 'price');\n        const amountString = this.safeString2 (trade, 'amount', 'quantity');\n        const price = this.parseNumber (priceString);\n        const amount = this.parseNumber (amountString);\n        const cost = this.parseNumber (Precise.stringMul (priceString, amountString));\n        const feeCost = this.safeNumber (trade, 'fee_rate');\n        let fee = undefined;\n        if (feeCost !== undefined) {\n            fee = {\n                'cost': feeCost,\n                'currency': undefined,\n            };\n        }\n        return {\n            'id': id,\n            'info': trade,\n            'timestamp': timestamp,\n            'datetime': this.iso8601 (timestamp),\n            'symbol': symbol,\n            'order': undefined,\n            'type': type,\n            'side': side,\n            'takerOrMaker': undefined,\n            'price': price,\n            'amount': amount,\n            'cost': cost,\n            'fee': fee,\n        };\n    }\n\n    async fetchTrades (symbol, since = undefined, limit = undefined, params = {}) {\n        await this.loadMarkets ();\n        const market = this.market (symbol);\n        let method = 'publicGetCoinTrades';\n        const request = {\n            'coin': market['base'],\n        };\n        if (since !== undefined) {\n            method += 'From';\n            request['from'] = parseInt (since / 1000);\n        }\n        const to = this.safeInteger (params, 'to');\n        if (to !== undefined) {\n            method += 'To';\n        }\n        const response = await this[method] (this.extend (request, params));\n        return this.parseTrades (response, market, since, limit);\n    }\n\n    async fetchBalance (params = {}) {\n        await this.loadMarkets ();\n        const response = await this.privatePostGetAccountInfo (params);\n        const data = this.safeValue (response, 'response_data', {});\n        const balances = this.safeValue (data, 'balance', {});\n        const result = { 'info': response };\n        const currencyIds = Object.keys (balances);\n        for (let i = 0; i < currencyIds.length; i++) {\n            const currencyId = currencyIds[i];\n            const code = this.safeCurrencyCode (currencyId);\n            if (currencyId in balances) {\n                const balance = this.safeValue (balances, currencyId, {});\n                const account = this.account ();\n                account['free'] = this.safeString (balance, 'available');\n                account['total'] = this.safeString (balance, 'total');\n                result[code] = account;\n            }\n        }\n        return this.parseBalance (result, false);\n    }\n\n    async createOrder (symbol, type, side, amount, price = undefined, params = {}) {\n        await this.loadMarkets ();\n        const request = {\n            'coin_pair': this.marketId (symbol),\n        };\n        let method = this.capitalize (side) + 'Order';\n        if (type === 'limit') {\n            method = 'privatePostPlace' + method;\n            request['limit_price'] = this.priceToPrecision (symbol, price);\n            request['quantity'] = this.amountToPrecision (symbol, amount);\n        } else {\n            method = 'privatePostPlaceMarket' + method;\n            if (side === 'buy') {\n                if (price === undefined) {\n                    throw new InvalidOrder (this.id + ' createOrder() requires the price argument with market buy orders to calculate total order cost (amount to spend), where cost = amount * price. Supply a price argument to createOrder() call if you want the cost to be calculated for you from price and amount');\n                }\n                request['cost'] = this.priceToPrecision (symbol, amount * price);\n            } else {\n                request['quantity'] = this.amountToPrecision (symbol, amount);\n            }\n        }\n        const response = await this[method] (this.extend (request, params));\n        // TODO: replace this with a call to parseOrder for unification\n        return {\n            'info': response,\n            'id': response['response_data']['order']['order_id'].toString (),\n        };\n    }\n\n    async cancelOrder (id, symbol = undefined, params = {}) {\n        if (symbol === undefined) {\n            throw new ArgumentsRequired (this.id + ' cancelOrder () requires a symbol argument');\n        }\n        await this.loadMarkets ();\n        const market = this.market (symbol);\n        const request = {\n            'coin_pair': market['id'],\n            'order_id': id,\n        };\n        const response = await this.privatePostCancelOrder (this.extend (request, params));\n        //\n        //     {\n        //         response_data: {\n        //             order: {\n        //                 order_id: 2176769,\n        //                 coin_pair: 'BRLBCH',\n        //                 order_type: 2,\n        //                 status: 3,\n        //                 has_fills: false,\n        //                 quantity: '0.10000000',\n        //                 limit_price: '1996.15999',\n        //                 executed_quantity: '0.00000000',\n        //                 executed_price_avg: '0.00000',\n        //                 fee: '0.00000000',\n        //                 created_timestamp: '1536956488',\n        //                 updated_timestamp: '1536956499',\n        //                 operations: []\n        //             }\n        //         },\n        //         status_code: 100,\n        //         server_unix_timestamp: '1536956499'\n        //     }\n        //\n        const responseData = this.safeValue (response, 'response_data', {});\n        const order = this.safeValue (responseData, 'order', {});\n        return this.parseOrder (order, market);\n    }\n\n    parseOrderStatus (status) {\n        const statuses = {\n            '2': 'open',\n            '3': 'canceled',\n            '4': 'closed',\n        };\n        return this.safeString (statuses, status, status);\n    }\n\n    parseOrder (order, market = undefined) {\n        //\n        //     {\n        //         \"order_id\": 4,\n        //         \"coin_pair\": \"BRLBTC\",\n        //         \"order_type\": 1,\n        //         \"status\": 2,\n        //         \"has_fills\": true,\n        //         \"quantity\": \"2.00000000\",\n        //         \"limit_price\": \"900.00000\",\n        //         \"executed_quantity\": \"1.00000000\",\n        //         \"executed_price_avg\": \"900.00000\",\n        //         \"fee\": \"0.00300000\",\n        //         \"created_timestamp\": \"1453838494\",\n        //         \"updated_timestamp\": \"1453838494\",\n        //         \"operations\": [\n        //             {\n        //                 \"operation_id\": 1,\n        //                 \"quantity\": \"1.00000000\",\n        //                 \"price\": \"900.00000\",\n        //                 \"fee_rate\": \"0.30\",\n        //                 \"executed_timestamp\": \"1453838494\",\n        //             },\n        //         ],\n        //     }\n        //\n        const id = this.safeString (order, 'order_id');\n        const order_type = this.safeString (order, 'order_type');\n        let side = undefined;\n        if ('order_type' in order) {\n            side = (order_type === '1') ? 'buy' : 'sell';\n        }\n        const status = this.parseOrderStatus (this.safeString (order, 'status'));\n        const marketId = this.safeString (order, 'coin_pair');\n        market = this.safeMarket (marketId, market);\n        const timestamp = this.safeTimestamp (order, 'created_timestamp');\n        const fee = {\n            'cost': this.safeNumber (order, 'fee'),\n            'currency': market['quote'],\n        };\n        const price = this.safeNumber (order, 'limit_price');\n        // price = this.safeNumber (order, 'executed_price_avg', price);\n        const average = this.safeNumber (order, 'executed_price_avg');\n        const amount = this.safeNumber (order, 'quantity');\n        const filled = this.safeNumber (order, 'executed_quantity');\n        const lastTradeTimestamp = this.safeTimestamp (order, 'updated_timestamp');\n        const rawTrades = this.safeValue (order, 'operations', []);\n        const trades = this.parseTrades (rawTrades, market, undefined, undefined, {\n            'side': side,\n            'order': id,\n        });\n        return this.safeOrder ({\n            'info': order,\n            'id': id,\n            'clientOrderId': undefined,\n            'timestamp': timestamp,\n            'datetime': this.iso8601 (timestamp),\n            'lastTradeTimestamp': lastTradeTimestamp,\n            'symbol': market['symbol'],\n            'type': 'limit',\n            'timeInForce': undefined,\n            'postOnly': undefined,\n            'side': side,\n            'price': price,\n            'stopPrice': undefined,\n            'cost': undefined,\n            'average': average,\n            'amount': amount,\n            'filled': filled,\n            'remaining': undefined,\n            'status': status,\n            'fee': fee,\n            'trades': trades,\n        });\n    }\n\n    async fetchOrder (id, symbol = undefined, params = {}) {\n        if (symbol === undefined) {\n            throw new ArgumentsRequired (this.id + ' fetchOrder () requires a symbol argument');\n        }\n        await this.loadMarkets ();\n        const market = this.market (symbol);\n        const request = {\n            'coin_pair': market['id'],\n            'order_id': parseInt (id),\n        };\n        const response = await this.privatePostGetOrder (this.extend (request, params));\n        const responseData = this.safeValue (response, 'response_data', {});\n        const order = this.safeValue (responseData, 'order');\n        return this.parseOrder (order, market);\n    }\n\n    async withdraw (code, amount, address, tag = undefined, params = {}) {\n        this.checkAddress (address);\n        await this.loadMarkets ();\n        const currency = this.currency (code);\n        const request = {\n            'coin': currency['id'],\n            'quantity': amount.toFixed (10),\n            'address': address,\n        };\n        if (code === 'BRL') {\n            const account_ref = ('account_ref' in params);\n            if (!account_ref) {\n                throw new ArgumentsRequired (this.id + ' withdraw() requires account_ref parameter to withdraw ' + code);\n            }\n        } else if (code !== 'LTC') {\n            const tx_fee = ('tx_fee' in params);\n            if (!tx_fee) {\n                throw new ArgumentsRequired (this.id + ' withdraw() requires tx_fee parameter to withdraw ' + code);\n            }\n            if (code === 'XRP') {\n                if (tag === undefined) {\n                    if (!('destination_tag' in params)) {\n                        throw new ArgumentsRequired (this.id + ' withdraw() requires a tag argument or destination_tag parameter to withdraw ' + code);\n                    }\n                } else {\n                    request['destination_tag'] = tag;\n                }\n            }\n        }\n        const response = await this.privatePostWithdrawCoin (this.extend (request, params));\n        return {\n            'info': response,\n            'id': response['response_data']['withdrawal']['id'],\n        };\n    }\n\n    parseOHLCV (ohlcv, market = undefined) {\n        return [\n            this.safeTimestamp (ohlcv, 'timestamp'),\n            this.safeNumber (ohlcv, 'open'),\n            this.safeNumber (ohlcv, 'high'),\n            this.safeNumber (ohlcv, 'low'),\n            this.safeNumber (ohlcv, 'close'),\n            this.safeNumber (ohlcv, 'volume'),\n        ];\n    }\n\n    async fetchOHLCV (symbol, timeframe = '5m', since = undefined, limit = undefined, params = {}) {\n        await this.loadMarkets ();\n        const market = this.market (symbol);\n        const request = {\n            'precision': this.timeframes[timeframe],\n            'coin': market['id'].toLowerCase (),\n        };\n        if (limit !== undefined && since !== undefined) {\n            request['from'] = parseInt (since / 1000);\n            request['to'] = this.sum (request['from'], limit * this.parseTimeframe (timeframe));\n        } else if (since !== undefined) {\n            request['from'] = parseInt (since / 1000);\n            request['to'] = this.sum (this.seconds (), 1);\n        } else if (limit !== undefined) {\n            request['to'] = this.seconds ();\n            request['from'] = request['to'] - (limit * this.parseTimeframe (timeframe));\n        }\n        const response = await this.v4PublicGetCoinCandle (this.extend (request, params));\n        const candles = this.safeValue (response, 'candles', []);\n        return this.parseOHLCVs (candles, market, timeframe, since, limit);\n    }\n\n    async fetchOrders (symbol = undefined, since = undefined, limit = undefined, params = {}) {\n        if (symbol === undefined) {\n            throw new ArgumentsRequired (this.id + ' fetchOrders () requires a symbol argument');\n        }\n        await this.loadMarkets ();\n        const market = this.market (symbol);\n        const request = {\n            'coin_pair': market['id'],\n        };\n        const response = await this.privatePostListOrders (this.extend (request, params));\n        const responseData = this.safeValue (response, 'response_data', {});\n        const orders = this.safeValue (responseData, 'orders', []);\n        return this.parseOrders (orders, market, since, limit);\n    }\n\n    async fetchOpenOrders (symbol = undefined, since = undefined, limit = undefined, params = {}) {\n        if (symbol === undefined) {\n            throw new ArgumentsRequired (this.id + ' fetchOpenOrders () requires a symbol argument');\n        }\n        await this.loadMarkets ();\n        const market = this.market (symbol);\n        const request = {\n            'coin_pair': market['id'],\n            'status_list': '[2]', // open only\n        };\n        const response = await this.privatePostListOrders (this.extend (request, params));\n        const responseData = this.safeValue (response, 'response_data', {});\n        const orders = this.safeValue (responseData, 'orders', []);\n        return this.parseOrders (orders, market, since, limit);\n    }\n\n    async fetchMyTrades (symbol = undefined, since = undefined, limit = undefined, params = {}) {\n        if (symbol === undefined) {\n            throw new ArgumentsRequired (this.id + ' fetchMyTrades () requires a symbol argument');\n        }\n        await this.loadMarkets ();\n        const market = this.market (symbol);\n        const request = {\n            'coin_pair': market['id'],\n            'has_fills': true,\n        };\n        const response = await this.privatePostListOrders (this.extend (request, params));\n        const responseData = this.safeValue (response, 'response_data', {});\n        const ordersRaw = this.safeValue (responseData, 'orders', []);\n        const orders = this.parseOrders (ordersRaw, market, since, limit);\n        const trades = this.ordersToTrades (orders);\n        return this.filterBySymbolSinceLimit (trades, symbol, since, limit);\n    }\n\n    ordersToTrades (orders) {\n        const result = [];\n        for (let i = 0; i < orders.length; i++) {\n            const trades = this.safeValue (orders[i], 'trades', []);\n            for (let y = 0; y < trades.length; y++) {\n                result.push (trades[y]);\n            }\n        }\n        return result;\n    }\n\n    sign (path, api = 'public', method = 'GET', params = {}, headers = undefined, body = undefined) {\n        let url = this.urls['api'][api] + '/';\n        const query = this.omit (params, this.extractParams (path));\n        if (api === 'public' || (api === 'v4Public')) {\n            url += this.implodeParams (path, params);\n            if (Object.keys (query).length) {\n                url += '?' + this.urlencode (query);\n            }\n        } else {\n            this.checkRequiredCredentials ();\n            url += this.version + '/';\n            const nonce = this.nonce ();\n            body = this.urlencode (this.extend ({\n                'tapi_method': path,\n                'tapi_nonce': nonce,\n            }, params));\n            const auth = '/tapi/' + this.version + '/' + '?' + body;\n            headers = {\n                'Content-Type': 'application/x-www-form-urlencoded',\n                'TAPI-ID': this.apiKey,\n                'TAPI-MAC': this.hmac (this.encode (auth), this.encode (this.secret), 'sha512'),\n            };\n        }\n        return { 'url': url, 'method': method, 'body': body, 'headers': headers };\n    }\n\n    async request (path, api = 'public', method = 'GET', params = {}, headers = undefined, body = undefined) {\n        const response = await this.fetch2 (path, api, method, params, headers, body);\n        if ('error_message' in response) {\n            throw new ExchangeError (this.id + ' ' + this.json (response));\n        }\n        return response;\n    }\n};\n"]},"metadata":{},"sourceType":"script"}