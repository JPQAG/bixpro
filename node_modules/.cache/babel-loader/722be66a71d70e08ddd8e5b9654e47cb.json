{"ast":null,"code":"'use strict'; //  ---------------------------------------------------------------------------\n\nconst Exchange = require('./base/Exchange');\n\nconst {\n  TICK_SIZE\n} = require('./base/functions/number');\n\nconst {\n  ExchangeError,\n  ArgumentsRequired,\n  InvalidNonce,\n  OrderNotFound,\n  InvalidOrder,\n  InsufficientFunds,\n  AuthenticationError,\n  DDoSProtection,\n  NotSupported,\n  BadSymbol\n} = require('./base/errors');\n\nconst Precise = require('./base/Precise'); //  ---------------------------------------------------------------------------\n\n\nmodule.exports = class liquid extends Exchange {\n  describe() {\n    return this.deepExtend(super.describe(), {\n      'id': 'liquid',\n      'name': 'Liquid',\n      'countries': ['JP', 'CN', 'TW'],\n      'version': '2',\n      'rateLimit': 1000,\n      'has': {\n        'cancelOrder': true,\n        'CORS': false,\n        'createOrder': true,\n        'editOrder': true,\n        'fetchBalance': true,\n        'fetchClosedOrders': true,\n        'fetchCurrencies': true,\n        'fetchMarkets': true,\n        'fetchMyTrades': true,\n        'fetchOpenOrders': true,\n        'fetchOrder': true,\n        'fetchOrderBook': true,\n        'fetchOrders': true,\n        'fetchTicker': true,\n        'fetchTickers': true,\n        'fetchTrades': true,\n        'withdraw': true\n      },\n      'urls': {\n        'logo': 'https://user-images.githubusercontent.com/1294454/45798859-1a872600-bcb4-11e8-8746-69291ce87b04.jpg',\n        'api': 'https://api.liquid.com',\n        'www': 'https://www.liquid.com',\n        'doc': ['https://developers.liquid.com'],\n        'fees': 'https://help.liquid.com/getting-started-with-liquid/the-platform/fee-structure',\n        'referral': 'https://www.liquid.com/sign-up/?affiliate=SbzC62lt30976'\n      },\n      'api': {\n        'public': {\n          'get': ['currencies', 'products', 'products/{id}', 'products/{id}/price_levels', 'executions', 'ir_ladders/{currency}', 'fees' // add fetchFees, fetchTradingFees, fetchFundingFees\n          ]\n        },\n        'private': {\n          'get': ['accounts', // undocumented https://github.com/ccxt/ccxt/pull/7493\n          'accounts/balance', 'accounts/main_asset', 'accounts/{id}', 'accounts/{currency}/reserved_balance_details', 'crypto_accounts', // add fetchAccounts\n          'crypto_withdrawals', // add fetchWithdrawals\n          'executions/me', 'fiat_accounts', // add fetchAccounts\n          'fund_infos', // add fetchDeposits\n          'loan_bids', 'loans', 'orders', 'orders/{id}', 'orders/{id}/trades', // add fetchOrderTrades\n          'trades', 'trades/{id}/loans', 'trading_accounts', 'trading_accounts/{id}', 'transactions', 'withdrawals' // add fetchWithdrawals\n          ],\n          'post': ['crypto_withdrawals', 'fund_infos', 'fiat_accounts', 'loan_bids', 'orders', 'withdrawals'],\n          'put': ['crypto_withdrawal/{id}/cancel', 'loan_bids/{id}/close', 'loans/{id}', 'orders/{id}', // add editOrder\n          'orders/{id}/cancel', 'trades/{id}', 'trades/{id}/adjust_margin', 'trades/{id}/close', 'trades/close_all', 'trading_accounts/{id}', 'withdrawals/{id}/cancel']\n        }\n      },\n      'fees': {\n        'trading': {\n          'tierBased': true,\n          'percentage': true,\n          'taker': 0.0030,\n          'maker': 0.0000,\n          'tiers': {\n            'perpetual': {\n              'maker': [[0, 0.0000], [25000, 0.0000], [50000, -0.00025], [100000, -0.00025], [1000000, -0.00025], [10000000, -0.00025], [25000000, -0.00025], [50000000, -0.00025], [75000000, -0.00025], [100000000, -0.00025], [200000000, -0.00025], [300000000, -0.00025]],\n              'taker': [[0, 0.00120], [25000, 0.00115], [50000, 0.00110], [100000, 0.00105], [1000000, 0.00100], [10000000, 0.00095], [25000000, 0.00090], [50000000, 0.00085], [75000000, 0.00080], [100000000, 0.00075], [200000000, 0.00070], [300000000, 0.00065]]\n            },\n            'spot': {\n              'taker': [[0, 0.003], [10000, 0.0029], [20000, 0.0028], [50000, 0.0026], [100000, 0.0020], [1000000, 0.0016], [5000000, 0.0012], [10000000, 0.0010], [25000000, 0.0009], [50000000, 0.0008], [100000000, 0.0007], [200000000, 0.0006], [500000000, 0.0004], [1000000000, 0.0003]],\n              'maker': [[0, 0.0000], [10000, 0.0020], [20000, 0.0019], [50000, 0.0018], [100000, 0.0016], [1000000, 0.0008], [5000000, 0.0007], [10000000, 0.0005], [25000000, 0.0000], [50000000, 0.0000], [100000000, 0.0000], [200000000, 0.0000], [500000000, 0.0000], [1000000000, 0.0000]]\n            }\n          }\n        }\n      },\n      'precisionMode': TICK_SIZE,\n      'exceptions': {\n        'API rate limit exceeded. Please retry after 300s': DDoSProtection,\n        'API Authentication failed': AuthenticationError,\n        'Nonce is too small': InvalidNonce,\n        'Order not found': OrderNotFound,\n        'Can not update partially filled order': InvalidOrder,\n        'Can not update non-live order': OrderNotFound,\n        'not_enough_free_balance': InsufficientFunds,\n        'must_be_positive': InvalidOrder,\n        'less_than_order_size': InvalidOrder,\n        'price_too_high': InvalidOrder,\n        'price_too_small': InvalidOrder,\n        // {\"errors\":{\"order\":[\"price_too_small\"]}}\n        'product_disabled': BadSymbol // {\"errors\":{\"order\":[\"product_disabled\"]}}\n\n      },\n      'commonCurrencies': {\n        'WIN': 'WCOIN',\n        'HOT': 'HOT Token',\n        'MIOTA': 'IOTA' // https://github.com/ccxt/ccxt/issues/7487\n\n      },\n      'options': {\n        'cancelOrderException': true\n      }\n    });\n  }\n\n  async fetchCurrencies(params = {}) {\n    const response = await this.publicGetCurrencies(params); //\n    //     [\n    //         {\n    //             currency_type: 'fiat',\n    //             currency: 'USD',\n    //             symbol: '$',\n    //             assets_precision: 2,\n    //             quoting_precision: 5,\n    //             minimum_withdrawal: '15.0',\n    //             withdrawal_fee: 5,\n    //             minimum_fee: null,\n    //             minimum_order_quantity: null,\n    //             display_precision: 2,\n    //             depositable: true,\n    //             withdrawable: true,\n    //             discount_fee: 0.5,\n    //         },\n    //     ]\n    //\n\n    const result = {};\n\n    for (let i = 0; i < response.length; i++) {\n      const currency = response[i];\n      const id = this.safeString(currency, 'currency');\n      const code = this.safeCurrencyCode(id);\n      const active = currency['depositable'] && currency['withdrawable'];\n      const amountPrecision = this.safeInteger(currency, 'assets_precision');\n      result[code] = {\n        'id': id,\n        'code': code,\n        'info': currency,\n        'name': code,\n        'active': active,\n        'fee': this.safeNumber(currency, 'withdrawal_fee'),\n        'precision': amountPrecision,\n        'limits': {\n          'amount': {\n            'min': Math.pow(10, -amountPrecision),\n            'max': Math.pow(10, amountPrecision)\n          },\n          'withdraw': {\n            'min': this.safeNumber(currency, 'minimum_withdrawal'),\n            'max': undefined\n          }\n        }\n      };\n    }\n\n    return result;\n  }\n\n  async fetchMarkets(params = {}) {\n    const spot = await this.publicGetProducts(params); //\n    //     [\n    //         {\n    //             \"id\":\"637\",\n    //             \"product_type\":\"CurrencyPair\",\n    //             \"code\":\"CASH\",\n    //             \"name\":null,\n    //             \"market_ask\":\"0.00000797\",\n    //             \"market_bid\":\"0.00000727\",\n    //             \"indicator\":null,\n    //             \"currency\":\"BTC\",\n    //             \"currency_pair_code\":\"TFTBTC\",\n    //             \"symbol\":null,\n    //             \"btc_minimum_withdraw\":null,\n    //             \"fiat_minimum_withdraw\":null,\n    //             \"pusher_channel\":\"product_cash_tftbtc_637\",\n    //             \"taker_fee\":\"0.0\",\n    //             \"maker_fee\":\"0.0\",\n    //             \"low_market_bid\":\"0.00000685\",\n    //             \"high_market_ask\":\"0.00000885\",\n    //             \"volume_24h\":\"3696.0755956\",\n    //             \"last_price_24h\":\"0.00000716\",\n    //             \"last_traded_price\":\"0.00000766\",\n    //             \"last_traded_quantity\":\"1748.0377978\",\n    //             \"average_price\":null,\n    //             \"quoted_currency\":\"BTC\",\n    //             \"base_currency\":\"TFT\",\n    //             \"tick_size\":\"0.00000001\",\n    //             \"disabled\":false,\n    //             \"margin_enabled\":false,\n    //             \"cfd_enabled\":false,\n    //             \"perpetual_enabled\":false,\n    //             \"last_event_timestamp\":\"1596962820.000797146\",\n    //             \"timestamp\":\"1596962820.000797146\",\n    //             \"multiplier_up\":\"9.0\",\n    //             \"multiplier_down\":\"0.1\",\n    //             \"average_time_interval\":null\n    //         },\n    //     ]\n    //\n\n    const perpetual = await this.publicGetProducts({\n      'perpetual': '1'\n    }); //\n    //     [\n    //         {\n    //             \"id\":\"604\",\n    //             \"product_type\":\"Perpetual\",\n    //             \"code\":\"CASH\",\n    //             \"name\":null,\n    //             \"market_ask\":\"11721.5\",\n    //             \"market_bid\":\"11719.0\",\n    //             \"indicator\":null,\n    //             \"currency\":\"USD\",\n    //             \"currency_pair_code\":\"P-BTCUSD\",\n    //             \"symbol\":\"$\",\n    //             \"btc_minimum_withdraw\":null,\n    //             \"fiat_minimum_withdraw\":null,\n    //             \"pusher_channel\":\"product_cash_p-btcusd_604\",\n    //             \"taker_fee\":\"0.0012\",\n    //             \"maker_fee\":\"0.0\",\n    //             \"low_market_bid\":\"11624.5\",\n    //             \"high_market_ask\":\"11859.0\",\n    //             \"volume_24h\":\"0.271\",\n    //             \"last_price_24h\":\"11621.5\",\n    //             \"last_traded_price\":\"11771.5\",\n    //             \"last_traded_quantity\":\"0.09\",\n    //             \"average_price\":\"11771.5\",\n    //             \"quoted_currency\":\"USD\",\n    //             \"base_currency\":\"P-BTC\",\n    //             \"tick_size\":\"0.5\",\n    //             \"disabled\":false,\n    //             \"margin_enabled\":false,\n    //             \"cfd_enabled\":false,\n    //             \"perpetual_enabled\":true,\n    //             \"last_event_timestamp\":\"1596963309.418853092\",\n    //             \"timestamp\":\"1596963309.418853092\",\n    //             \"multiplier_up\":null,\n    //             \"multiplier_down\":\"0.1\",\n    //             \"average_time_interval\":300,\n    //             \"index_price\":\"11682.8124\",\n    //             \"mark_price\":\"11719.96781\",\n    //             \"funding_rate\":\"0.00273\",\n    //             \"fair_price\":\"11720.2745\"\n    //         },\n    //     ]\n    //\n\n    const currencies = await this.fetchCurrencies();\n    const currenciesByCode = this.indexBy(currencies, 'code');\n    const result = [];\n    const markets = this.arrayConcat(spot, perpetual);\n\n    for (let i = 0; i < markets.length; i++) {\n      const market = markets[i];\n      const id = this.safeString(market, 'id');\n      const baseId = this.safeString(market, 'base_currency');\n      const quoteId = this.safeString(market, 'quoted_currency');\n      const productType = this.safeString(market, 'product_type');\n      let type = 'spot';\n      let spot = true;\n      let swap = false;\n\n      if (productType === 'Perpetual') {\n        spot = false;\n        swap = true;\n        type = 'swap';\n      }\n\n      const base = this.safeCurrencyCode(baseId);\n      const quote = this.safeCurrencyCode(quoteId);\n      let symbol = undefined;\n\n      if (swap) {\n        symbol = this.safeString(market, 'currency_pair_code');\n      } else {\n        symbol = base + '/' + quote;\n      }\n\n      let maker = this.fees['trading']['maker'];\n      let taker = this.fees['trading']['taker'];\n\n      if (type === 'swap') {\n        maker = this.safeNumber(market, 'maker_fee', this.fees['trading']['maker']);\n        taker = this.safeNumber(market, 'taker_fee', this.fees['trading']['taker']);\n      }\n\n      const disabled = this.safeValue(market, 'disabled', false);\n      const active = !disabled;\n      const baseCurrency = this.safeValue(currenciesByCode, base);\n      const precision = {\n        'amount': 0.00000001,\n        'price': this.safeNumber(market, 'tick_size')\n      };\n      let minAmount = undefined;\n\n      if (baseCurrency !== undefined) {\n        minAmount = this.safeNumber(baseCurrency['info'], 'minimum_order_quantity');\n      }\n\n      const lastPrice = this.safeNumber(market, 'last_traded_price');\n      let minPrice = undefined;\n      let maxPrice = undefined;\n\n      if (lastPrice) {\n        const multiplierDown = this.safeNumber(market, 'multiplier_down');\n        const multiplierUp = this.safeNumber(market, 'multiplier_up');\n\n        if (multiplierDown !== undefined) {\n          minPrice = lastPrice * multiplierDown;\n        }\n\n        if (multiplierUp !== undefined) {\n          maxPrice = lastPrice * multiplierUp;\n        }\n      }\n\n      const limits = {\n        'amount': {\n          'min': minAmount,\n          'max': undefined\n        },\n        'price': {\n          'min': minPrice,\n          'max': maxPrice\n        },\n        'cost': {\n          'min': undefined,\n          'max': undefined\n        }\n      };\n      result.push({\n        'id': id,\n        'symbol': symbol,\n        'base': base,\n        'quote': quote,\n        'baseId': baseId,\n        'quoteId': quoteId,\n        'type': type,\n        'spot': spot,\n        'swap': swap,\n        'maker': maker,\n        'taker': taker,\n        'limits': limits,\n        'precision': precision,\n        'active': active,\n        'info': market\n      });\n    }\n\n    return result;\n  }\n\n  async fetchBalance(params = {}) {\n    await this.loadMarkets();\n    const response = await this.privateGetAccounts(params); //\n    //     {\n    //         crypto_accounts: [\n    //             {\n    //                 id: 2221179,\n    //                 currency: 'USDT',\n    //                 balance: '0.0',\n    //                 reserved_balance: '0.0',\n    //                 pusher_channel: 'user_xxxxx_account_usdt',\n    //                 lowest_offer_interest_rate: null,\n    //                 highest_offer_interest_rate: null,\n    //                 address: '0',\n    //                 currency_symbol: 'USDT',\n    //                 minimum_withdraw: null,\n    //                 currency_type: 'crypto'\n    //             },\n    //         ],\n    //         fiat_accounts: [\n    //             {\n    //                 id: 1112734,\n    //                 currency: 'USD',\n    //                 balance: '0.0',\n    //                 reserved_balance: '0.0',\n    //                 pusher_channel: 'user_xxxxx_account_usd',\n    //                 lowest_offer_interest_rate: null,\n    //                 highest_offer_interest_rate: null,\n    //                 currency_symbol: '$',\n    //                 send_to_btc_address: null,\n    //                 exchange_rate: '1.0',\n    //                 currency_type: 'fiat'\n    //             }\n    //         ]\n    //     }\n    //\n\n    const result = {\n      'info': response,\n      'timestamp': undefined,\n      'datetime': undefined\n    };\n    const crypto = this.safeValue(response, 'crypto_accounts', []);\n    const fiat = this.safeValue(response, 'fiat_accounts', []);\n\n    for (let i = 0; i < crypto.length; i++) {\n      const balance = crypto[i];\n      const currencyId = this.safeString(balance, 'currency');\n      const code = this.safeCurrencyCode(currencyId);\n      const account = this.account();\n      account['total'] = this.safeString(balance, 'balance');\n      account['used'] = this.safeString(balance, 'reserved_balance');\n      result[code] = account;\n    }\n\n    for (let i = 0; i < fiat.length; i++) {\n      const balance = fiat[i];\n      const currencyId = this.safeString(balance, 'currency');\n      const code = this.safeCurrencyCode(currencyId);\n      const account = this.account();\n      account['total'] = this.safeString(balance, 'balance');\n      account['used'] = this.safeString(balance, 'reserved_balance');\n      result[code] = account;\n    }\n\n    return this.parseBalance(result, false);\n  }\n\n  async fetchOrderBook(symbol, limit = undefined, params = {}) {\n    await this.loadMarkets();\n    const request = {\n      'id': this.marketId(symbol)\n    };\n    const response = await this.publicGetProductsIdPriceLevels(this.extend(request, params));\n    return this.parseOrderBook(response, symbol, undefined, 'buy_price_levels', 'sell_price_levels');\n  }\n\n  parseTicker(ticker, market = undefined) {\n    const timestamp = this.milliseconds();\n    let last = undefined;\n\n    if ('last_traded_price' in ticker) {\n      if (ticker['last_traded_price']) {\n        const length = ticker['last_traded_price'].length;\n\n        if (length > 0) {\n          last = this.safeNumber(ticker, 'last_traded_price');\n        }\n      }\n    }\n\n    let symbol = undefined;\n\n    if (market === undefined) {\n      const marketId = this.safeString(ticker, 'id');\n\n      if (marketId in this.markets_by_id) {\n        market = this.markets_by_id[marketId];\n      } else {\n        const baseId = this.safeString(ticker, 'base_currency');\n        const quoteId = this.safeString(ticker, 'quoted_currency');\n\n        if (symbol in this.markets) {\n          market = this.markets[symbol];\n        } else {\n          symbol = this.safeCurrencyCode(baseId) + '/' + this.safeCurrencyCode(quoteId);\n        }\n      }\n    }\n\n    if (market !== undefined) {\n      symbol = market['symbol'];\n    }\n\n    let change = undefined;\n    let percentage = undefined;\n    let average = undefined;\n    const open = this.safeNumber(ticker, 'last_price_24h');\n\n    if (open !== undefined && last !== undefined) {\n      change = last - open;\n      average = this.sum(last, open) / 2;\n\n      if (open > 0) {\n        percentage = change / open * 100;\n      }\n    }\n\n    return {\n      'symbol': symbol,\n      'timestamp': timestamp,\n      'datetime': this.iso8601(timestamp),\n      'high': this.safeNumber(ticker, 'high_market_ask'),\n      'low': this.safeNumber(ticker, 'low_market_bid'),\n      'bid': this.safeNumber(ticker, 'market_bid'),\n      'bidVolume': undefined,\n      'ask': this.safeNumber(ticker, 'market_ask'),\n      'askVolume': undefined,\n      'vwap': undefined,\n      'open': open,\n      'close': last,\n      'last': last,\n      'previousClose': undefined,\n      'change': change,\n      'percentage': percentage,\n      'average': average,\n      'baseVolume': this.safeNumber(ticker, 'volume_24h'),\n      'quoteVolume': undefined,\n      'info': ticker\n    };\n  }\n\n  async fetchTickers(symbols = undefined, params = {}) {\n    await this.loadMarkets();\n    const response = await this.publicGetProducts(params);\n    const result = {};\n\n    for (let i = 0; i < response.length; i++) {\n      const ticker = this.parseTicker(response[i]);\n      const symbol = ticker['symbol'];\n      result[symbol] = ticker;\n    }\n\n    return this.filterByArray(result, 'symbol', symbols);\n  }\n\n  async fetchTicker(symbol, params = {}) {\n    await this.loadMarkets();\n    const market = this.market(symbol);\n    const request = {\n      'id': market['id']\n    };\n    const response = await this.publicGetProductsId(this.extend(request, params));\n    return this.parseTicker(response, market);\n  }\n\n  parseTrade(trade, market = undefined) {\n    // {             id:  12345,\n    //         quantity: \"6.789\",\n    //            price: \"98765.4321\",\n    //       taker_side: \"sell\",\n    //       created_at:  1512345678,\n    //          my_side: \"buy\"           }\n    const timestamp = this.safeTimestamp(trade, 'created_at');\n    const orderId = this.safeString(trade, 'order_id'); // 'taker_side' gets filled for both fetchTrades and fetchMyTrades\n\n    const takerSide = this.safeString(trade, 'taker_side'); // 'my_side' gets filled for fetchMyTrades only and may differ from 'taker_side'\n\n    const mySide = this.safeString(trade, 'my_side');\n    const side = mySide !== undefined ? mySide : takerSide;\n    let takerOrMaker = undefined;\n\n    if (mySide !== undefined) {\n      takerOrMaker = takerSide === mySide ? 'taker' : 'maker';\n    }\n\n    const priceString = this.safeString(trade, 'price');\n    const amountString = this.safeString(trade, 'quantity');\n    const price = this.parseNumber(priceString);\n    const amount = this.parseNumber(amountString);\n    const cost = this.parseNumber(Precise.stringMul(priceString, amountString));\n    const id = this.safeString(trade, 'id');\n    let symbol = undefined;\n\n    if (market !== undefined) {\n      symbol = market['symbol'];\n    }\n\n    return {\n      'info': trade,\n      'id': id,\n      'order': orderId,\n      'timestamp': timestamp,\n      'datetime': this.iso8601(timestamp),\n      'symbol': symbol,\n      'type': undefined,\n      'side': side,\n      'takerOrMaker': takerOrMaker,\n      'price': price,\n      'amount': amount,\n      'cost': cost,\n      'fee': undefined\n    };\n  }\n\n  async fetchTrades(symbol, since = undefined, limit = undefined, params = {}) {\n    await this.loadMarkets();\n    const market = this.market(symbol);\n    const request = {\n      'product_id': market['id']\n    };\n\n    if (limit !== undefined) {\n      request['limit'] = limit;\n    }\n\n    if (since !== undefined) {\n      // timestamp should be in seconds, whereas we use milliseconds in since and everywhere\n      request['timestamp'] = parseInt(since / 1000);\n    }\n\n    const response = await this.publicGetExecutions(this.extend(request, params));\n    const result = since !== undefined ? response : response['models'];\n    return this.parseTrades(result, market, since, limit);\n  }\n\n  async fetchMyTrades(symbol = undefined, since = undefined, limit = undefined, params = {}) {\n    await this.loadMarkets();\n    const market = this.market(symbol); // the `with_details` param is undocumented - it adds the order_id to the results\n\n    const request = {\n      'product_id': market['id'],\n      'with_details': true\n    };\n\n    if (limit !== undefined) {\n      request['limit'] = limit;\n    }\n\n    const response = await this.privateGetExecutionsMe(this.extend(request, params));\n    return this.parseTrades(response['models'], market, since, limit);\n  }\n\n  async createOrder(symbol, type, side, amount, price = undefined, params = {}) {\n    await this.loadMarkets();\n    const clientOrderId = this.safeString2(params, 'clientOrderId', 'client_order_id');\n    params = this.omit(params, ['clientOrderId', 'client_order_id']);\n    const request = {\n      'order_type': type,\n      'product_id': this.marketId(symbol),\n      'side': side,\n      'quantity': this.amountToPrecision(symbol, amount)\n    };\n\n    if (clientOrderId !== undefined) {\n      request['client_order_id'] = clientOrderId;\n    }\n\n    if (type === 'limit' || type === 'limit_post_only' || type === 'market_with_range' || type === 'stop') {\n      request['price'] = this.priceToPrecision(symbol, price);\n    }\n\n    const response = await this.privatePostOrders(this.extend(request, params)); //\n    //     {\n    //         \"id\": 2157474,\n    //         \"order_type\": \"limit\",\n    //         \"quantity\": \"0.01\",\n    //         \"disc_quantity\": \"0.0\",\n    //         \"iceberg_total_quantity\": \"0.0\",\n    //         \"side\": \"sell\",\n    //         \"filled_quantity\": \"0.0\",\n    //         \"price\": \"500.0\",\n    //         \"created_at\": 1462123639,\n    //         \"updated_at\": 1462123639,\n    //         \"status\": \"live\",\n    //         \"leverage_level\": 1,\n    //         \"source_exchange\": \"QUOINE\",\n    //         \"product_id\": 1,\n    //         \"product_code\": \"CASH\",\n    //         \"funding_currency\": \"USD\",\n    //         \"currency_pair_code\": \"BTCUSD\",\n    //         \"order_fee\": \"0.0\",\n    //         \"client_order_id\": null,\n    //     }\n    //\n\n    return this.parseOrder(response);\n  }\n\n  async cancelOrder(id, symbol = undefined, params = {}) {\n    await this.loadMarkets();\n    const request = {\n      'id': id\n    };\n    const response = await this.privatePutOrdersIdCancel(this.extend(request, params));\n    const order = this.parseOrder(response);\n\n    if (order['status'] === 'closed') {\n      if (this.options['cancelOrderException']) {\n        throw new OrderNotFound(this.id + ' order closed already: ' + this.json(response));\n      }\n    }\n\n    return order;\n  }\n\n  async editOrder(id, symbol, type, side, amount, price = undefined, params = {}) {\n    await this.loadMarkets();\n\n    if (price === undefined) {\n      throw new ArgumentsRequired(this.id + ' editOrder() requires the price argument');\n    }\n\n    const request = {\n      'order': {\n        'quantity': this.amountToPrecision(symbol, amount),\n        'price': this.priceToPrecision(symbol, price)\n      },\n      'id': id\n    };\n    const response = await this.privatePutOrdersId(this.extend(request, params));\n    return this.parseOrder(response);\n  }\n\n  parseOrderStatus(status) {\n    const statuses = {\n      'live': 'open',\n      'filled': 'closed',\n      'cancelled': 'canceled'\n    };\n    return this.safeString(statuses, status, status);\n  }\n\n  parseOrder(order, market = undefined) {\n    //\n    // createOrder\n    //\n    //     {\n    //         \"id\": 2157474,\n    //         \"order_type\": \"limit\",\n    //         \"quantity\": \"0.01\",\n    //         \"disc_quantity\": \"0.0\",\n    //         \"iceberg_total_quantity\": \"0.0\",\n    //         \"side\": \"sell\",\n    //         \"filled_quantity\": \"0.0\",\n    //         \"price\": \"500.0\",\n    //         \"created_at\": 1462123639,\n    //         \"updated_at\": 1462123639,\n    //         \"status\": \"live\",\n    //         \"leverage_level\": 1,\n    //         \"source_exchange\": \"QUOINE\",\n    //         \"product_id\": 1,\n    //         \"product_code\": \"CASH\",\n    //         \"funding_currency\": \"USD\",\n    //         \"currency_pair_code\": \"BTCUSD\",\n    //         \"order_fee\": \"0.0\"\n    //         \"client_order_id\": null,\n    //     }\n    //\n    // fetchOrder, fetchOrders, fetchOpenOrders, fetchClosedOrders\n    //\n    //     {\n    //         \"id\": 2157479,\n    //         \"order_type\": \"limit\",\n    //         \"quantity\": \"0.01\",\n    //         \"disc_quantity\": \"0.0\",\n    //         \"iceberg_total_quantity\": \"0.0\",\n    //         \"side\": \"sell\",\n    //         \"filled_quantity\": \"0.01\",\n    //         \"price\": \"500.0\",\n    //         \"created_at\": 1462123639,\n    //         \"updated_at\": 1462123639,\n    //         \"status\": \"filled\",\n    //         \"leverage_level\": 2,\n    //         \"source_exchange\": \"QUOINE\",\n    //         \"product_id\": 1,\n    //         \"product_code\": \"CASH\",\n    //         \"funding_currency\": \"USD\",\n    //         \"currency_pair_code\": \"BTCUSD\",\n    //         \"order_fee\": \"0.0\",\n    //         \"executions\": [\n    //             {\n    //                 \"id\": 4566133,\n    //                 \"quantity\": \"0.01\",\n    //                 \"price\": \"500.0\",\n    //                 \"taker_side\": \"buy\",\n    //                 \"my_side\": \"sell\",\n    //                 \"created_at\": 1465396785\n    //             }\n    //         ]\n    //     }\n    //\n    const orderId = this.safeString(order, 'id');\n    const timestamp = this.safeTimestamp(order, 'created_at');\n    const marketId = this.safeString(order, 'product_id');\n    market = this.safeValue(this.markets_by_id, marketId);\n    const status = this.parseOrderStatus(this.safeString(order, 'status'));\n    const amount = this.safeNumber(order, 'quantity');\n    let filled = this.safeNumber(order, 'filled_quantity');\n    const price = this.safeNumber(order, 'price');\n    let symbol = undefined;\n    let feeCurrency = undefined;\n\n    if (market !== undefined) {\n      symbol = market['symbol'];\n      feeCurrency = market['quote'];\n    }\n\n    const type = this.safeString(order, 'order_type');\n    let tradeCost = 0;\n    let tradeFilled = 0;\n    let average = this.safeNumber(order, 'average_price');\n    const trades = this.parseTrades(this.safeValue(order, 'executions', []), market, undefined, undefined, {\n      'order': orderId,\n      'type': type\n    });\n    const numTrades = trades.length;\n\n    for (let i = 0; i < numTrades; i++) {\n      // php copies values upon assignment, but not references them\n      // todo rewrite this (shortly)\n      const trade = trades[i];\n      trade['order'] = orderId;\n      trade['type'] = type;\n      tradeFilled = this.sum(tradeFilled, trade['amount']);\n      tradeCost = this.sum(tradeCost, trade['cost']);\n    }\n\n    let cost = undefined;\n    let lastTradeTimestamp = undefined;\n\n    if (numTrades > 0) {\n      lastTradeTimestamp = trades[numTrades - 1]['timestamp'];\n\n      if (!average && tradeFilled > 0) {\n        average = tradeCost / tradeFilled;\n      }\n\n      if (cost === undefined) {\n        cost = tradeCost;\n      }\n\n      if (filled === undefined) {\n        filled = tradeFilled;\n      }\n    }\n\n    let remaining = undefined;\n\n    if (amount !== undefined && filled !== undefined) {\n      remaining = amount - filled;\n    }\n\n    const side = this.safeString(order, 'side');\n    const clientOrderId = this.safeString(order, 'client_order_id');\n    return {\n      'id': orderId,\n      'clientOrderId': clientOrderId,\n      'timestamp': timestamp,\n      'datetime': this.iso8601(timestamp),\n      'lastTradeTimestamp': lastTradeTimestamp,\n      'type': type,\n      'timeInForce': undefined,\n      'postOnly': undefined,\n      'status': status,\n      'symbol': symbol,\n      'side': side,\n      'price': price,\n      'stopPrice': undefined,\n      'amount': amount,\n      'filled': filled,\n      'cost': cost,\n      'remaining': remaining,\n      'average': average,\n      'trades': trades,\n      'fee': {\n        'currency': feeCurrency,\n        'cost': this.safeNumber(order, 'order_fee')\n      },\n      'info': order\n    };\n  }\n\n  async fetchOrder(id, symbol = undefined, params = {}) {\n    await this.loadMarkets();\n    const request = {\n      'id': id\n    };\n    const response = await this.privateGetOrdersId(this.extend(request, params));\n    return this.parseOrder(response);\n  }\n\n  async fetchOrders(symbol = undefined, since = undefined, limit = undefined, params = {}) {\n    await this.loadMarkets();\n    let market = undefined;\n    const request = {\n      // 'funding_currency': market['quoteId'], // filter orders based on \"funding\" currency (quote currency)\n      // 'product_id': market['id'],\n      // 'status': 'live', // 'filled', 'cancelled'\n      // 'trading_type': 'spot', // 'margin', 'cfd'\n      'with_details': 1 // return full order details including executions\n\n    };\n\n    if (symbol !== undefined) {\n      market = this.market(symbol);\n      request['product_id'] = market['id'];\n    }\n\n    if (limit !== undefined) {\n      request['limit'] = limit;\n    }\n\n    const response = await this.privateGetOrders(this.extend(request, params)); //\n    //     {\n    //         \"models\": [\n    //             {\n    //                 \"id\": 2157474,\n    //                 \"order_type\": \"limit\",\n    //                 \"quantity\": \"0.01\",\n    //                 \"disc_quantity\": \"0.0\",\n    //                 \"iceberg_total_quantity\": \"0.0\",\n    //                 \"side\": \"sell\",\n    //                 \"filled_quantity\": \"0.0\",\n    //                 \"price\": \"500.0\",\n    //                 \"created_at\": 1462123639,\n    //                 \"updated_at\": 1462123639,\n    //                 \"status\": \"live\",\n    //                 \"leverage_level\": 1,\n    //                 \"source_exchange\": \"QUOINE\",\n    //                 \"product_id\": 1,\n    //                 \"product_code\": \"CASH\",\n    //                 \"funding_currency\": \"USD\",\n    //                 \"currency_pair_code\": \"BTCUSD\",\n    //                 \"order_fee\": \"0.0\",\n    //                 \"executions\": [], // optional\n    //             }\n    //         ],\n    //         \"current_page\": 1,\n    //         \"total_pages\": 1\n    //     }\n    //\n\n    const orders = this.safeValue(response, 'models', []);\n    return this.parseOrders(orders, market, since, limit);\n  }\n\n  async fetchOpenOrders(symbol = undefined, since = undefined, limit = undefined, params = {}) {\n    const request = {\n      'status': 'live'\n    };\n    return await this.fetchOrders(symbol, since, limit, this.extend(request, params));\n  }\n\n  async fetchClosedOrders(symbol = undefined, since = undefined, limit = undefined, params = {}) {\n    const request = {\n      'status': 'filled'\n    };\n    return await this.fetchOrders(symbol, since, limit, this.extend(request, params));\n  }\n\n  async withdraw(code, amount, address, tag = undefined, params = {}) {\n    this.checkAddress(address);\n    await this.loadMarkets();\n    const currency = this.currency(code);\n    const request = {\n      // 'auth_code': '', // optional 2fa code\n      'currency': currency['id'],\n      'address': address,\n      'amount': this.currencyToPrecision(code, amount) // 'payment_id': tag, // for XRP only\n      // 'memo_type': 'text', // 'text', 'id' or 'hash', for XLM only\n      // 'memo_value': tag, // for XLM only\n\n    };\n\n    if (tag !== undefined) {\n      if (code === 'XRP') {\n        request['payment_id'] = tag;\n      } else if (code === 'XLM') {\n        request['memo_type'] = 'text'; // overrideable via params\n\n        request['memo_value'] = tag;\n      } else {\n        throw new NotSupported(this.id + ' withdraw() only supports a tag along the address for XRP or XLM');\n      }\n    }\n\n    const response = await this.privatePostCryptoWithdrawals(this.extend(request, params)); //\n    //     {\n    //         \"id\": 1353,\n    //         \"address\": \"1BvBMSEYstWetqTFn5Au4m4GFg7xJaNVN2\",\n    //         \"amount\": 1.0,\n    //         \"state\": \"pending\",\n    //         \"currency\": \"BTC\",\n    //         \"withdrawal_fee\": 0.0,\n    //         \"created_at\": 1568016450,\n    //         \"updated_at\": 1568016450,\n    //         \"payment_id\": null\n    //     }\n    //\n\n    return this.parseTransaction(response, currency);\n  }\n\n  parseTransactionStatus(status) {\n    const statuses = {\n      'pending': 'pending',\n      'cancelled': 'canceled',\n      'approved': 'ok'\n    };\n    return this.safeString(statuses, status, status);\n  }\n\n  parseTransaction(transaction, currency = undefined) {\n    //\n    // withdraw\n    //\n    //     {\n    //         \"id\": 1353,\n    //         \"address\": \"1BvBMSEYstWetqTFn5Au4m4GFg7xJaNVN2\",\n    //         \"amount\": 1.0,\n    //         \"state\": \"pending\",\n    //         \"currency\": \"BTC\",\n    //         \"withdrawal_fee\": 0.0,\n    //         \"created_at\": 1568016450,\n    //         \"updated_at\": 1568016450,\n    //         \"payment_id\": null\n    //     }\n    //\n    // fetchDeposits, fetchWithdrawals\n    //\n    //     ...\n    //\n    const id = this.safeString(transaction, 'id');\n    const address = this.safeString(transaction, 'address');\n    const tag = this.safeString2(transaction, 'payment_id', 'memo_value');\n    const txid = undefined;\n    const currencyId = this.safeString(transaction, 'asset');\n    const code = this.safeCurrencyCode(currencyId, currency);\n    const timestamp = this.safeTimestamp(transaction, 'created_at');\n    const updated = this.safeTimestamp(transaction, 'updated_at');\n    const type = 'withdrawal';\n    const status = this.parseTransactionStatus(this.safeString(transaction, 'state'));\n    const amount = this.safeNumber(transaction, 'amount');\n    return {\n      'info': transaction,\n      'id': id,\n      'txid': txid,\n      'timestamp': timestamp,\n      'datetime': this.iso8601(timestamp),\n      'address': address,\n      'tag': tag,\n      'type': type,\n      'amount': amount,\n      'currency': code,\n      'status': status,\n      'updated': updated,\n      'fee': undefined\n    };\n  }\n\n  nonce() {\n    return this.milliseconds();\n  }\n\n  sign(path, api = 'public', method = 'GET', params = {}, headers = undefined, body = undefined) {\n    let url = '/' + this.implodeParams(path, params);\n    const query = this.omit(params, this.extractParams(path));\n    headers = {\n      'X-Quoine-API-Version': this.version,\n      'Content-Type': 'application/json'\n    };\n\n    if (api === 'private') {\n      this.checkRequiredCredentials();\n\n      if (method === 'GET') {\n        if (Object.keys(query).length) {\n          url += '?' + this.urlencode(query);\n        }\n      } else if (Object.keys(query).length) {\n        body = this.json(query);\n      }\n\n      const nonce = this.nonce();\n      const request = {\n        'path': url,\n        'token_id': this.apiKey,\n        'iat': Math.floor(nonce / 1000) // issued at\n\n      };\n\n      if (!('client_order_id' in query)) {\n        request['nonce'] = nonce;\n      }\n\n      headers['X-Quoine-Auth'] = this.jwt(request, this.encode(this.secret));\n    } else {\n      if (Object.keys(query).length) {\n        url += '?' + this.urlencode(query);\n      }\n    }\n\n    url = this.urls['api'] + url;\n    return {\n      'url': url,\n      'method': method,\n      'body': body,\n      'headers': headers\n    };\n  }\n\n  handleErrors(code, reason, url, method, headers, body, response, requestHeaders, requestBody) {\n    if (code >= 200 && code < 300) {\n      return;\n    }\n\n    if (code === 401) {\n      // expected non-json response\n      this.throwExactlyMatchedException(this.exceptions, body, body);\n      return;\n    }\n\n    if (code === 429) {\n      throw new DDoSProtection(this.id + ' ' + body);\n    }\n\n    if (response === undefined) {\n      return;\n    }\n\n    const feedback = this.id + ' ' + body;\n    const message = this.safeString(response, 'message');\n    const errors = this.safeValue(response, 'errors');\n\n    if (message !== undefined) {\n      //\n      //  { \"message\": \"Order not found\" }\n      //\n      this.throwExactlyMatchedException(this.exceptions, message, feedback);\n    } else if (errors !== undefined) {\n      //\n      //  { \"errors\": { \"user\": [\"not_enough_free_balance\"] }}\n      //  { \"errors\": { \"quantity\": [\"less_than_order_size\"] }}\n      //  { \"errors\": { \"order\": [\"Can not update partially filled order\"] }}\n      //\n      const types = Object.keys(errors);\n\n      for (let i = 0; i < types.length; i++) {\n        const type = types[i];\n        const errorMessages = errors[type];\n\n        for (let j = 0; j < errorMessages.length; j++) {\n          const message = errorMessages[j];\n          this.throwExactlyMatchedException(this.exceptions, message, feedback);\n        }\n      }\n    } else {\n      throw new ExchangeError(feedback);\n    }\n  }\n\n};","map":{"version":3,"sources":["C:/Users/James Price/Documents/VS Code/bixpro/node_modules/ccxt/js/liquid.js"],"names":["Exchange","require","TICK_SIZE","ExchangeError","ArgumentsRequired","InvalidNonce","OrderNotFound","InvalidOrder","InsufficientFunds","AuthenticationError","DDoSProtection","NotSupported","BadSymbol","Precise","module","exports","liquid","describe","deepExtend","fetchCurrencies","params","response","publicGetCurrencies","result","i","length","currency","id","safeString","code","safeCurrencyCode","active","amountPrecision","safeInteger","safeNumber","Math","pow","undefined","fetchMarkets","spot","publicGetProducts","perpetual","currencies","currenciesByCode","indexBy","markets","arrayConcat","market","baseId","quoteId","productType","type","swap","base","quote","symbol","maker","fees","taker","disabled","safeValue","baseCurrency","precision","minAmount","lastPrice","minPrice","maxPrice","multiplierDown","multiplierUp","limits","push","fetchBalance","loadMarkets","privateGetAccounts","crypto","fiat","balance","currencyId","account","parseBalance","fetchOrderBook","limit","request","marketId","publicGetProductsIdPriceLevels","extend","parseOrderBook","parseTicker","ticker","timestamp","milliseconds","last","markets_by_id","change","percentage","average","open","sum","iso8601","fetchTickers","symbols","filterByArray","fetchTicker","publicGetProductsId","parseTrade","trade","safeTimestamp","orderId","takerSide","mySide","side","takerOrMaker","priceString","amountString","price","parseNumber","amount","cost","stringMul","fetchTrades","since","parseInt","publicGetExecutions","parseTrades","fetchMyTrades","privateGetExecutionsMe","createOrder","clientOrderId","safeString2","omit","amountToPrecision","priceToPrecision","privatePostOrders","parseOrder","cancelOrder","privatePutOrdersIdCancel","order","options","json","editOrder","privatePutOrdersId","parseOrderStatus","status","statuses","filled","feeCurrency","tradeCost","tradeFilled","trades","numTrades","lastTradeTimestamp","remaining","fetchOrder","privateGetOrdersId","fetchOrders","privateGetOrders","orders","parseOrders","fetchOpenOrders","fetchClosedOrders","withdraw","address","tag","checkAddress","currencyToPrecision","privatePostCryptoWithdrawals","parseTransaction","parseTransactionStatus","transaction","txid","updated","nonce","sign","path","api","method","headers","body","url","implodeParams","query","extractParams","version","checkRequiredCredentials","Object","keys","urlencode","apiKey","floor","jwt","encode","secret","urls","handleErrors","reason","requestHeaders","requestBody","throwExactlyMatchedException","exceptions","feedback","message","errors","types","errorMessages","j"],"mappings":"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","sourcesContent":["'use strict';\n\n//  ---------------------------------------------------------------------------\n\nconst Exchange = require ('./base/Exchange');\nconst { TICK_SIZE } = require ('./base/functions/number');\nconst { ExchangeError, ArgumentsRequired, InvalidNonce, OrderNotFound, InvalidOrder, InsufficientFunds, AuthenticationError, DDoSProtection, NotSupported, BadSymbol } = require ('./base/errors');\nconst Precise = require ('./base/Precise');\n\n//  ---------------------------------------------------------------------------\n\nmodule.exports = class liquid extends Exchange {\n    describe () {\n        return this.deepExtend (super.describe (), {\n            'id': 'liquid',\n            'name': 'Liquid',\n            'countries': [ 'JP', 'CN', 'TW' ],\n            'version': '2',\n            'rateLimit': 1000,\n            'has': {\n                'cancelOrder': true,\n                'CORS': false,\n                'createOrder': true,\n                'editOrder': true,\n                'fetchBalance': true,\n                'fetchClosedOrders': true,\n                'fetchCurrencies': true,\n                'fetchMarkets': true,\n                'fetchMyTrades': true,\n                'fetchOpenOrders': true,\n                'fetchOrder': true,\n                'fetchOrderBook': true,\n                'fetchOrders': true,\n                'fetchTicker': true,\n                'fetchTickers': true,\n                'fetchTrades': true,\n                'withdraw': true,\n            },\n            'urls': {\n                'logo': 'https://user-images.githubusercontent.com/1294454/45798859-1a872600-bcb4-11e8-8746-69291ce87b04.jpg',\n                'api': 'https://api.liquid.com',\n                'www': 'https://www.liquid.com',\n                'doc': [\n                    'https://developers.liquid.com',\n                ],\n                'fees': 'https://help.liquid.com/getting-started-with-liquid/the-platform/fee-structure',\n                'referral': 'https://www.liquid.com/sign-up/?affiliate=SbzC62lt30976',\n            },\n            'api': {\n                'public': {\n                    'get': [\n                        'currencies',\n                        'products',\n                        'products/{id}',\n                        'products/{id}/price_levels',\n                        'executions',\n                        'ir_ladders/{currency}',\n                        'fees', // add fetchFees, fetchTradingFees, fetchFundingFees\n                    ],\n                },\n                'private': {\n                    'get': [\n                        'accounts', // undocumented https://github.com/ccxt/ccxt/pull/7493\n                        'accounts/balance',\n                        'accounts/main_asset',\n                        'accounts/{id}',\n                        'accounts/{currency}/reserved_balance_details',\n                        'crypto_accounts', // add fetchAccounts\n                        'crypto_withdrawals', // add fetchWithdrawals\n                        'executions/me',\n                        'fiat_accounts', // add fetchAccounts\n                        'fund_infos', // add fetchDeposits\n                        'loan_bids',\n                        'loans',\n                        'orders',\n                        'orders/{id}',\n                        'orders/{id}/trades', // add fetchOrderTrades\n                        'trades',\n                        'trades/{id}/loans',\n                        'trading_accounts',\n                        'trading_accounts/{id}',\n                        'transactions',\n                        'withdrawals', // add fetchWithdrawals\n                    ],\n                    'post': [\n                        'crypto_withdrawals',\n                        'fund_infos',\n                        'fiat_accounts',\n                        'loan_bids',\n                        'orders',\n                        'withdrawals',\n                    ],\n                    'put': [\n                        'crypto_withdrawal/{id}/cancel',\n                        'loan_bids/{id}/close',\n                        'loans/{id}',\n                        'orders/{id}', // add editOrder\n                        'orders/{id}/cancel',\n                        'trades/{id}',\n                        'trades/{id}/adjust_margin',\n                        'trades/{id}/close',\n                        'trades/close_all',\n                        'trading_accounts/{id}',\n                        'withdrawals/{id}/cancel',\n                    ],\n                },\n            },\n            'fees': {\n                'trading': {\n                    'tierBased': true,\n                    'percentage': true,\n                    'taker': 0.0030,\n                    'maker': 0.0000,\n                    'tiers': {\n                        'perpetual': {\n                            'maker': [\n                                [ 0, 0.0000 ],\n                                [ 25000, 0.0000 ],\n                                [ 50000, -0.00025 ],\n                                [ 100000, -0.00025 ],\n                                [ 1000000, -0.00025 ],\n                                [ 10000000, -0.00025 ],\n                                [ 25000000, -0.00025 ],\n                                [ 50000000, -0.00025 ],\n                                [ 75000000, -0.00025 ],\n                                [ 100000000, -0.00025 ],\n                                [ 200000000, -0.00025 ],\n                                [ 300000000, -0.00025 ],\n                            ],\n                            'taker': [\n                                [ 0, 0.00120 ],\n                                [ 25000, 0.00115 ],\n                                [ 50000, 0.00110 ],\n                                [ 100000, 0.00105 ],\n                                [ 1000000, 0.00100 ],\n                                [ 10000000, 0.00095 ],\n                                [ 25000000, 0.00090 ],\n                                [ 50000000, 0.00085 ],\n                                [ 75000000, 0.00080 ],\n                                [ 100000000, 0.00075 ],\n                                [ 200000000, 0.00070 ],\n                                [ 300000000, 0.00065 ],\n                            ],\n                        },\n                        'spot': {\n                            'taker': [\n                                [ 0, 0.003 ],\n                                [ 10000, 0.0029 ],\n                                [ 20000, 0.0028 ],\n                                [ 50000, 0.0026 ],\n                                [ 100000, 0.0020 ],\n                                [ 1000000, 0.0016 ],\n                                [ 5000000, 0.0012 ],\n                                [ 10000000, 0.0010 ],\n                                [ 25000000, 0.0009 ],\n                                [ 50000000, 0.0008 ],\n                                [ 100000000, 0.0007 ],\n                                [ 200000000, 0.0006 ],\n                                [ 500000000, 0.0004 ],\n                                [ 1000000000, 0.0003 ],\n                            ],\n                            'maker': [\n                                [ 0, 0.0000 ],\n                                [ 10000, 0.0020 ],\n                                [ 20000, 0.0019 ],\n                                [ 50000, 0.0018 ],\n                                [ 100000, 0.0016 ],\n                                [ 1000000, 0.0008 ],\n                                [ 5000000, 0.0007 ],\n                                [ 10000000, 0.0005 ],\n                                [ 25000000, 0.0000 ],\n                                [ 50000000, 0.0000 ],\n                                [ 100000000, 0.0000 ],\n                                [ 200000000, 0.0000 ],\n                                [ 500000000, 0.0000 ],\n                                [ 1000000000, 0.0000 ],\n                            ],\n                        },\n                    },\n                },\n            },\n            'precisionMode': TICK_SIZE,\n            'exceptions': {\n                'API rate limit exceeded. Please retry after 300s': DDoSProtection,\n                'API Authentication failed': AuthenticationError,\n                'Nonce is too small': InvalidNonce,\n                'Order not found': OrderNotFound,\n                'Can not update partially filled order': InvalidOrder,\n                'Can not update non-live order': OrderNotFound,\n                'not_enough_free_balance': InsufficientFunds,\n                'must_be_positive': InvalidOrder,\n                'less_than_order_size': InvalidOrder,\n                'price_too_high': InvalidOrder,\n                'price_too_small': InvalidOrder, // {\"errors\":{\"order\":[\"price_too_small\"]}}\n                'product_disabled': BadSymbol, // {\"errors\":{\"order\":[\"product_disabled\"]}}\n            },\n            'commonCurrencies': {\n                'WIN': 'WCOIN',\n                'HOT': 'HOT Token',\n                'MIOTA': 'IOTA', // https://github.com/ccxt/ccxt/issues/7487\n            },\n            'options': {\n                'cancelOrderException': true,\n            },\n        });\n    }\n\n    async fetchCurrencies (params = {}) {\n        const response = await this.publicGetCurrencies (params);\n        //\n        //     [\n        //         {\n        //             currency_type: 'fiat',\n        //             currency: 'USD',\n        //             symbol: '$',\n        //             assets_precision: 2,\n        //             quoting_precision: 5,\n        //             minimum_withdrawal: '15.0',\n        //             withdrawal_fee: 5,\n        //             minimum_fee: null,\n        //             minimum_order_quantity: null,\n        //             display_precision: 2,\n        //             depositable: true,\n        //             withdrawable: true,\n        //             discount_fee: 0.5,\n        //         },\n        //     ]\n        //\n        const result = {};\n        for (let i = 0; i < response.length; i++) {\n            const currency = response[i];\n            const id = this.safeString (currency, 'currency');\n            const code = this.safeCurrencyCode (id);\n            const active = currency['depositable'] && currency['withdrawable'];\n            const amountPrecision = this.safeInteger (currency, 'assets_precision');\n            result[code] = {\n                'id': id,\n                'code': code,\n                'info': currency,\n                'name': code,\n                'active': active,\n                'fee': this.safeNumber (currency, 'withdrawal_fee'),\n                'precision': amountPrecision,\n                'limits': {\n                    'amount': {\n                        'min': Math.pow (10, -amountPrecision),\n                        'max': Math.pow (10, amountPrecision),\n                    },\n                    'withdraw': {\n                        'min': this.safeNumber (currency, 'minimum_withdrawal'),\n                        'max': undefined,\n                    },\n                },\n            };\n        }\n        return result;\n    }\n\n    async fetchMarkets (params = {}) {\n        const spot = await this.publicGetProducts (params);\n        //\n        //     [\n        //         {\n        //             \"id\":\"637\",\n        //             \"product_type\":\"CurrencyPair\",\n        //             \"code\":\"CASH\",\n        //             \"name\":null,\n        //             \"market_ask\":\"0.00000797\",\n        //             \"market_bid\":\"0.00000727\",\n        //             \"indicator\":null,\n        //             \"currency\":\"BTC\",\n        //             \"currency_pair_code\":\"TFTBTC\",\n        //             \"symbol\":null,\n        //             \"btc_minimum_withdraw\":null,\n        //             \"fiat_minimum_withdraw\":null,\n        //             \"pusher_channel\":\"product_cash_tftbtc_637\",\n        //             \"taker_fee\":\"0.0\",\n        //             \"maker_fee\":\"0.0\",\n        //             \"low_market_bid\":\"0.00000685\",\n        //             \"high_market_ask\":\"0.00000885\",\n        //             \"volume_24h\":\"3696.0755956\",\n        //             \"last_price_24h\":\"0.00000716\",\n        //             \"last_traded_price\":\"0.00000766\",\n        //             \"last_traded_quantity\":\"1748.0377978\",\n        //             \"average_price\":null,\n        //             \"quoted_currency\":\"BTC\",\n        //             \"base_currency\":\"TFT\",\n        //             \"tick_size\":\"0.00000001\",\n        //             \"disabled\":false,\n        //             \"margin_enabled\":false,\n        //             \"cfd_enabled\":false,\n        //             \"perpetual_enabled\":false,\n        //             \"last_event_timestamp\":\"1596962820.000797146\",\n        //             \"timestamp\":\"1596962820.000797146\",\n        //             \"multiplier_up\":\"9.0\",\n        //             \"multiplier_down\":\"0.1\",\n        //             \"average_time_interval\":null\n        //         },\n        //     ]\n        //\n        const perpetual = await this.publicGetProducts ({ 'perpetual': '1' });\n        //\n        //     [\n        //         {\n        //             \"id\":\"604\",\n        //             \"product_type\":\"Perpetual\",\n        //             \"code\":\"CASH\",\n        //             \"name\":null,\n        //             \"market_ask\":\"11721.5\",\n        //             \"market_bid\":\"11719.0\",\n        //             \"indicator\":null,\n        //             \"currency\":\"USD\",\n        //             \"currency_pair_code\":\"P-BTCUSD\",\n        //             \"symbol\":\"$\",\n        //             \"btc_minimum_withdraw\":null,\n        //             \"fiat_minimum_withdraw\":null,\n        //             \"pusher_channel\":\"product_cash_p-btcusd_604\",\n        //             \"taker_fee\":\"0.0012\",\n        //             \"maker_fee\":\"0.0\",\n        //             \"low_market_bid\":\"11624.5\",\n        //             \"high_market_ask\":\"11859.0\",\n        //             \"volume_24h\":\"0.271\",\n        //             \"last_price_24h\":\"11621.5\",\n        //             \"last_traded_price\":\"11771.5\",\n        //             \"last_traded_quantity\":\"0.09\",\n        //             \"average_price\":\"11771.5\",\n        //             \"quoted_currency\":\"USD\",\n        //             \"base_currency\":\"P-BTC\",\n        //             \"tick_size\":\"0.5\",\n        //             \"disabled\":false,\n        //             \"margin_enabled\":false,\n        //             \"cfd_enabled\":false,\n        //             \"perpetual_enabled\":true,\n        //             \"last_event_timestamp\":\"1596963309.418853092\",\n        //             \"timestamp\":\"1596963309.418853092\",\n        //             \"multiplier_up\":null,\n        //             \"multiplier_down\":\"0.1\",\n        //             \"average_time_interval\":300,\n        //             \"index_price\":\"11682.8124\",\n        //             \"mark_price\":\"11719.96781\",\n        //             \"funding_rate\":\"0.00273\",\n        //             \"fair_price\":\"11720.2745\"\n        //         },\n        //     ]\n        //\n        const currencies = await this.fetchCurrencies ();\n        const currenciesByCode = this.indexBy (currencies, 'code');\n        const result = [];\n        const markets = this.arrayConcat (spot, perpetual);\n        for (let i = 0; i < markets.length; i++) {\n            const market = markets[i];\n            const id = this.safeString (market, 'id');\n            const baseId = this.safeString (market, 'base_currency');\n            const quoteId = this.safeString (market, 'quoted_currency');\n            const productType = this.safeString (market, 'product_type');\n            let type = 'spot';\n            let spot = true;\n            let swap = false;\n            if (productType === 'Perpetual') {\n                spot = false;\n                swap = true;\n                type = 'swap';\n            }\n            const base = this.safeCurrencyCode (baseId);\n            const quote = this.safeCurrencyCode (quoteId);\n            let symbol = undefined;\n            if (swap) {\n                symbol = this.safeString (market, 'currency_pair_code');\n            } else {\n                symbol = base + '/' + quote;\n            }\n            let maker = this.fees['trading']['maker'];\n            let taker = this.fees['trading']['taker'];\n            if (type === 'swap') {\n                maker = this.safeNumber (market, 'maker_fee', this.fees['trading']['maker']);\n                taker = this.safeNumber (market, 'taker_fee', this.fees['trading']['taker']);\n            }\n            const disabled = this.safeValue (market, 'disabled', false);\n            const active = !disabled;\n            const baseCurrency = this.safeValue (currenciesByCode, base);\n            const precision = {\n                'amount': 0.00000001,\n                'price': this.safeNumber (market, 'tick_size'),\n            };\n            let minAmount = undefined;\n            if (baseCurrency !== undefined) {\n                minAmount = this.safeNumber (baseCurrency['info'], 'minimum_order_quantity');\n            }\n            const lastPrice = this.safeNumber (market, 'last_traded_price');\n            let minPrice = undefined;\n            let maxPrice = undefined;\n            if (lastPrice) {\n                const multiplierDown = this.safeNumber (market, 'multiplier_down');\n                const multiplierUp = this.safeNumber (market, 'multiplier_up');\n                if (multiplierDown !== undefined) {\n                    minPrice = lastPrice * multiplierDown;\n                }\n                if (multiplierUp !== undefined) {\n                    maxPrice = lastPrice * multiplierUp;\n                }\n            }\n            const limits = {\n                'amount': {\n                    'min': minAmount,\n                    'max': undefined,\n                },\n                'price': {\n                    'min': minPrice,\n                    'max': maxPrice,\n                },\n                'cost': {\n                    'min': undefined,\n                    'max': undefined,\n                },\n            };\n            result.push ({\n                'id': id,\n                'symbol': symbol,\n                'base': base,\n                'quote': quote,\n                'baseId': baseId,\n                'quoteId': quoteId,\n                'type': type,\n                'spot': spot,\n                'swap': swap,\n                'maker': maker,\n                'taker': taker,\n                'limits': limits,\n                'precision': precision,\n                'active': active,\n                'info': market,\n            });\n        }\n        return result;\n    }\n\n    async fetchBalance (params = {}) {\n        await this.loadMarkets ();\n        const response = await this.privateGetAccounts (params);\n        //\n        //     {\n        //         crypto_accounts: [\n        //             {\n        //                 id: 2221179,\n        //                 currency: 'USDT',\n        //                 balance: '0.0',\n        //                 reserved_balance: '0.0',\n        //                 pusher_channel: 'user_xxxxx_account_usdt',\n        //                 lowest_offer_interest_rate: null,\n        //                 highest_offer_interest_rate: null,\n        //                 address: '0',\n        //                 currency_symbol: 'USDT',\n        //                 minimum_withdraw: null,\n        //                 currency_type: 'crypto'\n        //             },\n        //         ],\n        //         fiat_accounts: [\n        //             {\n        //                 id: 1112734,\n        //                 currency: 'USD',\n        //                 balance: '0.0',\n        //                 reserved_balance: '0.0',\n        //                 pusher_channel: 'user_xxxxx_account_usd',\n        //                 lowest_offer_interest_rate: null,\n        //                 highest_offer_interest_rate: null,\n        //                 currency_symbol: '$',\n        //                 send_to_btc_address: null,\n        //                 exchange_rate: '1.0',\n        //                 currency_type: 'fiat'\n        //             }\n        //         ]\n        //     }\n        //\n        const result = {\n            'info': response,\n            'timestamp': undefined,\n            'datetime': undefined,\n        };\n        const crypto = this.safeValue (response, 'crypto_accounts', []);\n        const fiat = this.safeValue (response, 'fiat_accounts', []);\n        for (let i = 0; i < crypto.length; i++) {\n            const balance = crypto[i];\n            const currencyId = this.safeString (balance, 'currency');\n            const code = this.safeCurrencyCode (currencyId);\n            const account = this.account ();\n            account['total'] = this.safeString (balance, 'balance');\n            account['used'] = this.safeString (balance, 'reserved_balance');\n            result[code] = account;\n        }\n        for (let i = 0; i < fiat.length; i++) {\n            const balance = fiat[i];\n            const currencyId = this.safeString (balance, 'currency');\n            const code = this.safeCurrencyCode (currencyId);\n            const account = this.account ();\n            account['total'] = this.safeString (balance, 'balance');\n            account['used'] = this.safeString (balance, 'reserved_balance');\n            result[code] = account;\n        }\n        return this.parseBalance (result, false);\n    }\n\n    async fetchOrderBook (symbol, limit = undefined, params = {}) {\n        await this.loadMarkets ();\n        const request = {\n            'id': this.marketId (symbol),\n        };\n        const response = await this.publicGetProductsIdPriceLevels (this.extend (request, params));\n        return this.parseOrderBook (response, symbol, undefined, 'buy_price_levels', 'sell_price_levels');\n    }\n\n    parseTicker (ticker, market = undefined) {\n        const timestamp = this.milliseconds ();\n        let last = undefined;\n        if ('last_traded_price' in ticker) {\n            if (ticker['last_traded_price']) {\n                const length = ticker['last_traded_price'].length;\n                if (length > 0) {\n                    last = this.safeNumber (ticker, 'last_traded_price');\n                }\n            }\n        }\n        let symbol = undefined;\n        if (market === undefined) {\n            const marketId = this.safeString (ticker, 'id');\n            if (marketId in this.markets_by_id) {\n                market = this.markets_by_id[marketId];\n            } else {\n                const baseId = this.safeString (ticker, 'base_currency');\n                const quoteId = this.safeString (ticker, 'quoted_currency');\n                if (symbol in this.markets) {\n                    market = this.markets[symbol];\n                } else {\n                    symbol = this.safeCurrencyCode (baseId) + '/' + this.safeCurrencyCode (quoteId);\n                }\n            }\n        }\n        if (market !== undefined) {\n            symbol = market['symbol'];\n        }\n        let change = undefined;\n        let percentage = undefined;\n        let average = undefined;\n        const open = this.safeNumber (ticker, 'last_price_24h');\n        if (open !== undefined && last !== undefined) {\n            change = last - open;\n            average = this.sum (last, open) / 2;\n            if (open > 0) {\n                percentage = change / open * 100;\n            }\n        }\n        return {\n            'symbol': symbol,\n            'timestamp': timestamp,\n            'datetime': this.iso8601 (timestamp),\n            'high': this.safeNumber (ticker, 'high_market_ask'),\n            'low': this.safeNumber (ticker, 'low_market_bid'),\n            'bid': this.safeNumber (ticker, 'market_bid'),\n            'bidVolume': undefined,\n            'ask': this.safeNumber (ticker, 'market_ask'),\n            'askVolume': undefined,\n            'vwap': undefined,\n            'open': open,\n            'close': last,\n            'last': last,\n            'previousClose': undefined,\n            'change': change,\n            'percentage': percentage,\n            'average': average,\n            'baseVolume': this.safeNumber (ticker, 'volume_24h'),\n            'quoteVolume': undefined,\n            'info': ticker,\n        };\n    }\n\n    async fetchTickers (symbols = undefined, params = {}) {\n        await this.loadMarkets ();\n        const response = await this.publicGetProducts (params);\n        const result = {};\n        for (let i = 0; i < response.length; i++) {\n            const ticker = this.parseTicker (response[i]);\n            const symbol = ticker['symbol'];\n            result[symbol] = ticker;\n        }\n        return this.filterByArray (result, 'symbol', symbols);\n    }\n\n    async fetchTicker (symbol, params = {}) {\n        await this.loadMarkets ();\n        const market = this.market (symbol);\n        const request = {\n            'id': market['id'],\n        };\n        const response = await this.publicGetProductsId (this.extend (request, params));\n        return this.parseTicker (response, market);\n    }\n\n    parseTrade (trade, market = undefined) {\n        // {             id:  12345,\n        //         quantity: \"6.789\",\n        //            price: \"98765.4321\",\n        //       taker_side: \"sell\",\n        //       created_at:  1512345678,\n        //          my_side: \"buy\"           }\n        const timestamp = this.safeTimestamp (trade, 'created_at');\n        const orderId = this.safeString (trade, 'order_id');\n        // 'taker_side' gets filled for both fetchTrades and fetchMyTrades\n        const takerSide = this.safeString (trade, 'taker_side');\n        // 'my_side' gets filled for fetchMyTrades only and may differ from 'taker_side'\n        const mySide = this.safeString (trade, 'my_side');\n        const side = (mySide !== undefined) ? mySide : takerSide;\n        let takerOrMaker = undefined;\n        if (mySide !== undefined) {\n            takerOrMaker = (takerSide === mySide) ? 'taker' : 'maker';\n        }\n        const priceString = this.safeString (trade, 'price');\n        const amountString = this.safeString (trade, 'quantity');\n        const price = this.parseNumber (priceString);\n        const amount = this.parseNumber (amountString);\n        const cost = this.parseNumber (Precise.stringMul (priceString, amountString));\n        const id = this.safeString (trade, 'id');\n        let symbol = undefined;\n        if (market !== undefined) {\n            symbol = market['symbol'];\n        }\n        return {\n            'info': trade,\n            'id': id,\n            'order': orderId,\n            'timestamp': timestamp,\n            'datetime': this.iso8601 (timestamp),\n            'symbol': symbol,\n            'type': undefined,\n            'side': side,\n            'takerOrMaker': takerOrMaker,\n            'price': price,\n            'amount': amount,\n            'cost': cost,\n            'fee': undefined,\n        };\n    }\n\n    async fetchTrades (symbol, since = undefined, limit = undefined, params = {}) {\n        await this.loadMarkets ();\n        const market = this.market (symbol);\n        const request = {\n            'product_id': market['id'],\n        };\n        if (limit !== undefined) {\n            request['limit'] = limit;\n        }\n        if (since !== undefined) {\n            // timestamp should be in seconds, whereas we use milliseconds in since and everywhere\n            request['timestamp'] = parseInt (since / 1000);\n        }\n        const response = await this.publicGetExecutions (this.extend (request, params));\n        const result = (since !== undefined) ? response : response['models'];\n        return this.parseTrades (result, market, since, limit);\n    }\n\n    async fetchMyTrades (symbol = undefined, since = undefined, limit = undefined, params = {}) {\n        await this.loadMarkets ();\n        const market = this.market (symbol);\n        // the `with_details` param is undocumented - it adds the order_id to the results\n        const request = {\n            'product_id': market['id'],\n            'with_details': true,\n        };\n        if (limit !== undefined) {\n            request['limit'] = limit;\n        }\n        const response = await this.privateGetExecutionsMe (this.extend (request, params));\n        return this.parseTrades (response['models'], market, since, limit);\n    }\n\n    async createOrder (symbol, type, side, amount, price = undefined, params = {}) {\n        await this.loadMarkets ();\n        const clientOrderId = this.safeString2 (params, 'clientOrderId', 'client_order_id');\n        params = this.omit (params, [ 'clientOrderId', 'client_order_id' ]);\n        const request = {\n            'order_type': type,\n            'product_id': this.marketId (symbol),\n            'side': side,\n            'quantity': this.amountToPrecision (symbol, amount),\n        };\n        if (clientOrderId !== undefined) {\n            request['client_order_id'] = clientOrderId;\n        }\n        if ((type === 'limit') || (type === 'limit_post_only') || (type === 'market_with_range') || (type === 'stop')) {\n            request['price'] = this.priceToPrecision (symbol, price);\n        }\n        const response = await this.privatePostOrders (this.extend (request, params));\n        //\n        //     {\n        //         \"id\": 2157474,\n        //         \"order_type\": \"limit\",\n        //         \"quantity\": \"0.01\",\n        //         \"disc_quantity\": \"0.0\",\n        //         \"iceberg_total_quantity\": \"0.0\",\n        //         \"side\": \"sell\",\n        //         \"filled_quantity\": \"0.0\",\n        //         \"price\": \"500.0\",\n        //         \"created_at\": 1462123639,\n        //         \"updated_at\": 1462123639,\n        //         \"status\": \"live\",\n        //         \"leverage_level\": 1,\n        //         \"source_exchange\": \"QUOINE\",\n        //         \"product_id\": 1,\n        //         \"product_code\": \"CASH\",\n        //         \"funding_currency\": \"USD\",\n        //         \"currency_pair_code\": \"BTCUSD\",\n        //         \"order_fee\": \"0.0\",\n        //         \"client_order_id\": null,\n        //     }\n        //\n        return this.parseOrder (response);\n    }\n\n    async cancelOrder (id, symbol = undefined, params = {}) {\n        await this.loadMarkets ();\n        const request = {\n            'id': id,\n        };\n        const response = await this.privatePutOrdersIdCancel (this.extend (request, params));\n        const order = this.parseOrder (response);\n        if (order['status'] === 'closed') {\n            if (this.options['cancelOrderException']) {\n                throw new OrderNotFound (this.id + ' order closed already: ' + this.json (response));\n            }\n        }\n        return order;\n    }\n\n    async editOrder (id, symbol, type, side, amount, price = undefined, params = {}) {\n        await this.loadMarkets ();\n        if (price === undefined) {\n            throw new ArgumentsRequired (this.id + ' editOrder() requires the price argument');\n        }\n        const request = {\n            'order': {\n                'quantity': this.amountToPrecision (symbol, amount),\n                'price': this.priceToPrecision (symbol, price),\n            },\n            'id': id,\n        };\n        const response = await this.privatePutOrdersId (this.extend (request, params));\n        return this.parseOrder (response);\n    }\n\n    parseOrderStatus (status) {\n        const statuses = {\n            'live': 'open',\n            'filled': 'closed',\n            'cancelled': 'canceled',\n        };\n        return this.safeString (statuses, status, status);\n    }\n\n    parseOrder (order, market = undefined) {\n        //\n        // createOrder\n        //\n        //     {\n        //         \"id\": 2157474,\n        //         \"order_type\": \"limit\",\n        //         \"quantity\": \"0.01\",\n        //         \"disc_quantity\": \"0.0\",\n        //         \"iceberg_total_quantity\": \"0.0\",\n        //         \"side\": \"sell\",\n        //         \"filled_quantity\": \"0.0\",\n        //         \"price\": \"500.0\",\n        //         \"created_at\": 1462123639,\n        //         \"updated_at\": 1462123639,\n        //         \"status\": \"live\",\n        //         \"leverage_level\": 1,\n        //         \"source_exchange\": \"QUOINE\",\n        //         \"product_id\": 1,\n        //         \"product_code\": \"CASH\",\n        //         \"funding_currency\": \"USD\",\n        //         \"currency_pair_code\": \"BTCUSD\",\n        //         \"order_fee\": \"0.0\"\n        //         \"client_order_id\": null,\n        //     }\n        //\n        // fetchOrder, fetchOrders, fetchOpenOrders, fetchClosedOrders\n        //\n        //     {\n        //         \"id\": 2157479,\n        //         \"order_type\": \"limit\",\n        //         \"quantity\": \"0.01\",\n        //         \"disc_quantity\": \"0.0\",\n        //         \"iceberg_total_quantity\": \"0.0\",\n        //         \"side\": \"sell\",\n        //         \"filled_quantity\": \"0.01\",\n        //         \"price\": \"500.0\",\n        //         \"created_at\": 1462123639,\n        //         \"updated_at\": 1462123639,\n        //         \"status\": \"filled\",\n        //         \"leverage_level\": 2,\n        //         \"source_exchange\": \"QUOINE\",\n        //         \"product_id\": 1,\n        //         \"product_code\": \"CASH\",\n        //         \"funding_currency\": \"USD\",\n        //         \"currency_pair_code\": \"BTCUSD\",\n        //         \"order_fee\": \"0.0\",\n        //         \"executions\": [\n        //             {\n        //                 \"id\": 4566133,\n        //                 \"quantity\": \"0.01\",\n        //                 \"price\": \"500.0\",\n        //                 \"taker_side\": \"buy\",\n        //                 \"my_side\": \"sell\",\n        //                 \"created_at\": 1465396785\n        //             }\n        //         ]\n        //     }\n        //\n        const orderId = this.safeString (order, 'id');\n        const timestamp = this.safeTimestamp (order, 'created_at');\n        const marketId = this.safeString (order, 'product_id');\n        market = this.safeValue (this.markets_by_id, marketId);\n        const status = this.parseOrderStatus (this.safeString (order, 'status'));\n        const amount = this.safeNumber (order, 'quantity');\n        let filled = this.safeNumber (order, 'filled_quantity');\n        const price = this.safeNumber (order, 'price');\n        let symbol = undefined;\n        let feeCurrency = undefined;\n        if (market !== undefined) {\n            symbol = market['symbol'];\n            feeCurrency = market['quote'];\n        }\n        const type = this.safeString (order, 'order_type');\n        let tradeCost = 0;\n        let tradeFilled = 0;\n        let average = this.safeNumber (order, 'average_price');\n        const trades = this.parseTrades (this.safeValue (order, 'executions', []), market, undefined, undefined, {\n            'order': orderId,\n            'type': type,\n        });\n        const numTrades = trades.length;\n        for (let i = 0; i < numTrades; i++) {\n            // php copies values upon assignment, but not references them\n            // todo rewrite this (shortly)\n            const trade = trades[i];\n            trade['order'] = orderId;\n            trade['type'] = type;\n            tradeFilled = this.sum (tradeFilled, trade['amount']);\n            tradeCost = this.sum (tradeCost, trade['cost']);\n        }\n        let cost = undefined;\n        let lastTradeTimestamp = undefined;\n        if (numTrades > 0) {\n            lastTradeTimestamp = trades[numTrades - 1]['timestamp'];\n            if (!average && (tradeFilled > 0)) {\n                average = tradeCost / tradeFilled;\n            }\n            if (cost === undefined) {\n                cost = tradeCost;\n            }\n            if (filled === undefined) {\n                filled = tradeFilled;\n            }\n        }\n        let remaining = undefined;\n        if (amount !== undefined && filled !== undefined) {\n            remaining = amount - filled;\n        }\n        const side = this.safeString (order, 'side');\n        const clientOrderId = this.safeString (order, 'client_order_id');\n        return {\n            'id': orderId,\n            'clientOrderId': clientOrderId,\n            'timestamp': timestamp,\n            'datetime': this.iso8601 (timestamp),\n            'lastTradeTimestamp': lastTradeTimestamp,\n            'type': type,\n            'timeInForce': undefined,\n            'postOnly': undefined,\n            'status': status,\n            'symbol': symbol,\n            'side': side,\n            'price': price,\n            'stopPrice': undefined,\n            'amount': amount,\n            'filled': filled,\n            'cost': cost,\n            'remaining': remaining,\n            'average': average,\n            'trades': trades,\n            'fee': {\n                'currency': feeCurrency,\n                'cost': this.safeNumber (order, 'order_fee'),\n            },\n            'info': order,\n        };\n    }\n\n    async fetchOrder (id, symbol = undefined, params = {}) {\n        await this.loadMarkets ();\n        const request = {\n            'id': id,\n        };\n        const response = await this.privateGetOrdersId (this.extend (request, params));\n        return this.parseOrder (response);\n    }\n\n    async fetchOrders (symbol = undefined, since = undefined, limit = undefined, params = {}) {\n        await this.loadMarkets ();\n        let market = undefined;\n        const request = {\n            // 'funding_currency': market['quoteId'], // filter orders based on \"funding\" currency (quote currency)\n            // 'product_id': market['id'],\n            // 'status': 'live', // 'filled', 'cancelled'\n            // 'trading_type': 'spot', // 'margin', 'cfd'\n            'with_details': 1, // return full order details including executions\n        };\n        if (symbol !== undefined) {\n            market = this.market (symbol);\n            request['product_id'] = market['id'];\n        }\n        if (limit !== undefined) {\n            request['limit'] = limit;\n        }\n        const response = await this.privateGetOrders (this.extend (request, params));\n        //\n        //     {\n        //         \"models\": [\n        //             {\n        //                 \"id\": 2157474,\n        //                 \"order_type\": \"limit\",\n        //                 \"quantity\": \"0.01\",\n        //                 \"disc_quantity\": \"0.0\",\n        //                 \"iceberg_total_quantity\": \"0.0\",\n        //                 \"side\": \"sell\",\n        //                 \"filled_quantity\": \"0.0\",\n        //                 \"price\": \"500.0\",\n        //                 \"created_at\": 1462123639,\n        //                 \"updated_at\": 1462123639,\n        //                 \"status\": \"live\",\n        //                 \"leverage_level\": 1,\n        //                 \"source_exchange\": \"QUOINE\",\n        //                 \"product_id\": 1,\n        //                 \"product_code\": \"CASH\",\n        //                 \"funding_currency\": \"USD\",\n        //                 \"currency_pair_code\": \"BTCUSD\",\n        //                 \"order_fee\": \"0.0\",\n        //                 \"executions\": [], // optional\n        //             }\n        //         ],\n        //         \"current_page\": 1,\n        //         \"total_pages\": 1\n        //     }\n        //\n        const orders = this.safeValue (response, 'models', []);\n        return this.parseOrders (orders, market, since, limit);\n    }\n\n    async fetchOpenOrders (symbol = undefined, since = undefined, limit = undefined, params = {}) {\n        const request = { 'status': 'live' };\n        return await this.fetchOrders (symbol, since, limit, this.extend (request, params));\n    }\n\n    async fetchClosedOrders (symbol = undefined, since = undefined, limit = undefined, params = {}) {\n        const request = { 'status': 'filled' };\n        return await this.fetchOrders (symbol, since, limit, this.extend (request, params));\n    }\n\n    async withdraw (code, amount, address, tag = undefined, params = {}) {\n        this.checkAddress (address);\n        await this.loadMarkets ();\n        const currency = this.currency (code);\n        const request = {\n            // 'auth_code': '', // optional 2fa code\n            'currency': currency['id'],\n            'address': address,\n            'amount': this.currencyToPrecision (code, amount),\n            // 'payment_id': tag, // for XRP only\n            // 'memo_type': 'text', // 'text', 'id' or 'hash', for XLM only\n            // 'memo_value': tag, // for XLM only\n        };\n        if (tag !== undefined) {\n            if (code === 'XRP') {\n                request['payment_id'] = tag;\n            } else if (code === 'XLM') {\n                request['memo_type'] = 'text'; // overrideable via params\n                request['memo_value'] = tag;\n            } else {\n                throw new NotSupported (this.id + ' withdraw() only supports a tag along the address for XRP or XLM');\n            }\n        }\n        const response = await this.privatePostCryptoWithdrawals (this.extend (request, params));\n        //\n        //     {\n        //         \"id\": 1353,\n        //         \"address\": \"1BvBMSEYstWetqTFn5Au4m4GFg7xJaNVN2\",\n        //         \"amount\": 1.0,\n        //         \"state\": \"pending\",\n        //         \"currency\": \"BTC\",\n        //         \"withdrawal_fee\": 0.0,\n        //         \"created_at\": 1568016450,\n        //         \"updated_at\": 1568016450,\n        //         \"payment_id\": null\n        //     }\n        //\n        return this.parseTransaction (response, currency);\n    }\n\n    parseTransactionStatus (status) {\n        const statuses = {\n            'pending': 'pending',\n            'cancelled': 'canceled',\n            'approved': 'ok',\n        };\n        return this.safeString (statuses, status, status);\n    }\n\n    parseTransaction (transaction, currency = undefined) {\n        //\n        // withdraw\n        //\n        //     {\n        //         \"id\": 1353,\n        //         \"address\": \"1BvBMSEYstWetqTFn5Au4m4GFg7xJaNVN2\",\n        //         \"amount\": 1.0,\n        //         \"state\": \"pending\",\n        //         \"currency\": \"BTC\",\n        //         \"withdrawal_fee\": 0.0,\n        //         \"created_at\": 1568016450,\n        //         \"updated_at\": 1568016450,\n        //         \"payment_id\": null\n        //     }\n        //\n        // fetchDeposits, fetchWithdrawals\n        //\n        //     ...\n        //\n        const id = this.safeString (transaction, 'id');\n        const address = this.safeString (transaction, 'address');\n        const tag = this.safeString2 (transaction, 'payment_id', 'memo_value');\n        const txid = undefined;\n        const currencyId = this.safeString (transaction, 'asset');\n        const code = this.safeCurrencyCode (currencyId, currency);\n        const timestamp = this.safeTimestamp (transaction, 'created_at');\n        const updated = this.safeTimestamp (transaction, 'updated_at');\n        const type = 'withdrawal';\n        const status = this.parseTransactionStatus (this.safeString (transaction, 'state'));\n        const amount = this.safeNumber (transaction, 'amount');\n        return {\n            'info': transaction,\n            'id': id,\n            'txid': txid,\n            'timestamp': timestamp,\n            'datetime': this.iso8601 (timestamp),\n            'address': address,\n            'tag': tag,\n            'type': type,\n            'amount': amount,\n            'currency': code,\n            'status': status,\n            'updated': updated,\n            'fee': undefined,\n        };\n    }\n\n    nonce () {\n        return this.milliseconds ();\n    }\n\n    sign (path, api = 'public', method = 'GET', params = {}, headers = undefined, body = undefined) {\n        let url = '/' + this.implodeParams (path, params);\n        const query = this.omit (params, this.extractParams (path));\n        headers = {\n            'X-Quoine-API-Version': this.version,\n            'Content-Type': 'application/json',\n        };\n        if (api === 'private') {\n            this.checkRequiredCredentials ();\n            if (method === 'GET') {\n                if (Object.keys (query).length) {\n                    url += '?' + this.urlencode (query);\n                }\n            } else if (Object.keys (query).length) {\n                body = this.json (query);\n            }\n            const nonce = this.nonce ();\n            const request = {\n                'path': url,\n                'token_id': this.apiKey,\n                'iat': Math.floor (nonce / 1000), // issued at\n            };\n            if (!('client_order_id' in query)) {\n                request['nonce'] = nonce;\n            }\n            headers['X-Quoine-Auth'] = this.jwt (request, this.encode (this.secret));\n        } else {\n            if (Object.keys (query).length) {\n                url += '?' + this.urlencode (query);\n            }\n        }\n        url = this.urls['api'] + url;\n        return { 'url': url, 'method': method, 'body': body, 'headers': headers };\n    }\n\n    handleErrors (code, reason, url, method, headers, body, response, requestHeaders, requestBody) {\n        if (code >= 200 && code < 300) {\n            return;\n        }\n        if (code === 401) {\n            // expected non-json response\n            this.throwExactlyMatchedException (this.exceptions, body, body);\n            return;\n        }\n        if (code === 429) {\n            throw new DDoSProtection (this.id + ' ' + body);\n        }\n        if (response === undefined) {\n            return;\n        }\n        const feedback = this.id + ' ' + body;\n        const message = this.safeString (response, 'message');\n        const errors = this.safeValue (response, 'errors');\n        if (message !== undefined) {\n            //\n            //  { \"message\": \"Order not found\" }\n            //\n            this.throwExactlyMatchedException (this.exceptions, message, feedback);\n        } else if (errors !== undefined) {\n            //\n            //  { \"errors\": { \"user\": [\"not_enough_free_balance\"] }}\n            //  { \"errors\": { \"quantity\": [\"less_than_order_size\"] }}\n            //  { \"errors\": { \"order\": [\"Can not update partially filled order\"] }}\n            //\n            const types = Object.keys (errors);\n            for (let i = 0; i < types.length; i++) {\n                const type = types[i];\n                const errorMessages = errors[type];\n                for (let j = 0; j < errorMessages.length; j++) {\n                    const message = errorMessages[j];\n                    this.throwExactlyMatchedException (this.exceptions, message, feedback);\n                }\n            }\n        } else {\n            throw new ExchangeError (feedback);\n        }\n    }\n};\n"]},"metadata":{},"sourceType":"script"}