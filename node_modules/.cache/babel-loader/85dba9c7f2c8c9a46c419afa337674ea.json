{"ast":null,"code":"'use strict'; // ----------------------------------------------------------------------------\n\nconst Exchange = require('./base/Exchange');\n\nconst {\n  ExchangeError,\n  ArgumentsRequired,\n  AuthenticationError,\n  RateLimitExceeded,\n  InvalidNonce\n} = require('./base/errors');\n\nconst Precise = require('./base/Precise'); // ----------------------------------------------------------------------------\n\n\nmodule.exports = class coinbase extends Exchange {\n  describe() {\n    return this.deepExtend(super.describe(), {\n      'id': 'coinbase',\n      'name': 'Coinbase',\n      'countries': ['US'],\n      'rateLimit': 400,\n      // 10k calls per hour\n      'version': 'v2',\n      'userAgent': this.userAgents['chrome'],\n      'headers': {\n        'CB-VERSION': '2018-05-30'\n      },\n      'has': {\n        'CORS': true,\n        'cancelOrder': false,\n        'createDepositAddress': true,\n        'createOrder': false,\n        'deposit': false,\n        'fetchBalance': true,\n        'fetchClosedOrders': false,\n        'fetchCurrencies': true,\n        'fetchDepositAddress': false,\n        'fetchMarkets': true,\n        'fetchMyTrades': false,\n        'fetchOHLCV': false,\n        'fetchOpenOrders': false,\n        'fetchOrder': false,\n        'fetchOrderBook': false,\n        'fetchL2OrderBook': false,\n        'fetchLedger': true,\n        'fetchOrders': false,\n        'fetchTicker': true,\n        'fetchTickers': false,\n        'fetchTime': true,\n        'fetchBidsAsks': false,\n        'fetchTrades': false,\n        'withdraw': false,\n        'fetchTransactions': false,\n        'fetchDeposits': true,\n        'fetchWithdrawals': true,\n        'fetchMySells': true,\n        'fetchMyBuys': true\n      },\n      'urls': {\n        'logo': 'https://user-images.githubusercontent.com/1294454/40811661-b6eceae2-653a-11e8-829e-10bfadb078cf.jpg',\n        'api': 'https://api.coinbase.com',\n        'www': 'https://www.coinbase.com',\n        'doc': 'https://developers.coinbase.com/api/v2',\n        'fees': 'https://support.coinbase.com/customer/portal/articles/2109597-buy-sell-bank-transfer-fees',\n        'referral': 'https://www.coinbase.com/join/58cbe25a355148797479dbd2'\n      },\n      'requiredCredentials': {\n        'apiKey': true,\n        'secret': true\n      },\n      'api': {\n        'public': {\n          'get': ['currencies', 'time', 'exchange-rates', 'users/{user_id}', 'prices/{symbol}/buy', 'prices/{symbol}/sell', 'prices/{symbol}/spot']\n        },\n        'private': {\n          'get': ['accounts', 'accounts/{account_id}', 'accounts/{account_id}/addresses', 'accounts/{account_id}/addresses/{address_id}', 'accounts/{account_id}/addresses/{address_id}/transactions', 'accounts/{account_id}/transactions', 'accounts/{account_id}/transactions/{transaction_id}', 'accounts/{account_id}/buys', 'accounts/{account_id}/buys/{buy_id}', 'accounts/{account_id}/sells', 'accounts/{account_id}/sells/{sell_id}', 'accounts/{account_id}/deposits', 'accounts/{account_id}/deposits/{deposit_id}', 'accounts/{account_id}/withdrawals', 'accounts/{account_id}/withdrawals/{withdrawal_id}', 'payment-methods', 'payment-methods/{payment_method_id}', 'user', 'user/auth'],\n          'post': ['accounts', 'accounts/{account_id}/primary', 'accounts/{account_id}/addresses', 'accounts/{account_id}/transactions', 'accounts/{account_id}/transactions/{transaction_id}/complete', 'accounts/{account_id}/transactions/{transaction_id}/resend', 'accounts/{account_id}/buys', 'accounts/{account_id}/buys/{buy_id}/commit', 'accounts/{account_id}/sells', 'accounts/{account_id}/sells/{sell_id}/commit', 'accounts/{account_id}/deposists', 'accounts/{account_id}/deposists/{deposit_id}/commit', 'accounts/{account_id}/withdrawals', 'accounts/{account_id}/withdrawals/{withdrawal_id}/commit'],\n          'put': ['accounts/{account_id}', 'user'],\n          'delete': ['accounts/{id}', 'accounts/{account_id}/transactions/{transaction_id}']\n        }\n      },\n      'exceptions': {\n        'exact': {\n          'two_factor_required': AuthenticationError,\n          // 402 When sending money over 2fa limit\n          'param_required': ExchangeError,\n          // 400 Missing parameter\n          'validation_error': ExchangeError,\n          // 400 Unable to validate POST/PUT\n          'invalid_request': ExchangeError,\n          // 400 Invalid request\n          'personal_details_required': AuthenticationError,\n          // 400 User’s personal detail required to complete this request\n          'identity_verification_required': AuthenticationError,\n          // 400 Identity verification is required to complete this request\n          'jumio_verification_required': AuthenticationError,\n          // 400 Document verification is required to complete this request\n          'jumio_face_match_verification_required': AuthenticationError,\n          // 400 Document verification including face match is required to complete this request\n          'unverified_email': AuthenticationError,\n          // 400 User has not verified their email\n          'authentication_error': AuthenticationError,\n          // 401 Invalid auth (generic)\n          'invalid_token': AuthenticationError,\n          // 401 Invalid Oauth token\n          'revoked_token': AuthenticationError,\n          // 401 Revoked Oauth token\n          'expired_token': AuthenticationError,\n          // 401 Expired Oauth token\n          'invalid_scope': AuthenticationError,\n          // 403 User hasn’t authenticated necessary scope\n          'not_found': ExchangeError,\n          // 404 Resource not found\n          'rate_limit_exceeded': RateLimitExceeded,\n          // 429 Rate limit exceeded\n          'internal_server_error': ExchangeError // 500 Internal server error\n\n        },\n        'broad': {\n          'request timestamp expired': InvalidNonce // {\"errors\":[{\"id\":\"authentication_error\",\"message\":\"request timestamp expired\"}]}\n\n        }\n      },\n      'commonCurrencies': {\n        'CGLD': 'CELO'\n      },\n      'options': {\n        'fetchCurrencies': {\n          'expires': 5000\n        },\n        'accounts': ['wallet', 'fiat' // 'vault',\n        ]\n      }\n    });\n  }\n\n  async fetchTime(params = {}) {\n    const response = await this.publicGetTime(params); //\n    //     {\n    //         \"data\": {\n    //             \"epoch\": 1589295679,\n    //             \"iso\": \"2020-05-12T15:01:19Z\"\n    //         }\n    //     }\n    //\n\n    const data = this.safeValue(response, 'data', {});\n    return this.safeTimestamp(data, 'epoch');\n  }\n\n  async fetchAccounts(params = {}) {\n    await this.loadMarkets();\n    const request = {\n      'limit': 100\n    };\n    const response = await this.privateGetAccounts(this.extend(request, params)); //\n    //     {\n    //         \"id\": \"XLM\",\n    //         \"name\": \"XLM Wallet\",\n    //         \"primary\": false,\n    //         \"type\": \"wallet\",\n    //         \"currency\": {\n    //             \"code\": \"XLM\",\n    //             \"name\": \"Stellar Lumens\",\n    //             \"color\": \"#000000\",\n    //             \"sort_index\": 127,\n    //             \"exponent\": 7,\n    //             \"type\": \"crypto\",\n    //             \"address_regex\": \"^G[A-Z2-7]{55}$\",\n    //             \"asset_id\": \"13b83335-5ede-595b-821e-5bcdfa80560f\",\n    //             \"destination_tag_name\": \"XLM Memo ID\",\n    //             \"destination_tag_regex\": \"^[ -~]{1,28}$\"\n    //         },\n    //         \"balance\": {\n    //             \"amount\": \"0.0000000\",\n    //             \"currency\": \"XLM\"\n    //         },\n    //         \"created_at\": null,\n    //         \"updated_at\": null,\n    //         \"resource\": \"account\",\n    //         \"resource_path\": \"/v2/accounts/XLM\",\n    //         \"allow_deposits\": true,\n    //         \"allow_withdrawals\": true\n    //     }\n    //\n\n    const data = this.safeValue(response, 'data', []);\n    const result = [];\n\n    for (let i = 0; i < data.length; i++) {\n      const account = data[i];\n      const currency = this.safeValue(account, 'currency', {});\n      const currencyId = this.safeString(currency, 'code');\n      const code = this.safeCurrencyCode(currencyId);\n      result.push({\n        'id': this.safeString(account, 'id'),\n        'type': this.safeString(account, 'type'),\n        'code': code,\n        'info': account\n      });\n    }\n\n    return result;\n  }\n\n  async createDepositAddress(code, params = {}) {\n    let accountId = this.safeString(params, 'account_id');\n    params = this.omit(params, 'account_id');\n\n    if (accountId === undefined) {\n      await this.loadAccounts();\n\n      for (let i = 0; i < this.accounts.length; i++) {\n        const account = this.accounts[i];\n\n        if (account['code'] === code && account['type'] === 'wallet') {\n          accountId = account['id'];\n          break;\n        }\n      }\n    }\n\n    if (accountId === undefined) {\n      throw new ExchangeError(this.id + ' createDepositAddress could not find the account with matching currency code, specify an `account_id` extra param');\n    }\n\n    const request = {\n      'account_id': accountId\n    };\n    const response = await this.privatePostAccountsAccountIdAddresses(this.extend(request, params)); //\n    //     {\n    //         \"data\": {\n    //             \"id\": \"05b1ebbf-9438-5dd4-b297-2ddedc98d0e4\",\n    //             \"address\": \"coinbasebase\",\n    //             \"address_info\": {\n    //                 \"address\": \"coinbasebase\",\n    //                 \"destination_tag\": \"287594668\"\n    //             },\n    //             \"name\": null,\n    //             \"created_at\": \"2019-07-01T14:39:29Z\",\n    //             \"updated_at\": \"2019-07-01T14:39:29Z\",\n    //             \"network\": \"eosio\",\n    //             \"uri_scheme\": \"eosio\",\n    //             \"resource\": \"address\",\n    //             \"resource_path\": \"/v2/accounts/14cfc769-e852-52f3-b831-711c104d194c/addresses/05b1ebbf-9438-5dd4-b297-2ddedc98d0e4\",\n    //             \"warnings\": [\n    //                 {\n    //                     \"title\": \"Only send EOS (EOS) to this address\",\n    //                     \"details\": \"Sending any other cryptocurrency will result in permanent loss.\",\n    //                     \"image_url\": \"https://dynamic-assets.coinbase.com/deaca3d47b10ed4a91a872e9618706eec34081127762d88f2476ac8e99ada4b48525a9565cf2206d18c04053f278f693434af4d4629ca084a9d01b7a286a7e26/asset_icons/1f8489bb280fb0a0fd643c1161312ba49655040e9aaaced5f9ad3eeaf868eadc.png\"\n    //                 },\n    //                 {\n    //                     \"title\": \"Both an address and EOS memo are required to receive EOS\",\n    //                     \"details\": \"If you send funds without an EOS memo or with an incorrect EOS memo, your funds cannot be credited to your account.\",\n    //                     \"image_url\": \"https://www.coinbase.com/assets/receive-warning-2f3269d83547a7748fb39d6e0c1c393aee26669bfea6b9f12718094a1abff155.png\"\n    //                 }\n    //             ],\n    //             \"warning_title\": \"Only send EOS (EOS) to this address\",\n    //             \"warning_details\": \"Sending any other cryptocurrency will result in permanent loss.\",\n    //             \"destination_tag\": \"287594668\",\n    //             \"deposit_uri\": \"eosio:coinbasebase?dt=287594668\",\n    //             \"callback_url\": null\n    //         }\n    //     }\n    //\n\n    const data = this.safeValue(response, 'data', {});\n    const tag = this.safeString(data, 'destination_tag');\n    const address = this.safeString(data, 'address');\n    return {\n      'currency': code,\n      'tag': tag,\n      'address': address,\n      'info': response\n    };\n  }\n\n  async fetchMySells(symbol = undefined, since = undefined, limit = undefined, params = {}) {\n    // they don't have an endpoint for all historical trades\n    const request = await this.prepareAccountRequest(limit, params);\n    await this.loadMarkets();\n    const query = this.omit(params, ['account_id', 'accountId']);\n    const sells = await this.privateGetAccountsAccountIdSells(this.extend(request, query));\n    return this.parseTrades(sells['data'], undefined, since, limit);\n  }\n\n  async fetchMyBuys(symbol = undefined, since = undefined, limit = undefined, params = {}) {\n    // they don't have an endpoint for all historical trades\n    const request = await this.prepareAccountRequest(limit, params);\n    await this.loadMarkets();\n    const query = this.omit(params, ['account_id', 'accountId']);\n    const buys = await this.privateGetAccountsAccountIdBuys(this.extend(request, query));\n    return this.parseTrades(buys['data'], undefined, since, limit);\n  }\n\n  async fetchTransactionsWithMethod(method, code = undefined, since = undefined, limit = undefined, params = {}) {\n    const request = await this.prepareAccountRequestWithCurrencyCode(code, limit, params);\n    await this.loadMarkets();\n    const query = this.omit(params, ['account_id', 'accountId']);\n    const response = await this[method](this.extend(request, query));\n    return this.parseTransactions(response['data'], undefined, since, limit);\n  }\n\n  async fetchWithdrawals(code = undefined, since = undefined, limit = undefined, params = {}) {\n    // fiat only, for crypto transactions use fetchLedger\n    return await this.fetchTransactionsWithMethod('privateGetAccountsAccountIdWithdrawals', code, since, limit, params);\n  }\n\n  async fetchDeposits(code = undefined, since = undefined, limit = undefined, params = {}) {\n    // fiat only, for crypto transactions use fetchLedger\n    return await this.fetchTransactionsWithMethod('privateGetAccountsAccountIdDeposits', code, since, limit, params);\n  }\n\n  parseTransactionStatus(status) {\n    const statuses = {\n      'created': 'pending',\n      'completed': 'ok',\n      'canceled': 'canceled'\n    };\n    return this.safeString(statuses, status, status);\n  }\n\n  parseTransaction(transaction, market = undefined) {\n    //\n    // fiat deposit\n    //\n    //     {\n    //         \"id\": \"f34c19f3-b730-5e3d-9f72\",\n    //         \"status\": \"completed\",\n    //         \"payment_method\": {\n    //             \"id\": \"a022b31d-f9c7-5043-98f2\",\n    //             \"resource\": \"payment_method\",\n    //             \"resource_path\": \"/v2/payment-methods/a022b31d-f9c7-5043-98f2\"\n    //         },\n    //         \"transaction\": {\n    //             \"id\": \"04ed4113-3732-5b0c-af86-b1d2146977d0\",\n    //             \"resource\": \"transaction\",\n    //             \"resource_path\": \"/v2/accounts/91cd2d36-3a91-55b6-a5d4-0124cf105483/transactions/04ed4113-3732-5b0c-af86\"\n    //         },\n    //         \"user_reference\": \"2VTYTH\",\n    //         \"created_at\": \"2017-02-09T07:01:18Z\",\n    //         \"updated_at\": \"2017-02-09T07:01:26Z\",\n    //         \"resource\": \"deposit\",\n    //         \"resource_path\": \"/v2/accounts/91cd2d36-3a91-55b6-a5d4-0124cf105483/deposits/f34c19f3-b730-5e3d-9f72\",\n    //         \"committed\": true,\n    //         \"payout_at\": \"2017-02-12T07:01:17Z\",\n    //         \"instant\": false,\n    //         \"fee\": { \"amount\": \"0.00\", \"currency\": \"EUR\" },\n    //         \"amount\": { \"amount\": \"114.02\", \"currency\": \"EUR\" },\n    //         \"subtotal\": { \"amount\": \"114.02\", \"currency\": \"EUR\" },\n    //         \"hold_until\": null,\n    //         \"hold_days\": 0,\n    //         \"hold_business_days\": 0,\n    //         \"next_step\": null\n    //     }\n    //\n    // fiat_withdrawal\n    //\n    //     {\n    //         \"id\": \"cfcc3b4a-eeb6-5e8c-8058\",\n    //         \"status\": \"completed\",\n    //         \"payment_method\": {\n    //             \"id\": \"8b94cfa4-f7fd-5a12-a76a\",\n    //             \"resource\": \"payment_method\",\n    //             \"resource_path\": \"/v2/payment-methods/8b94cfa4-f7fd-5a12-a76a\"\n    //         },\n    //         \"transaction\": {\n    //             \"id\": \"fcc2550b-5104-5f83-a444\",\n    //             \"resource\": \"transaction\",\n    //             \"resource_path\": \"/v2/accounts/91cd2d36-3a91-55b6-a5d4-0124cf105483/transactions/fcc2550b-5104-5f83-a444\"\n    //         },\n    //         \"user_reference\": \"MEUGK\",\n    //         \"created_at\": \"2018-07-26T08:55:12Z\",\n    //         \"updated_at\": \"2018-07-26T08:58:18Z\",\n    //         \"resource\": \"withdrawal\",\n    //         \"resource_path\": \"/v2/accounts/91cd2d36-3a91-55b6-a5d4-0124cf105483/withdrawals/cfcc3b4a-eeb6-5e8c-8058\",\n    //         \"committed\": true,\n    //         \"payout_at\": \"2018-07-31T08:55:12Z\",\n    //         \"instant\": false,\n    //         \"fee\": { \"amount\": \"0.15\", \"currency\": \"EUR\" },\n    //         \"amount\": { \"amount\": \"13130.69\", \"currency\": \"EUR\" },\n    //         \"subtotal\": { \"amount\": \"13130.84\", \"currency\": \"EUR\" },\n    //         \"idem\": \"e549dee5-63ed-4e79-8a96\",\n    //         \"next_step\": null\n    //     }\n    //\n    const subtotalObject = this.safeValue(transaction, 'subtotal', {});\n    const feeObject = this.safeValue(transaction, 'fee', {});\n    const id = this.safeString(transaction, 'id');\n    const timestamp = this.parse8601(this.safeValue(transaction, 'created_at'));\n    const updated = this.parse8601(this.safeValue(transaction, 'updated_at'));\n    const type = this.safeString(transaction, 'resource');\n    const amount = this.safeNumber(subtotalObject, 'amount');\n    const currencyId = this.safeString(subtotalObject, 'currency');\n    const currency = this.safeCurrencyCode(currencyId);\n    const feeCost = this.safeNumber(feeObject, 'amount');\n    const feeCurrencyId = this.safeString(feeObject, 'currency');\n    const feeCurrency = this.safeCurrencyCode(feeCurrencyId);\n    const fee = {\n      'cost': feeCost,\n      'currency': feeCurrency\n    };\n    let status = this.parseTransactionStatus(this.safeString(transaction, 'status'));\n\n    if (status === undefined) {\n      const committed = this.safeValue(transaction, 'committed');\n      status = committed ? 'ok' : 'pending';\n    }\n\n    return {\n      'info': transaction,\n      'id': id,\n      'txid': id,\n      'timestamp': timestamp,\n      'datetime': this.iso8601(timestamp),\n      'address': undefined,\n      'tag': undefined,\n      'type': type,\n      'amount': amount,\n      'currency': currency,\n      'status': status,\n      'updated': updated,\n      'fee': fee\n    };\n  }\n\n  parseTrade(trade, market = undefined) {\n    //\n    //     {\n    //         \"id\": \"67e0eaec-07d7-54c4-a72c-2e92826897df\",\n    //         \"status\": \"completed\",\n    //         \"payment_method\": {\n    //             \"id\": \"83562370-3e5c-51db-87da-752af5ab9559\",\n    //             \"resource\": \"payment_method\",\n    //             \"resource_path\": \"/v2/payment-methods/83562370-3e5c-51db-87da-752af5ab9559\"\n    //         },\n    //         \"transaction\": {\n    //             \"id\": \"441b9494-b3f0-5b98-b9b0-4d82c21c252a\",\n    //             \"resource\": \"transaction\",\n    //             \"resource_path\": \"/v2/accounts/2bbf394c-193b-5b2a-9155-3b4732659ede/transactions/441b9494-b3f0-5b98-b9b0-4d82c21c252a\"\n    //         },\n    //         \"amount\": { \"amount\": \"1.00000000\", \"currency\": \"BTC\" },\n    //         \"total\": { \"amount\": \"10.25\", \"currency\": \"USD\" },\n    //         \"subtotal\": { \"amount\": \"10.10\", \"currency\": \"USD\" },\n    //         \"created_at\": \"2015-01-31T20:49:02Z\",\n    //         \"updated_at\": \"2015-02-11T16:54:02-08:00\",\n    //         \"resource\": \"buy\",\n    //         \"resource_path\": \"/v2/accounts/2bbf394c-193b-5b2a-9155-3b4732659ede/buys/67e0eaec-07d7-54c4-a72c-2e92826897df\",\n    //         \"committed\": true,\n    //         \"instant\": false,\n    //         \"fee\": { \"amount\": \"0.15\", \"currency\": \"USD\" },\n    //         \"payout_at\": \"2015-02-18T16:54:00-08:00\"\n    //     }\n    //\n    let symbol = undefined;\n    const totalObject = this.safeValue(trade, 'total', {});\n    const amountObject = this.safeValue(trade, 'amount', {});\n    const subtotalObject = this.safeValue(trade, 'subtotal', {});\n    const feeObject = this.safeValue(trade, 'fee', {});\n    const id = this.safeString(trade, 'id');\n    const timestamp = this.parse8601(this.safeValue(trade, 'created_at'));\n\n    if (market === undefined) {\n      const baseId = this.safeString(amountObject, 'currency');\n      const quoteId = this.safeString(totalObject, 'currency');\n\n      if (baseId !== undefined && quoteId !== undefined) {\n        const base = this.safeCurrencyCode(baseId);\n        const quote = this.safeCurrencyCode(quoteId);\n        symbol = base + '/' + quote;\n      }\n    }\n\n    const orderId = undefined;\n    const side = this.safeString(trade, 'resource');\n    const type = undefined;\n    const costString = this.safeString(subtotalObject, 'amount');\n    const amountString = this.safeString(amountObject, 'amount');\n    const cost = this.parseNumber(costString);\n    const amount = this.parseNumber(amountString);\n    const price = this.parseNumber(Precise.stringDiv(costString, amountString));\n    const feeCost = this.safeNumber(feeObject, 'amount');\n    const feeCurrencyId = this.safeString(feeObject, 'currency');\n    const feeCurrency = this.safeCurrencyCode(feeCurrencyId);\n    const fee = {\n      'cost': feeCost,\n      'currency': feeCurrency\n    };\n    return {\n      'info': trade,\n      'id': id,\n      'order': orderId,\n      'timestamp': timestamp,\n      'datetime': this.iso8601(timestamp),\n      'symbol': symbol,\n      'type': type,\n      'side': side,\n      'takerOrMaker': undefined,\n      'price': price,\n      'amount': amount,\n      'cost': cost,\n      'fee': fee\n    };\n  }\n\n  async fetchMarkets(params = {}) {\n    const response = await this.fetchCurrenciesFromCache(params);\n    const currencies = this.safeValue(response, 'currencies', {});\n    const exchangeRates = this.safeValue(response, 'exchangeRates', {});\n    const data = this.safeValue(currencies, 'data', []);\n    const dataById = this.indexBy(data, 'id');\n    const rates = this.safeValue(this.safeValue(exchangeRates, 'data', {}), 'rates', {});\n    const baseIds = Object.keys(rates);\n    const result = [];\n\n    for (let i = 0; i < baseIds.length; i++) {\n      const baseId = baseIds[i];\n      const base = this.safeCurrencyCode(baseId);\n      const type = baseId in dataById ? 'fiat' : 'crypto'; // https://github.com/ccxt/ccxt/issues/6066\n\n      if (type === 'crypto') {\n        for (let j = 0; j < data.length; j++) {\n          const quoteCurrency = data[j];\n          const quoteId = this.safeString(quoteCurrency, 'id');\n          const quote = this.safeCurrencyCode(quoteId);\n          const symbol = base + '/' + quote;\n          const id = baseId + '-' + quoteId;\n          result.push({\n            'id': id,\n            'symbol': symbol,\n            'base': base,\n            'quote': quote,\n            'baseId': baseId,\n            'quoteId': quoteId,\n            'active': undefined,\n            'info': quoteCurrency,\n            'precision': {\n              'amount': undefined,\n              'price': undefined\n            },\n            'limits': {\n              'amount': {\n                'min': undefined,\n                'max': undefined\n              },\n              'price': {\n                'min': undefined,\n                'max': undefined\n              },\n              'cost': {\n                'min': this.safeNumber(quoteCurrency, 'min_size'),\n                'max': undefined\n              }\n            }\n          });\n        }\n      }\n    }\n\n    return result;\n  }\n\n  async fetchCurrenciesFromCache(params = {}) {\n    const options = this.safeValue(this.options, 'fetchCurrencies', {});\n    const timestamp = this.safeInteger(options, 'timestamp');\n    const expires = this.safeInteger(options, 'expires', 1000);\n    const now = this.milliseconds();\n\n    if (timestamp === undefined || now - timestamp > expires) {\n      const currencies = await this.publicGetCurrencies(params);\n      const exchangeRates = await this.publicGetExchangeRates(params);\n      this.options['fetchCurrencies'] = this.extend(options, {\n        'currencies': currencies,\n        'exchangeRates': exchangeRates,\n        'timestamp': now\n      });\n    }\n\n    return this.safeValue(this.options, 'fetchCurrencies', {});\n  }\n\n  async fetchCurrencies(params = {}) {\n    const response = await this.fetchCurrenciesFromCache(params);\n    const currencies = this.safeValue(response, 'currencies', {}); //\n    //     {\n    //         \"data\":[\n    //             {\"id\":\"AED\",\"name\":\"United Arab Emirates Dirham\",\"min_size\":\"0.01000000\"},\n    //             {\"id\":\"AFN\",\"name\":\"Afghan Afghani\",\"min_size\":\"0.01000000\"},\n    //             {\"id\":\"ALL\",\"name\":\"Albanian Lek\",\"min_size\":\"0.01000000\"},\n    //             {\"id\":\"AMD\",\"name\":\"Armenian Dram\",\"min_size\":\"0.01000000\"},\n    //             {\"id\":\"ANG\",\"name\":\"Netherlands Antillean Gulden\",\"min_size\":\"0.01000000\"},\n    //             // ...\n    //         ],\n    //     }\n    //\n\n    const exchangeRates = this.safeValue(response, 'exchangeRates', {}); //\n    //     {\n    //         \"data\":{\n    //             \"currency\":\"USD\",\n    //             \"rates\":{\n    //                 \"AED\":\"3.67\",\n    //                 \"AFN\":\"78.21\",\n    //                 \"ALL\":\"110.42\",\n    //                 \"AMD\":\"474.18\",\n    //                 \"ANG\":\"1.75\",\n    //                 // ...\n    //             },\n    //         }\n    //     }\n    //\n\n    const data = this.safeValue(currencies, 'data', []);\n    const dataById = this.indexBy(data, 'id');\n    const rates = this.safeValue(this.safeValue(exchangeRates, 'data', {}), 'rates', {});\n    const keys = Object.keys(rates);\n    const result = {};\n\n    for (let i = 0; i < keys.length; i++) {\n      const key = keys[i];\n      const type = key in dataById ? 'fiat' : 'crypto';\n      const currency = this.safeValue(dataById, key, {});\n      const id = this.safeString(currency, 'id', key);\n      const name = this.safeString(currency, 'name');\n      const code = this.safeCurrencyCode(id);\n      result[code] = {\n        'id': id,\n        'code': code,\n        'info': currency,\n        // the original payload\n        'type': type,\n        'name': name,\n        'active': true,\n        'fee': undefined,\n        'precision': undefined,\n        'limits': {\n          'amount': {\n            'min': this.safeNumber(currency, 'min_size'),\n            'max': undefined\n          },\n          'withdraw': {\n            'min': undefined,\n            'max': undefined\n          }\n        }\n      };\n    }\n\n    return result;\n  }\n\n  async fetchTicker(symbol, params = {}) {\n    await this.loadMarkets();\n    const timestamp = this.seconds();\n    const market = this.market(symbol);\n    const request = this.extend({\n      'symbol': market['id']\n    }, params);\n    const buy = await this.publicGetPricesSymbolBuy(request);\n    const sell = await this.publicGetPricesSymbolSell(request);\n    const spot = await this.publicGetPricesSymbolSpot(request);\n    const ask = this.safeNumber(buy['data'], 'amount');\n    const bid = this.safeNumber(sell['data'], 'amount');\n    const last = this.safeNumber(spot['data'], 'amount');\n    return {\n      'symbol': symbol,\n      'timestamp': timestamp,\n      'datetime': this.iso8601(timestamp),\n      'bid': bid,\n      'ask': ask,\n      'last': last,\n      'high': undefined,\n      'low': undefined,\n      'bidVolume': undefined,\n      'askVolume': undefined,\n      'vwap': undefined,\n      'open': undefined,\n      'close': last,\n      'previousClose': undefined,\n      'change': undefined,\n      'percentage': undefined,\n      'average': undefined,\n      'baseVolume': undefined,\n      'quoteVolume': undefined,\n      'info': {\n        'buy': buy,\n        'sell': sell,\n        'spot': spot\n      }\n    };\n  }\n\n  async fetchBalance(params = {}) {\n    await this.loadMarkets();\n    const request = {\n      'limit': 100\n    };\n    const response = await this.privateGetAccounts(this.extend(request, params));\n    const balances = this.safeValue(response, 'data');\n    const accounts = this.safeValue(params, 'type', this.options['accounts']);\n    const result = {\n      'info': response\n    };\n\n    for (let b = 0; b < balances.length; b++) {\n      const balance = balances[b];\n      const type = this.safeString(balance, 'type');\n\n      if (this.inArray(type, accounts)) {\n        const value = this.safeValue(balance, 'balance');\n\n        if (value !== undefined) {\n          const currencyId = this.safeString(value, 'currency');\n          const code = this.safeCurrencyCode(currencyId);\n          const total = this.safeString(value, 'amount');\n          const free = total;\n          let account = this.safeValue(result, code);\n\n          if (account === undefined) {\n            account = this.account();\n            account['free'] = free;\n            account['total'] = total;\n          } else {\n            account['free'] = Precise.stringAdd(account['free'], total);\n            account['total'] = Precise.stringAdd(account['total'], total);\n          }\n\n          result[code] = account;\n        }\n      }\n    }\n\n    return this.parseBalance(result, false);\n  }\n\n  async fetchLedger(code = undefined, since = undefined, limit = undefined, params = {}) {\n    await this.loadMarkets();\n    let currency = undefined;\n\n    if (code !== undefined) {\n      currency = this.currency(code);\n    }\n\n    const request = await this.prepareAccountRequestWithCurrencyCode(code, limit, params);\n    const query = this.omit(params, ['account_id', 'accountId']); // for pagination use parameter 'starting_after'\n    // the value for the next page can be obtained from the result of the previous call in the 'pagination' field\n    // eg: instance.last_json_response.pagination.next_starting_after\n\n    const response = await this.privateGetAccountsAccountIdTransactions(this.extend(request, query));\n    return this.parseLedger(response['data'], currency, since, limit);\n  }\n\n  parseLedgerEntryStatus(status) {\n    const types = {\n      'completed': 'ok'\n    };\n    return this.safeString(types, status, status);\n  }\n\n  parseLedgerEntryType(type) {\n    const types = {\n      'buy': 'trade',\n      'sell': 'trade',\n      'fiat_deposit': 'transaction',\n      'fiat_withdrawal': 'transaction',\n      'exchange_deposit': 'transaction',\n      // fiat withdrawal (from coinbase to coinbasepro)\n      'exchange_withdrawal': 'transaction',\n      // fiat deposit (to coinbase from coinbasepro)\n      'send': 'transaction',\n      // crypto deposit OR withdrawal\n      'pro_deposit': 'transaction',\n      // crypto withdrawal (from coinbase to coinbasepro)\n      'pro_withdrawal': 'transaction' // crypto deposit (to coinbase from coinbasepro)\n\n    };\n    return this.safeString(types, type, type);\n  }\n\n  parseLedgerEntry(item, currency = undefined) {\n    //\n    // crypto deposit transaction\n    //\n    //     {\n    //         id: '34e4816b-4c8c-5323-a01c-35a9fa26e490',\n    //         type: 'send',\n    //         status: 'completed',\n    //         amount: { amount: '28.31976528', currency: 'BCH' },\n    //         native_amount: { amount: '2799.65', currency: 'GBP' },\n    //         description: null,\n    //         created_at: '2019-02-28T12:35:20Z',\n    //         updated_at: '2019-02-28T12:43:24Z',\n    //         resource: 'transaction',\n    //         resource_path: '/v2/accounts/c01d7364-edd7-5f3a-bd1d-de53d4cbb25e/transactions/34e4816b-4c8c-5323-a01c-35a9fa26e490',\n    //         instant_exchange: false,\n    //         network: {\n    //             status: 'confirmed',\n    //             hash: '56222d865dae83774fccb2efbd9829cf08c75c94ce135bfe4276f3fb46d49701',\n    //             transaction_url: 'https://bch.btc.com/56222d865dae83774fccb2efbd9829cf08c75c94ce135bfe4276f3fb46d49701'\n    //         },\n    //         from: { resource: 'bitcoin_cash_network', currency: 'BCH' },\n    //         details: { title: 'Received Bitcoin Cash', subtitle: 'From Bitcoin Cash address' }\n    //     }\n    //\n    // crypto withdrawal transaction\n    //\n    //     {\n    //         id: '459aad99-2c41-5698-ac71-b6b81a05196c',\n    //         type: 'send',\n    //         status: 'completed',\n    //         amount: { amount: '-0.36775642', currency: 'BTC' },\n    //         native_amount: { amount: '-1111.65', currency: 'GBP' },\n    //         description: null,\n    //         created_at: '2019-03-20T08:37:07Z',\n    //         updated_at: '2019-03-20T08:49:33Z',\n    //         resource: 'transaction',\n    //         resource_path: '/v2/accounts/c6afbd34-4bd0-501e-8616-4862c193cd84/transactions/459aad99-2c41-5698-ac71-b6b81a05196c',\n    //         instant_exchange: false,\n    //         network: {\n    //             status: 'confirmed',\n    //             hash: '2732bbcf35c69217c47b36dce64933d103895277fe25738ffb9284092701e05b',\n    //             transaction_url: 'https://blockchain.info/tx/2732bbcf35c69217c47b36dce64933d103895277fe25738ffb9284092701e05b',\n    //             transaction_fee: { amount: '0.00000000', currency: 'BTC' },\n    //             transaction_amount: { amount: '0.36775642', currency: 'BTC' },\n    //             confirmations: 15682\n    //         },\n    //         to: {\n    //             resource: 'bitcoin_address',\n    //             address: '1AHnhqbvbYx3rnZx8uC7NbFZaTe4tafFHX',\n    //             currency: 'BTC',\n    //             address_info: { address: '1AHnhqbvbYx3rnZx8uC7NbFZaTe4tafFHX' }\n    //         },\n    //         idem: 'da0a2f14-a2af-4c5a-a37e-d4484caf582bsend',\n    //         application: {\n    //             id: '5756ab6e-836b-553b-8950-5e389451225d',\n    //             resource: 'application',\n    //             resource_path: '/v2/applications/5756ab6e-836b-553b-8950-5e389451225d'\n    //         },\n    //         details: { title: 'Sent Bitcoin', subtitle: 'To Bitcoin address' }\n    //     }\n    //\n    // withdrawal transaction from coinbase to coinbasepro\n    //\n    //     {\n    //         id: '5b1b9fb8-5007-5393-b923-02903b973fdc',\n    //         type: 'pro_deposit',\n    //         status: 'completed',\n    //         amount: { amount: '-0.00001111', currency: 'BCH' },\n    //         native_amount: { amount: '0.00', currency: 'GBP' },\n    //         description: null,\n    //         created_at: '2019-02-28T13:31:58Z',\n    //         updated_at: '2019-02-28T13:31:58Z',\n    //         resource: 'transaction',\n    //         resource_path: '/v2/accounts/c01d7364-edd7-5f3a-bd1d-de53d4cbb25e/transactions/5b1b9fb8-5007-5393-b923-02903b973fdc',\n    //         instant_exchange: false,\n    //         application: {\n    //             id: '5756ab6e-836b-553b-8950-5e389451225d',\n    //             resource: 'application',\n    //             resource_path: '/v2/applications/5756ab6e-836b-553b-8950-5e389451225d'\n    //         },\n    //         details: { title: 'Transferred Bitcoin Cash', subtitle: 'To Coinbase Pro' }\n    //     }\n    //\n    // withdrawal transaction from coinbase to gdax\n    //\n    //     {\n    //         id: 'badb7313-a9d3-5c07-abd0-00f8b44199b1',\n    //         type: 'exchange_deposit',\n    //         status: 'completed',\n    //         amount: { amount: '-0.43704149', currency: 'BCH' },\n    //         native_amount: { amount: '-51.90', currency: 'GBP' },\n    //         description: null,\n    //         created_at: '2019-03-19T10:30:40Z',\n    //         updated_at: '2019-03-19T10:30:40Z',\n    //         resource: 'transaction',\n    //         resource_path: '/v2/accounts/c01d7364-edd7-5f3a-bd1d-de53d4cbb25e/transactions/badb7313-a9d3-5c07-abd0-00f8b44199b1',\n    //         instant_exchange: false,\n    //         details: { title: 'Transferred Bitcoin Cash', subtitle: 'To GDAX' }\n    //     }\n    //\n    // deposit transaction from gdax to coinbase\n    //\n    //     {\n    //         id: '9c4b642c-8688-58bf-8962-13cef64097de',\n    //         type: 'exchange_withdrawal',\n    //         status: 'completed',\n    //         amount: { amount: '0.57729420', currency: 'BTC' },\n    //         native_amount: { amount: '4418.72', currency: 'GBP' },\n    //         description: null,\n    //         created_at: '2018-02-17T11:33:33Z',\n    //         updated_at: '2018-02-17T11:33:33Z',\n    //         resource: 'transaction',\n    //         resource_path: '/v2/accounts/c6afbd34-4bd0-501e-8616-4862c193cd84/transactions/9c4b642c-8688-58bf-8962-13cef64097de',\n    //         instant_exchange: false,\n    //         details: { title: 'Transferred Bitcoin', subtitle: 'From GDAX' }\n    //     }\n    //\n    // deposit transaction from coinbasepro to coinbase\n    //\n    //     {\n    //         id: '8d6dd0b9-3416-568a-889d-8f112fae9e81',\n    //         type: 'pro_withdrawal',\n    //         status: 'completed',\n    //         amount: { amount: '0.40555386', currency: 'BTC' },\n    //         native_amount: { amount: '1140.27', currency: 'GBP' },\n    //         description: null,\n    //         created_at: '2019-03-04T19:41:58Z',\n    //         updated_at: '2019-03-04T19:41:58Z',\n    //         resource: 'transaction',\n    //         resource_path: '/v2/accounts/c6afbd34-4bd0-501e-8616-4862c193cd84/transactions/8d6dd0b9-3416-568a-889d-8f112fae9e81',\n    //         instant_exchange: false,\n    //         application: {\n    //             id: '5756ab6e-836b-553b-8950-5e389451225d',\n    //             resource: 'application',\n    //             resource_path: '/v2/applications/5756ab6e-836b-553b-8950-5e389451225d'\n    //         },\n    //         details: { title: 'Transferred Bitcoin', subtitle: 'From Coinbase Pro' }\n    //     }\n    //\n    // sell trade\n    //\n    //     {\n    //         id: 'a9409207-df64-585b-97ab-a50780d2149e',\n    //         type: 'sell',\n    //         status: 'completed',\n    //         amount: { amount: '-9.09922880', currency: 'BTC' },\n    //         native_amount: { amount: '-7285.73', currency: 'GBP' },\n    //         description: null,\n    //         created_at: '2017-03-27T15:38:34Z',\n    //         updated_at: '2017-03-27T15:38:34Z',\n    //         resource: 'transaction',\n    //         resource_path: '/v2/accounts/c6afbd34-4bd0-501e-8616-4862c193cd84/transactions/a9409207-df64-585b-97ab-a50780d2149e',\n    //         instant_exchange: false,\n    //         sell: {\n    //             id: 'e3550b4d-8ae6-5de3-95fe-1fb01ba83051',\n    //             resource: 'sell',\n    //             resource_path: '/v2/accounts/c6afbd34-4bd0-501e-8616-4862c193cd84/sells/e3550b4d-8ae6-5de3-95fe-1fb01ba83051'\n    //         },\n    //         details: {\n    //             title: 'Sold Bitcoin',\n    //             subtitle: 'Using EUR Wallet',\n    //             payment_method_name: 'EUR Wallet'\n    //         }\n    //     }\n    //\n    // buy trade\n    //\n    //     {\n    //         id: '63eeed67-9396-5912-86e9-73c4f10fe147',\n    //         type: 'buy',\n    //         status: 'completed',\n    //         amount: { amount: '2.39605772', currency: 'ETH' },\n    //         native_amount: { amount: '98.31', currency: 'GBP' },\n    //         description: null,\n    //         created_at: '2017-03-27T09:07:56Z',\n    //         updated_at: '2017-03-27T09:07:57Z',\n    //         resource: 'transaction',\n    //         resource_path: '/v2/accounts/8902f85d-4a69-5d74-82fe-8e390201bda7/transactions/63eeed67-9396-5912-86e9-73c4f10fe147',\n    //         instant_exchange: false,\n    //         buy: {\n    //             id: '20b25b36-76c6-5353-aa57-b06a29a39d82',\n    //             resource: 'buy',\n    //             resource_path: '/v2/accounts/8902f85d-4a69-5d74-82fe-8e390201bda7/buys/20b25b36-76c6-5353-aa57-b06a29a39d82'\n    //         },\n    //         details: {\n    //             title: 'Bought Ethereum',\n    //             subtitle: 'Using EUR Wallet',\n    //             payment_method_name: 'EUR Wallet'\n    //         }\n    //     }\n    //\n    // fiat deposit transaction\n    //\n    //     {\n    //         id: '04ed4113-3732-5b0c-af86-b1d2146977d0',\n    //         type: 'fiat_deposit',\n    //         status: 'completed',\n    //         amount: { amount: '114.02', currency: 'EUR' },\n    //         native_amount: { amount: '97.23', currency: 'GBP' },\n    //         description: null,\n    //         created_at: '2017-02-09T07:01:21Z',\n    //         updated_at: '2017-02-09T07:01:22Z',\n    //         resource: 'transaction',\n    //         resource_path: '/v2/accounts/91cd2d36-3a91-55b6-a5d4-0124cf105483/transactions/04ed4113-3732-5b0c-af86-b1d2146977d0',\n    //         instant_exchange: false,\n    //         fiat_deposit: {\n    //             id: 'f34c19f3-b730-5e3d-9f72-96520448677a',\n    //             resource: 'fiat_deposit',\n    //             resource_path: '/v2/accounts/91cd2d36-3a91-55b6-a5d4-0124cf105483/deposits/f34c19f3-b730-5e3d-9f72-96520448677a'\n    //         },\n    //         details: {\n    //             title: 'Deposited funds',\n    //             subtitle: 'From SEPA Transfer (GB47 BARC 20..., reference CBADVI)',\n    //             payment_method_name: 'SEPA Transfer (GB47 BARC 20..., reference CBADVI)'\n    //         }\n    //     }\n    //\n    // fiat withdrawal transaction\n    //\n    //     {\n    //         id: '957d98e2-f80e-5e2f-a28e-02945aa93079',\n    //         type: 'fiat_withdrawal',\n    //         status: 'completed',\n    //         amount: { amount: '-11000.00', currency: 'EUR' },\n    //         native_amount: { amount: '-9698.22', currency: 'GBP' },\n    //         description: null,\n    //         created_at: '2017-12-06T13:19:19Z',\n    //         updated_at: '2017-12-06T13:19:19Z',\n    //         resource: 'transaction',\n    //         resource_path: '/v2/accounts/91cd2d36-3a91-55b6-a5d4-0124cf105483/transactions/957d98e2-f80e-5e2f-a28e-02945aa93079',\n    //         instant_exchange: false,\n    //         fiat_withdrawal: {\n    //             id: 'f4bf1fd9-ab3b-5de7-906d-ed3e23f7a4e7',\n    //             resource: 'fiat_withdrawal',\n    //             resource_path: '/v2/accounts/91cd2d36-3a91-55b6-a5d4-0124cf105483/withdrawals/f4bf1fd9-ab3b-5de7-906d-ed3e23f7a4e7'\n    //         },\n    //         details: {\n    //             title: 'Withdrew funds',\n    //             subtitle: 'To HSBC BANK PLC (GB74 MIDL...)',\n    //             payment_method_name: 'HSBC BANK PLC (GB74 MIDL...)'\n    //         }\n    //     }\n    //\n    const amountInfo = this.safeValue(item, 'amount', {});\n    let amount = this.safeNumber(amountInfo, 'amount');\n    let direction = undefined;\n\n    if (amount < 0) {\n      direction = 'out';\n      amount = -amount;\n    } else {\n      direction = 'in';\n    }\n\n    const currencyId = this.safeString(amountInfo, 'currency');\n    const code = this.safeCurrencyCode(currencyId, currency); //\n    // the address and txid do not belong to the unified ledger structure\n    //\n    //     let address = undefined;\n    //     if (item['to']) {\n    //         address = this.safeString (item['to'], 'address');\n    //     }\n    //     let txid = undefined;\n    //\n\n    let fee = undefined;\n    const networkInfo = this.safeValue(item, 'network', {}); // txid = network['hash']; // txid does not belong to the unified ledger structure\n\n    const feeInfo = this.safeValue(networkInfo, 'transaction_fee');\n\n    if (feeInfo !== undefined) {\n      const feeCurrencyId = this.safeString(feeInfo, 'currency');\n      const feeCurrencyCode = this.safeCurrencyCode(feeCurrencyId, currency);\n      const feeAmount = this.safeNumber(feeInfo, 'amount');\n      fee = {\n        'cost': feeAmount,\n        'currency': feeCurrencyCode\n      };\n    }\n\n    const timestamp = this.parse8601(this.safeValue(item, 'created_at'));\n    const id = this.safeString(item, 'id');\n    const type = this.parseLedgerEntryType(this.safeString(item, 'type'));\n    const status = this.parseLedgerEntryStatus(this.safeString(item, 'status'));\n    const path = this.safeString(item, 'resource_path');\n    let accountId = undefined;\n\n    if (path !== undefined) {\n      const parts = path.split('/');\n      const numParts = parts.length;\n\n      if (numParts > 3) {\n        accountId = parts[3];\n      }\n    }\n\n    return {\n      'info': item,\n      'id': id,\n      'timestamp': timestamp,\n      'datetime': this.iso8601(timestamp),\n      'direction': direction,\n      'account': accountId,\n      'referenceId': undefined,\n      'referenceAccount': undefined,\n      'type': type,\n      'currency': code,\n      'amount': amount,\n      'before': undefined,\n      'after': undefined,\n      'status': status,\n      'fee': fee\n    };\n  }\n\n  async findAccountId(code) {\n    await this.loadMarkets();\n    await this.loadAccounts();\n\n    for (let i = 0; i < this.accounts.length; i++) {\n      const account = this.accounts[i];\n\n      if (account['code'] === code) {\n        return account['id'];\n      }\n    }\n\n    return undefined;\n  }\n\n  prepareAccountRequest(limit = undefined, params = {}) {\n    const accountId = this.safeString2(params, 'account_id', 'accountId');\n\n    if (accountId === undefined) {\n      throw new ArgumentsRequired(this.id + ' method requires an account_id (or accountId) parameter');\n    }\n\n    const request = {\n      'account_id': accountId\n    };\n\n    if (limit !== undefined) {\n      request['limit'] = limit;\n    }\n\n    return request;\n  }\n\n  async prepareAccountRequestWithCurrencyCode(code = undefined, limit = undefined, params = {}) {\n    let accountId = this.safeString2(params, 'account_id', 'accountId');\n\n    if (accountId === undefined) {\n      if (code === undefined) {\n        throw new ArgumentsRequired(this.id + ' method requires an account_id (or accountId) parameter OR a currency code argument');\n      }\n\n      accountId = await this.findAccountId(code);\n\n      if (accountId === undefined) {\n        throw new ExchangeError(this.id + ' could not find account id for ' + code);\n      }\n    }\n\n    const request = {\n      'account_id': accountId\n    };\n\n    if (limit !== undefined) {\n      request['limit'] = limit;\n    }\n\n    return request;\n  }\n\n  sign(path, api = 'public', method = 'GET', params = {}, headers = undefined, body = undefined) {\n    let fullPath = '/' + this.version + '/' + this.implodeParams(path, params);\n    const query = this.omit(params, this.extractParams(path));\n\n    if (method === 'GET') {\n      if (Object.keys(query).length) {\n        fullPath += '?' + this.urlencode(query);\n      }\n    }\n\n    const url = this.urls['api'] + fullPath;\n\n    if (api === 'private') {\n      this.checkRequiredCredentials();\n      const nonce = this.nonce().toString();\n      let payload = '';\n\n      if (method !== 'GET') {\n        if (Object.keys(query).length) {\n          body = this.json(query);\n          payload = body;\n        }\n      }\n\n      const auth = nonce + method + fullPath + payload;\n      const signature = this.hmac(this.encode(auth), this.encode(this.secret));\n      headers = {\n        'CB-ACCESS-KEY': this.apiKey,\n        'CB-ACCESS-SIGN': signature,\n        'CB-ACCESS-TIMESTAMP': nonce,\n        'Content-Type': 'application/json'\n      };\n    }\n\n    return {\n      'url': url,\n      'method': method,\n      'body': body,\n      'headers': headers\n    };\n  }\n\n  handleErrors(code, reason, url, method, headers, body, response, requestHeaders, requestBody) {\n    if (response === undefined) {\n      return; // fallback to default error handler\n    }\n\n    const feedback = this.id + ' ' + body; //\n    //    {\"error\": \"invalid_request\", \"error_description\": \"The request is missing a required parameter, includes an unsupported parameter value, or is otherwise malformed.\"}\n    //\n    // or\n    //\n    //    {\n    //      \"errors\": [\n    //        {\n    //          \"id\": \"not_found\",\n    //          \"message\": \"Not found\"\n    //        }\n    //      ]\n    //    }\n    //\n\n    let errorCode = this.safeString(response, 'error');\n\n    if (errorCode !== undefined) {\n      const errorMessage = this.safeString(response, 'error_description');\n      this.throwExactlyMatchedException(this.exceptions['exact'], errorCode, feedback);\n      this.throwBroadlyMatchedException(this.exceptions['broad'], errorMessage, feedback);\n      throw new ExchangeError(feedback);\n    }\n\n    const errors = this.safeValue(response, 'errors');\n\n    if (errors !== undefined) {\n      if (Array.isArray(errors)) {\n        const numErrors = errors.length;\n\n        if (numErrors > 0) {\n          errorCode = this.safeString(errors[0], 'id');\n          const errorMessage = this.safeString(errors[0], 'message');\n\n          if (errorCode !== undefined) {\n            this.throwExactlyMatchedException(this.exceptions['exact'], errorCode, feedback);\n            this.throwBroadlyMatchedException(this.exceptions['broad'], errorMessage, feedback);\n            throw new ExchangeError(feedback);\n          }\n        }\n      }\n    }\n\n    const data = this.safeValue(response, 'data');\n\n    if (data === undefined) {\n      throw new ExchangeError(this.id + ' failed due to a malformed response ' + this.json(response));\n    }\n  }\n\n};","map":{"version":3,"sources":["C:/Users/James Price/Documents/VS Code/bixpro/node_modules/ccxt/js/coinbase.js"],"names":["Exchange","require","ExchangeError","ArgumentsRequired","AuthenticationError","RateLimitExceeded","InvalidNonce","Precise","module","exports","coinbase","describe","deepExtend","userAgents","fetchTime","params","response","publicGetTime","data","safeValue","safeTimestamp","fetchAccounts","loadMarkets","request","privateGetAccounts","extend","result","i","length","account","currency","currencyId","safeString","code","safeCurrencyCode","push","createDepositAddress","accountId","omit","undefined","loadAccounts","accounts","id","privatePostAccountsAccountIdAddresses","tag","address","fetchMySells","symbol","since","limit","prepareAccountRequest","query","sells","privateGetAccountsAccountIdSells","parseTrades","fetchMyBuys","buys","privateGetAccountsAccountIdBuys","fetchTransactionsWithMethod","method","prepareAccountRequestWithCurrencyCode","parseTransactions","fetchWithdrawals","fetchDeposits","parseTransactionStatus","status","statuses","parseTransaction","transaction","market","subtotalObject","feeObject","timestamp","parse8601","updated","type","amount","safeNumber","feeCost","feeCurrencyId","feeCurrency","fee","committed","iso8601","parseTrade","trade","totalObject","amountObject","baseId","quoteId","base","quote","orderId","side","costString","amountString","cost","parseNumber","price","stringDiv","fetchMarkets","fetchCurrenciesFromCache","currencies","exchangeRates","dataById","indexBy","rates","baseIds","Object","keys","j","quoteCurrency","options","safeInteger","expires","now","milliseconds","publicGetCurrencies","publicGetExchangeRates","fetchCurrencies","key","name","fetchTicker","seconds","buy","publicGetPricesSymbolBuy","sell","publicGetPricesSymbolSell","spot","publicGetPricesSymbolSpot","ask","bid","last","fetchBalance","balances","b","balance","inArray","value","total","free","stringAdd","parseBalance","fetchLedger","privateGetAccountsAccountIdTransactions","parseLedger","parseLedgerEntryStatus","types","parseLedgerEntryType","parseLedgerEntry","item","amountInfo","direction","networkInfo","feeInfo","feeCurrencyCode","feeAmount","path","parts","split","numParts","findAccountId","safeString2","sign","api","headers","body","fullPath","version","implodeParams","extractParams","urlencode","url","urls","checkRequiredCredentials","nonce","toString","payload","json","auth","signature","hmac","encode","secret","apiKey","handleErrors","reason","requestHeaders","requestBody","feedback","errorCode","errorMessage","throwExactlyMatchedException","exceptions","throwBroadlyMatchedException","errors","Array","isArray","numErrors"],"mappings":"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ACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,UAAMgH,UAAU,GAAG,KAAKpI,SAAL,CAAgBmI,IAAhB,EAAsB,QAAtB,EAAgC,EAAhC,CAAnB;AACA,QAAI1E,MAAM,GAAG,KAAKC,UAAL,CAAiB0E,UA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","sourcesContent":["'use strict';\n\n// ----------------------------------------------------------------------------\n\nconst Exchange = require ('./base/Exchange');\nconst { ExchangeError, ArgumentsRequired, AuthenticationError, RateLimitExceeded, InvalidNonce } = require ('./base/errors');\nconst Precise = require ('./base/Precise');\n\n// ----------------------------------------------------------------------------\n\nmodule.exports = class coinbase extends Exchange {\n    describe () {\n        return this.deepExtend (super.describe (), {\n            'id': 'coinbase',\n            'name': 'Coinbase',\n            'countries': [ 'US' ],\n            'rateLimit': 400, // 10k calls per hour\n            'version': 'v2',\n            'userAgent': this.userAgents['chrome'],\n            'headers': {\n                'CB-VERSION': '2018-05-30',\n            },\n            'has': {\n                'CORS': true,\n                'cancelOrder': false,\n                'createDepositAddress': true,\n                'createOrder': false,\n                'deposit': false,\n                'fetchBalance': true,\n                'fetchClosedOrders': false,\n                'fetchCurrencies': true,\n                'fetchDepositAddress': false,\n                'fetchMarkets': true,\n                'fetchMyTrades': false,\n                'fetchOHLCV': false,\n                'fetchOpenOrders': false,\n                'fetchOrder': false,\n                'fetchOrderBook': false,\n                'fetchL2OrderBook': false,\n                'fetchLedger': true,\n                'fetchOrders': false,\n                'fetchTicker': true,\n                'fetchTickers': false,\n                'fetchTime': true,\n                'fetchBidsAsks': false,\n                'fetchTrades': false,\n                'withdraw': false,\n                'fetchTransactions': false,\n                'fetchDeposits': true,\n                'fetchWithdrawals': true,\n                'fetchMySells': true,\n                'fetchMyBuys': true,\n            },\n            'urls': {\n                'logo': 'https://user-images.githubusercontent.com/1294454/40811661-b6eceae2-653a-11e8-829e-10bfadb078cf.jpg',\n                'api': 'https://api.coinbase.com',\n                'www': 'https://www.coinbase.com',\n                'doc': 'https://developers.coinbase.com/api/v2',\n                'fees': 'https://support.coinbase.com/customer/portal/articles/2109597-buy-sell-bank-transfer-fees',\n                'referral': 'https://www.coinbase.com/join/58cbe25a355148797479dbd2',\n            },\n            'requiredCredentials': {\n                'apiKey': true,\n                'secret': true,\n            },\n            'api': {\n                'public': {\n                    'get': [\n                        'currencies',\n                        'time',\n                        'exchange-rates',\n                        'users/{user_id}',\n                        'prices/{symbol}/buy',\n                        'prices/{symbol}/sell',\n                        'prices/{symbol}/spot',\n                    ],\n                },\n                'private': {\n                    'get': [\n                        'accounts',\n                        'accounts/{account_id}',\n                        'accounts/{account_id}/addresses',\n                        'accounts/{account_id}/addresses/{address_id}',\n                        'accounts/{account_id}/addresses/{address_id}/transactions',\n                        'accounts/{account_id}/transactions',\n                        'accounts/{account_id}/transactions/{transaction_id}',\n                        'accounts/{account_id}/buys',\n                        'accounts/{account_id}/buys/{buy_id}',\n                        'accounts/{account_id}/sells',\n                        'accounts/{account_id}/sells/{sell_id}',\n                        'accounts/{account_id}/deposits',\n                        'accounts/{account_id}/deposits/{deposit_id}',\n                        'accounts/{account_id}/withdrawals',\n                        'accounts/{account_id}/withdrawals/{withdrawal_id}',\n                        'payment-methods',\n                        'payment-methods/{payment_method_id}',\n                        'user',\n                        'user/auth',\n                    ],\n                    'post': [\n                        'accounts',\n                        'accounts/{account_id}/primary',\n                        'accounts/{account_id}/addresses',\n                        'accounts/{account_id}/transactions',\n                        'accounts/{account_id}/transactions/{transaction_id}/complete',\n                        'accounts/{account_id}/transactions/{transaction_id}/resend',\n                        'accounts/{account_id}/buys',\n                        'accounts/{account_id}/buys/{buy_id}/commit',\n                        'accounts/{account_id}/sells',\n                        'accounts/{account_id}/sells/{sell_id}/commit',\n                        'accounts/{account_id}/deposists',\n                        'accounts/{account_id}/deposists/{deposit_id}/commit',\n                        'accounts/{account_id}/withdrawals',\n                        'accounts/{account_id}/withdrawals/{withdrawal_id}/commit',\n                    ],\n                    'put': [\n                        'accounts/{account_id}',\n                        'user',\n                    ],\n                    'delete': [\n                        'accounts/{id}',\n                        'accounts/{account_id}/transactions/{transaction_id}',\n                    ],\n                },\n            },\n            'exceptions': {\n                'exact': {\n                    'two_factor_required': AuthenticationError, // 402 When sending money over 2fa limit\n                    'param_required': ExchangeError, // 400 Missing parameter\n                    'validation_error': ExchangeError, // 400 Unable to validate POST/PUT\n                    'invalid_request': ExchangeError, // 400 Invalid request\n                    'personal_details_required': AuthenticationError, // 400 User’s personal detail required to complete this request\n                    'identity_verification_required': AuthenticationError, // 400 Identity verification is required to complete this request\n                    'jumio_verification_required': AuthenticationError, // 400 Document verification is required to complete this request\n                    'jumio_face_match_verification_required': AuthenticationError, // 400 Document verification including face match is required to complete this request\n                    'unverified_email': AuthenticationError, // 400 User has not verified their email\n                    'authentication_error': AuthenticationError, // 401 Invalid auth (generic)\n                    'invalid_token': AuthenticationError, // 401 Invalid Oauth token\n                    'revoked_token': AuthenticationError, // 401 Revoked Oauth token\n                    'expired_token': AuthenticationError, // 401 Expired Oauth token\n                    'invalid_scope': AuthenticationError, // 403 User hasn’t authenticated necessary scope\n                    'not_found': ExchangeError, // 404 Resource not found\n                    'rate_limit_exceeded': RateLimitExceeded, // 429 Rate limit exceeded\n                    'internal_server_error': ExchangeError, // 500 Internal server error\n                },\n                'broad': {\n                    'request timestamp expired': InvalidNonce, // {\"errors\":[{\"id\":\"authentication_error\",\"message\":\"request timestamp expired\"}]}\n                },\n            },\n            'commonCurrencies': {\n                'CGLD': 'CELO',\n            },\n            'options': {\n                'fetchCurrencies': {\n                    'expires': 5000,\n                },\n                'accounts': [\n                    'wallet',\n                    'fiat',\n                    // 'vault',\n                ],\n            },\n        });\n    }\n\n    async fetchTime (params = {}) {\n        const response = await this.publicGetTime (params);\n        //\n        //     {\n        //         \"data\": {\n        //             \"epoch\": 1589295679,\n        //             \"iso\": \"2020-05-12T15:01:19Z\"\n        //         }\n        //     }\n        //\n        const data = this.safeValue (response, 'data', {});\n        return this.safeTimestamp (data, 'epoch');\n    }\n\n    async fetchAccounts (params = {}) {\n        await this.loadMarkets ();\n        const request = {\n            'limit': 100,\n        };\n        const response = await this.privateGetAccounts (this.extend (request, params));\n        //\n        //     {\n        //         \"id\": \"XLM\",\n        //         \"name\": \"XLM Wallet\",\n        //         \"primary\": false,\n        //         \"type\": \"wallet\",\n        //         \"currency\": {\n        //             \"code\": \"XLM\",\n        //             \"name\": \"Stellar Lumens\",\n        //             \"color\": \"#000000\",\n        //             \"sort_index\": 127,\n        //             \"exponent\": 7,\n        //             \"type\": \"crypto\",\n        //             \"address_regex\": \"^G[A-Z2-7]{55}$\",\n        //             \"asset_id\": \"13b83335-5ede-595b-821e-5bcdfa80560f\",\n        //             \"destination_tag_name\": \"XLM Memo ID\",\n        //             \"destination_tag_regex\": \"^[ -~]{1,28}$\"\n        //         },\n        //         \"balance\": {\n        //             \"amount\": \"0.0000000\",\n        //             \"currency\": \"XLM\"\n        //         },\n        //         \"created_at\": null,\n        //         \"updated_at\": null,\n        //         \"resource\": \"account\",\n        //         \"resource_path\": \"/v2/accounts/XLM\",\n        //         \"allow_deposits\": true,\n        //         \"allow_withdrawals\": true\n        //     }\n        //\n        const data = this.safeValue (response, 'data', []);\n        const result = [];\n        for (let i = 0; i < data.length; i++) {\n            const account = data[i];\n            const currency = this.safeValue (account, 'currency', {});\n            const currencyId = this.safeString (currency, 'code');\n            const code = this.safeCurrencyCode (currencyId);\n            result.push ({\n                'id': this.safeString (account, 'id'),\n                'type': this.safeString (account, 'type'),\n                'code': code,\n                'info': account,\n            });\n        }\n        return result;\n    }\n\n    async createDepositAddress (code, params = {}) {\n        let accountId = this.safeString (params, 'account_id');\n        params = this.omit (params, 'account_id');\n        if (accountId === undefined) {\n            await this.loadAccounts ();\n            for (let i = 0; i < this.accounts.length; i++) {\n                const account = this.accounts[i];\n                if (account['code'] === code && account['type'] === 'wallet') {\n                    accountId = account['id'];\n                    break;\n                }\n            }\n        }\n        if (accountId === undefined) {\n            throw new ExchangeError (this.id + ' createDepositAddress could not find the account with matching currency code, specify an `account_id` extra param');\n        }\n        const request = {\n            'account_id': accountId,\n        };\n        const response = await this.privatePostAccountsAccountIdAddresses (this.extend (request, params));\n        //\n        //     {\n        //         \"data\": {\n        //             \"id\": \"05b1ebbf-9438-5dd4-b297-2ddedc98d0e4\",\n        //             \"address\": \"coinbasebase\",\n        //             \"address_info\": {\n        //                 \"address\": \"coinbasebase\",\n        //                 \"destination_tag\": \"287594668\"\n        //             },\n        //             \"name\": null,\n        //             \"created_at\": \"2019-07-01T14:39:29Z\",\n        //             \"updated_at\": \"2019-07-01T14:39:29Z\",\n        //             \"network\": \"eosio\",\n        //             \"uri_scheme\": \"eosio\",\n        //             \"resource\": \"address\",\n        //             \"resource_path\": \"/v2/accounts/14cfc769-e852-52f3-b831-711c104d194c/addresses/05b1ebbf-9438-5dd4-b297-2ddedc98d0e4\",\n        //             \"warnings\": [\n        //                 {\n        //                     \"title\": \"Only send EOS (EOS) to this address\",\n        //                     \"details\": \"Sending any other cryptocurrency will result in permanent loss.\",\n        //                     \"image_url\": \"https://dynamic-assets.coinbase.com/deaca3d47b10ed4a91a872e9618706eec34081127762d88f2476ac8e99ada4b48525a9565cf2206d18c04053f278f693434af4d4629ca084a9d01b7a286a7e26/asset_icons/1f8489bb280fb0a0fd643c1161312ba49655040e9aaaced5f9ad3eeaf868eadc.png\"\n        //                 },\n        //                 {\n        //                     \"title\": \"Both an address and EOS memo are required to receive EOS\",\n        //                     \"details\": \"If you send funds without an EOS memo or with an incorrect EOS memo, your funds cannot be credited to your account.\",\n        //                     \"image_url\": \"https://www.coinbase.com/assets/receive-warning-2f3269d83547a7748fb39d6e0c1c393aee26669bfea6b9f12718094a1abff155.png\"\n        //                 }\n        //             ],\n        //             \"warning_title\": \"Only send EOS (EOS) to this address\",\n        //             \"warning_details\": \"Sending any other cryptocurrency will result in permanent loss.\",\n        //             \"destination_tag\": \"287594668\",\n        //             \"deposit_uri\": \"eosio:coinbasebase?dt=287594668\",\n        //             \"callback_url\": null\n        //         }\n        //     }\n        //\n        const data = this.safeValue (response, 'data', {});\n        const tag = this.safeString (data, 'destination_tag');\n        const address = this.safeString (data, 'address');\n        return {\n            'currency': code,\n            'tag': tag,\n            'address': address,\n            'info': response,\n        };\n    }\n\n    async fetchMySells (symbol = undefined, since = undefined, limit = undefined, params = {}) {\n        // they don't have an endpoint for all historical trades\n        const request = await this.prepareAccountRequest (limit, params);\n        await this.loadMarkets ();\n        const query = this.omit (params, [ 'account_id', 'accountId' ]);\n        const sells = await this.privateGetAccountsAccountIdSells (this.extend (request, query));\n        return this.parseTrades (sells['data'], undefined, since, limit);\n    }\n\n    async fetchMyBuys (symbol = undefined, since = undefined, limit = undefined, params = {}) {\n        // they don't have an endpoint for all historical trades\n        const request = await this.prepareAccountRequest (limit, params);\n        await this.loadMarkets ();\n        const query = this.omit (params, [ 'account_id', 'accountId' ]);\n        const buys = await this.privateGetAccountsAccountIdBuys (this.extend (request, query));\n        return this.parseTrades (buys['data'], undefined, since, limit);\n    }\n\n    async fetchTransactionsWithMethod (method, code = undefined, since = undefined, limit = undefined, params = {}) {\n        const request = await this.prepareAccountRequestWithCurrencyCode (code, limit, params);\n        await this.loadMarkets ();\n        const query = this.omit (params, [ 'account_id', 'accountId' ]);\n        const response = await this[method] (this.extend (request, query));\n        return this.parseTransactions (response['data'], undefined, since, limit);\n    }\n\n    async fetchWithdrawals (code = undefined, since = undefined, limit = undefined, params = {}) {\n        // fiat only, for crypto transactions use fetchLedger\n        return await this.fetchTransactionsWithMethod ('privateGetAccountsAccountIdWithdrawals', code, since, limit, params);\n    }\n\n    async fetchDeposits (code = undefined, since = undefined, limit = undefined, params = {}) {\n        // fiat only, for crypto transactions use fetchLedger\n        return await this.fetchTransactionsWithMethod ('privateGetAccountsAccountIdDeposits', code, since, limit, params);\n    }\n\n    parseTransactionStatus (status) {\n        const statuses = {\n            'created': 'pending',\n            'completed': 'ok',\n            'canceled': 'canceled',\n        };\n        return this.safeString (statuses, status, status);\n    }\n\n    parseTransaction (transaction, market = undefined) {\n        //\n        // fiat deposit\n        //\n        //     {\n        //         \"id\": \"f34c19f3-b730-5e3d-9f72\",\n        //         \"status\": \"completed\",\n        //         \"payment_method\": {\n        //             \"id\": \"a022b31d-f9c7-5043-98f2\",\n        //             \"resource\": \"payment_method\",\n        //             \"resource_path\": \"/v2/payment-methods/a022b31d-f9c7-5043-98f2\"\n        //         },\n        //         \"transaction\": {\n        //             \"id\": \"04ed4113-3732-5b0c-af86-b1d2146977d0\",\n        //             \"resource\": \"transaction\",\n        //             \"resource_path\": \"/v2/accounts/91cd2d36-3a91-55b6-a5d4-0124cf105483/transactions/04ed4113-3732-5b0c-af86\"\n        //         },\n        //         \"user_reference\": \"2VTYTH\",\n        //         \"created_at\": \"2017-02-09T07:01:18Z\",\n        //         \"updated_at\": \"2017-02-09T07:01:26Z\",\n        //         \"resource\": \"deposit\",\n        //         \"resource_path\": \"/v2/accounts/91cd2d36-3a91-55b6-a5d4-0124cf105483/deposits/f34c19f3-b730-5e3d-9f72\",\n        //         \"committed\": true,\n        //         \"payout_at\": \"2017-02-12T07:01:17Z\",\n        //         \"instant\": false,\n        //         \"fee\": { \"amount\": \"0.00\", \"currency\": \"EUR\" },\n        //         \"amount\": { \"amount\": \"114.02\", \"currency\": \"EUR\" },\n        //         \"subtotal\": { \"amount\": \"114.02\", \"currency\": \"EUR\" },\n        //         \"hold_until\": null,\n        //         \"hold_days\": 0,\n        //         \"hold_business_days\": 0,\n        //         \"next_step\": null\n        //     }\n        //\n        // fiat_withdrawal\n        //\n        //     {\n        //         \"id\": \"cfcc3b4a-eeb6-5e8c-8058\",\n        //         \"status\": \"completed\",\n        //         \"payment_method\": {\n        //             \"id\": \"8b94cfa4-f7fd-5a12-a76a\",\n        //             \"resource\": \"payment_method\",\n        //             \"resource_path\": \"/v2/payment-methods/8b94cfa4-f7fd-5a12-a76a\"\n        //         },\n        //         \"transaction\": {\n        //             \"id\": \"fcc2550b-5104-5f83-a444\",\n        //             \"resource\": \"transaction\",\n        //             \"resource_path\": \"/v2/accounts/91cd2d36-3a91-55b6-a5d4-0124cf105483/transactions/fcc2550b-5104-5f83-a444\"\n        //         },\n        //         \"user_reference\": \"MEUGK\",\n        //         \"created_at\": \"2018-07-26T08:55:12Z\",\n        //         \"updated_at\": \"2018-07-26T08:58:18Z\",\n        //         \"resource\": \"withdrawal\",\n        //         \"resource_path\": \"/v2/accounts/91cd2d36-3a91-55b6-a5d4-0124cf105483/withdrawals/cfcc3b4a-eeb6-5e8c-8058\",\n        //         \"committed\": true,\n        //         \"payout_at\": \"2018-07-31T08:55:12Z\",\n        //         \"instant\": false,\n        //         \"fee\": { \"amount\": \"0.15\", \"currency\": \"EUR\" },\n        //         \"amount\": { \"amount\": \"13130.69\", \"currency\": \"EUR\" },\n        //         \"subtotal\": { \"amount\": \"13130.84\", \"currency\": \"EUR\" },\n        //         \"idem\": \"e549dee5-63ed-4e79-8a96\",\n        //         \"next_step\": null\n        //     }\n        //\n        const subtotalObject = this.safeValue (transaction, 'subtotal', {});\n        const feeObject = this.safeValue (transaction, 'fee', {});\n        const id = this.safeString (transaction, 'id');\n        const timestamp = this.parse8601 (this.safeValue (transaction, 'created_at'));\n        const updated = this.parse8601 (this.safeValue (transaction, 'updated_at'));\n        const type = this.safeString (transaction, 'resource');\n        const amount = this.safeNumber (subtotalObject, 'amount');\n        const currencyId = this.safeString (subtotalObject, 'currency');\n        const currency = this.safeCurrencyCode (currencyId);\n        const feeCost = this.safeNumber (feeObject, 'amount');\n        const feeCurrencyId = this.safeString (feeObject, 'currency');\n        const feeCurrency = this.safeCurrencyCode (feeCurrencyId);\n        const fee = {\n            'cost': feeCost,\n            'currency': feeCurrency,\n        };\n        let status = this.parseTransactionStatus (this.safeString (transaction, 'status'));\n        if (status === undefined) {\n            const committed = this.safeValue (transaction, 'committed');\n            status = committed ? 'ok' : 'pending';\n        }\n        return {\n            'info': transaction,\n            'id': id,\n            'txid': id,\n            'timestamp': timestamp,\n            'datetime': this.iso8601 (timestamp),\n            'address': undefined,\n            'tag': undefined,\n            'type': type,\n            'amount': amount,\n            'currency': currency,\n            'status': status,\n            'updated': updated,\n            'fee': fee,\n        };\n    }\n\n    parseTrade (trade, market = undefined) {\n        //\n        //     {\n        //         \"id\": \"67e0eaec-07d7-54c4-a72c-2e92826897df\",\n        //         \"status\": \"completed\",\n        //         \"payment_method\": {\n        //             \"id\": \"83562370-3e5c-51db-87da-752af5ab9559\",\n        //             \"resource\": \"payment_method\",\n        //             \"resource_path\": \"/v2/payment-methods/83562370-3e5c-51db-87da-752af5ab9559\"\n        //         },\n        //         \"transaction\": {\n        //             \"id\": \"441b9494-b3f0-5b98-b9b0-4d82c21c252a\",\n        //             \"resource\": \"transaction\",\n        //             \"resource_path\": \"/v2/accounts/2bbf394c-193b-5b2a-9155-3b4732659ede/transactions/441b9494-b3f0-5b98-b9b0-4d82c21c252a\"\n        //         },\n        //         \"amount\": { \"amount\": \"1.00000000\", \"currency\": \"BTC\" },\n        //         \"total\": { \"amount\": \"10.25\", \"currency\": \"USD\" },\n        //         \"subtotal\": { \"amount\": \"10.10\", \"currency\": \"USD\" },\n        //         \"created_at\": \"2015-01-31T20:49:02Z\",\n        //         \"updated_at\": \"2015-02-11T16:54:02-08:00\",\n        //         \"resource\": \"buy\",\n        //         \"resource_path\": \"/v2/accounts/2bbf394c-193b-5b2a-9155-3b4732659ede/buys/67e0eaec-07d7-54c4-a72c-2e92826897df\",\n        //         \"committed\": true,\n        //         \"instant\": false,\n        //         \"fee\": { \"amount\": \"0.15\", \"currency\": \"USD\" },\n        //         \"payout_at\": \"2015-02-18T16:54:00-08:00\"\n        //     }\n        //\n        let symbol = undefined;\n        const totalObject = this.safeValue (trade, 'total', {});\n        const amountObject = this.safeValue (trade, 'amount', {});\n        const subtotalObject = this.safeValue (trade, 'subtotal', {});\n        const feeObject = this.safeValue (trade, 'fee', {});\n        const id = this.safeString (trade, 'id');\n        const timestamp = this.parse8601 (this.safeValue (trade, 'created_at'));\n        if (market === undefined) {\n            const baseId = this.safeString (amountObject, 'currency');\n            const quoteId = this.safeString (totalObject, 'currency');\n            if ((baseId !== undefined) && (quoteId !== undefined)) {\n                const base = this.safeCurrencyCode (baseId);\n                const quote = this.safeCurrencyCode (quoteId);\n                symbol = base + '/' + quote;\n            }\n        }\n        const orderId = undefined;\n        const side = this.safeString (trade, 'resource');\n        const type = undefined;\n        const costString = this.safeString (subtotalObject, 'amount');\n        const amountString = this.safeString (amountObject, 'amount');\n        const cost = this.parseNumber (costString);\n        const amount = this.parseNumber (amountString);\n        const price = this.parseNumber (Precise.stringDiv (costString, amountString));\n        const feeCost = this.safeNumber (feeObject, 'amount');\n        const feeCurrencyId = this.safeString (feeObject, 'currency');\n        const feeCurrency = this.safeCurrencyCode (feeCurrencyId);\n        const fee = {\n            'cost': feeCost,\n            'currency': feeCurrency,\n        };\n        return {\n            'info': trade,\n            'id': id,\n            'order': orderId,\n            'timestamp': timestamp,\n            'datetime': this.iso8601 (timestamp),\n            'symbol': symbol,\n            'type': type,\n            'side': side,\n            'takerOrMaker': undefined,\n            'price': price,\n            'amount': amount,\n            'cost': cost,\n            'fee': fee,\n        };\n    }\n\n    async fetchMarkets (params = {}) {\n        const response = await this.fetchCurrenciesFromCache (params);\n        const currencies = this.safeValue (response, 'currencies', {});\n        const exchangeRates = this.safeValue (response, 'exchangeRates', {});\n        const data = this.safeValue (currencies, 'data', []);\n        const dataById = this.indexBy (data, 'id');\n        const rates = this.safeValue (this.safeValue (exchangeRates, 'data', {}), 'rates', {});\n        const baseIds = Object.keys (rates);\n        const result = [];\n        for (let i = 0; i < baseIds.length; i++) {\n            const baseId = baseIds[i];\n            const base = this.safeCurrencyCode (baseId);\n            const type = (baseId in dataById) ? 'fiat' : 'crypto';\n            // https://github.com/ccxt/ccxt/issues/6066\n            if (type === 'crypto') {\n                for (let j = 0; j < data.length; j++) {\n                    const quoteCurrency = data[j];\n                    const quoteId = this.safeString (quoteCurrency, 'id');\n                    const quote = this.safeCurrencyCode (quoteId);\n                    const symbol = base + '/' + quote;\n                    const id = baseId + '-' + quoteId;\n                    result.push ({\n                        'id': id,\n                        'symbol': symbol,\n                        'base': base,\n                        'quote': quote,\n                        'baseId': baseId,\n                        'quoteId': quoteId,\n                        'active': undefined,\n                        'info': quoteCurrency,\n                        'precision': {\n                            'amount': undefined,\n                            'price': undefined,\n                        },\n                        'limits': {\n                            'amount': {\n                                'min': undefined,\n                                'max': undefined,\n                            },\n                            'price': {\n                                'min': undefined,\n                                'max': undefined,\n                            },\n                            'cost': {\n                                'min': this.safeNumber (quoteCurrency, 'min_size'),\n                                'max': undefined,\n                            },\n                        },\n                    });\n                }\n            }\n        }\n        return result;\n    }\n\n    async fetchCurrenciesFromCache (params = {}) {\n        const options = this.safeValue (this.options, 'fetchCurrencies', {});\n        const timestamp = this.safeInteger (options, 'timestamp');\n        const expires = this.safeInteger (options, 'expires', 1000);\n        const now = this.milliseconds ();\n        if ((timestamp === undefined) || ((now - timestamp) > expires)) {\n            const currencies = await this.publicGetCurrencies (params);\n            const exchangeRates = await this.publicGetExchangeRates (params);\n            this.options['fetchCurrencies'] = this.extend (options, {\n                'currencies': currencies,\n                'exchangeRates': exchangeRates,\n                'timestamp': now,\n            });\n        }\n        return this.safeValue (this.options, 'fetchCurrencies', {});\n    }\n\n    async fetchCurrencies (params = {}) {\n        const response = await this.fetchCurrenciesFromCache (params);\n        const currencies = this.safeValue (response, 'currencies', {});\n        //\n        //     {\n        //         \"data\":[\n        //             {\"id\":\"AED\",\"name\":\"United Arab Emirates Dirham\",\"min_size\":\"0.01000000\"},\n        //             {\"id\":\"AFN\",\"name\":\"Afghan Afghani\",\"min_size\":\"0.01000000\"},\n        //             {\"id\":\"ALL\",\"name\":\"Albanian Lek\",\"min_size\":\"0.01000000\"},\n        //             {\"id\":\"AMD\",\"name\":\"Armenian Dram\",\"min_size\":\"0.01000000\"},\n        //             {\"id\":\"ANG\",\"name\":\"Netherlands Antillean Gulden\",\"min_size\":\"0.01000000\"},\n        //             // ...\n        //         ],\n        //     }\n        //\n        const exchangeRates = this.safeValue (response, 'exchangeRates', {});\n        //\n        //     {\n        //         \"data\":{\n        //             \"currency\":\"USD\",\n        //             \"rates\":{\n        //                 \"AED\":\"3.67\",\n        //                 \"AFN\":\"78.21\",\n        //                 \"ALL\":\"110.42\",\n        //                 \"AMD\":\"474.18\",\n        //                 \"ANG\":\"1.75\",\n        //                 // ...\n        //             },\n        //         }\n        //     }\n        //\n        const data = this.safeValue (currencies, 'data', []);\n        const dataById = this.indexBy (data, 'id');\n        const rates = this.safeValue (this.safeValue (exchangeRates, 'data', {}), 'rates', {});\n        const keys = Object.keys (rates);\n        const result = {};\n        for (let i = 0; i < keys.length; i++) {\n            const key = keys[i];\n            const type = (key in dataById) ? 'fiat' : 'crypto';\n            const currency = this.safeValue (dataById, key, {});\n            const id = this.safeString (currency, 'id', key);\n            const name = this.safeString (currency, 'name');\n            const code = this.safeCurrencyCode (id);\n            result[code] = {\n                'id': id,\n                'code': code,\n                'info': currency, // the original payload\n                'type': type,\n                'name': name,\n                'active': true,\n                'fee': undefined,\n                'precision': undefined,\n                'limits': {\n                    'amount': {\n                        'min': this.safeNumber (currency, 'min_size'),\n                        'max': undefined,\n                    },\n                    'withdraw': {\n                        'min': undefined,\n                        'max': undefined,\n                    },\n                },\n            };\n        }\n        return result;\n    }\n\n    async fetchTicker (symbol, params = {}) {\n        await this.loadMarkets ();\n        const timestamp = this.seconds ();\n        const market = this.market (symbol);\n        const request = this.extend ({\n            'symbol': market['id'],\n        }, params);\n        const buy = await this.publicGetPricesSymbolBuy (request);\n        const sell = await this.publicGetPricesSymbolSell (request);\n        const spot = await this.publicGetPricesSymbolSpot (request);\n        const ask = this.safeNumber (buy['data'], 'amount');\n        const bid = this.safeNumber (sell['data'], 'amount');\n        const last = this.safeNumber (spot['data'], 'amount');\n        return {\n            'symbol': symbol,\n            'timestamp': timestamp,\n            'datetime': this.iso8601 (timestamp),\n            'bid': bid,\n            'ask': ask,\n            'last': last,\n            'high': undefined,\n            'low': undefined,\n            'bidVolume': undefined,\n            'askVolume': undefined,\n            'vwap': undefined,\n            'open': undefined,\n            'close': last,\n            'previousClose': undefined,\n            'change': undefined,\n            'percentage': undefined,\n            'average': undefined,\n            'baseVolume': undefined,\n            'quoteVolume': undefined,\n            'info': {\n                'buy': buy,\n                'sell': sell,\n                'spot': spot,\n            },\n        };\n    }\n\n    async fetchBalance (params = {}) {\n        await this.loadMarkets ();\n        const request = {\n            'limit': 100,\n        };\n        const response = await this.privateGetAccounts (this.extend (request, params));\n        const balances = this.safeValue (response, 'data');\n        const accounts = this.safeValue (params, 'type', this.options['accounts']);\n        const result = { 'info': response };\n        for (let b = 0; b < balances.length; b++) {\n            const balance = balances[b];\n            const type = this.safeString (balance, 'type');\n            if (this.inArray (type, accounts)) {\n                const value = this.safeValue (balance, 'balance');\n                if (value !== undefined) {\n                    const currencyId = this.safeString (value, 'currency');\n                    const code = this.safeCurrencyCode (currencyId);\n                    const total = this.safeString (value, 'amount');\n                    const free = total;\n                    let account = this.safeValue (result, code);\n                    if (account === undefined) {\n                        account = this.account ();\n                        account['free'] = free;\n                        account['total'] = total;\n                    } else {\n                        account['free'] = Precise.stringAdd (account['free'], total);\n                        account['total'] = Precise.stringAdd (account['total'], total);\n                    }\n                    result[code] = account;\n                }\n            }\n        }\n        return this.parseBalance (result, false);\n    }\n\n    async fetchLedger (code = undefined, since = undefined, limit = undefined, params = {}) {\n        await this.loadMarkets ();\n        let currency = undefined;\n        if (code !== undefined) {\n            currency = this.currency (code);\n        }\n        const request = await this.prepareAccountRequestWithCurrencyCode (code, limit, params);\n        const query = this.omit (params, ['account_id', 'accountId']);\n        // for pagination use parameter 'starting_after'\n        // the value for the next page can be obtained from the result of the previous call in the 'pagination' field\n        // eg: instance.last_json_response.pagination.next_starting_after\n        const response = await this.privateGetAccountsAccountIdTransactions (this.extend (request, query));\n        return this.parseLedger (response['data'], currency, since, limit);\n    }\n\n    parseLedgerEntryStatus (status) {\n        const types = {\n            'completed': 'ok',\n        };\n        return this.safeString (types, status, status);\n    }\n\n    parseLedgerEntryType (type) {\n        const types = {\n            'buy': 'trade',\n            'sell': 'trade',\n            'fiat_deposit': 'transaction',\n            'fiat_withdrawal': 'transaction',\n            'exchange_deposit': 'transaction', // fiat withdrawal (from coinbase to coinbasepro)\n            'exchange_withdrawal': 'transaction', // fiat deposit (to coinbase from coinbasepro)\n            'send': 'transaction', // crypto deposit OR withdrawal\n            'pro_deposit': 'transaction', // crypto withdrawal (from coinbase to coinbasepro)\n            'pro_withdrawal': 'transaction', // crypto deposit (to coinbase from coinbasepro)\n        };\n        return this.safeString (types, type, type);\n    }\n\n    parseLedgerEntry (item, currency = undefined) {\n        //\n        // crypto deposit transaction\n        //\n        //     {\n        //         id: '34e4816b-4c8c-5323-a01c-35a9fa26e490',\n        //         type: 'send',\n        //         status: 'completed',\n        //         amount: { amount: '28.31976528', currency: 'BCH' },\n        //         native_amount: { amount: '2799.65', currency: 'GBP' },\n        //         description: null,\n        //         created_at: '2019-02-28T12:35:20Z',\n        //         updated_at: '2019-02-28T12:43:24Z',\n        //         resource: 'transaction',\n        //         resource_path: '/v2/accounts/c01d7364-edd7-5f3a-bd1d-de53d4cbb25e/transactions/34e4816b-4c8c-5323-a01c-35a9fa26e490',\n        //         instant_exchange: false,\n        //         network: {\n        //             status: 'confirmed',\n        //             hash: '56222d865dae83774fccb2efbd9829cf08c75c94ce135bfe4276f3fb46d49701',\n        //             transaction_url: 'https://bch.btc.com/56222d865dae83774fccb2efbd9829cf08c75c94ce135bfe4276f3fb46d49701'\n        //         },\n        //         from: { resource: 'bitcoin_cash_network', currency: 'BCH' },\n        //         details: { title: 'Received Bitcoin Cash', subtitle: 'From Bitcoin Cash address' }\n        //     }\n        //\n        // crypto withdrawal transaction\n        //\n        //     {\n        //         id: '459aad99-2c41-5698-ac71-b6b81a05196c',\n        //         type: 'send',\n        //         status: 'completed',\n        //         amount: { amount: '-0.36775642', currency: 'BTC' },\n        //         native_amount: { amount: '-1111.65', currency: 'GBP' },\n        //         description: null,\n        //         created_at: '2019-03-20T08:37:07Z',\n        //         updated_at: '2019-03-20T08:49:33Z',\n        //         resource: 'transaction',\n        //         resource_path: '/v2/accounts/c6afbd34-4bd0-501e-8616-4862c193cd84/transactions/459aad99-2c41-5698-ac71-b6b81a05196c',\n        //         instant_exchange: false,\n        //         network: {\n        //             status: 'confirmed',\n        //             hash: '2732bbcf35c69217c47b36dce64933d103895277fe25738ffb9284092701e05b',\n        //             transaction_url: 'https://blockchain.info/tx/2732bbcf35c69217c47b36dce64933d103895277fe25738ffb9284092701e05b',\n        //             transaction_fee: { amount: '0.00000000', currency: 'BTC' },\n        //             transaction_amount: { amount: '0.36775642', currency: 'BTC' },\n        //             confirmations: 15682\n        //         },\n        //         to: {\n        //             resource: 'bitcoin_address',\n        //             address: '1AHnhqbvbYx3rnZx8uC7NbFZaTe4tafFHX',\n        //             currency: 'BTC',\n        //             address_info: { address: '1AHnhqbvbYx3rnZx8uC7NbFZaTe4tafFHX' }\n        //         },\n        //         idem: 'da0a2f14-a2af-4c5a-a37e-d4484caf582bsend',\n        //         application: {\n        //             id: '5756ab6e-836b-553b-8950-5e389451225d',\n        //             resource: 'application',\n        //             resource_path: '/v2/applications/5756ab6e-836b-553b-8950-5e389451225d'\n        //         },\n        //         details: { title: 'Sent Bitcoin', subtitle: 'To Bitcoin address' }\n        //     }\n        //\n        // withdrawal transaction from coinbase to coinbasepro\n        //\n        //     {\n        //         id: '5b1b9fb8-5007-5393-b923-02903b973fdc',\n        //         type: 'pro_deposit',\n        //         status: 'completed',\n        //         amount: { amount: '-0.00001111', currency: 'BCH' },\n        //         native_amount: { amount: '0.00', currency: 'GBP' },\n        //         description: null,\n        //         created_at: '2019-02-28T13:31:58Z',\n        //         updated_at: '2019-02-28T13:31:58Z',\n        //         resource: 'transaction',\n        //         resource_path: '/v2/accounts/c01d7364-edd7-5f3a-bd1d-de53d4cbb25e/transactions/5b1b9fb8-5007-5393-b923-02903b973fdc',\n        //         instant_exchange: false,\n        //         application: {\n        //             id: '5756ab6e-836b-553b-8950-5e389451225d',\n        //             resource: 'application',\n        //             resource_path: '/v2/applications/5756ab6e-836b-553b-8950-5e389451225d'\n        //         },\n        //         details: { title: 'Transferred Bitcoin Cash', subtitle: 'To Coinbase Pro' }\n        //     }\n        //\n        // withdrawal transaction from coinbase to gdax\n        //\n        //     {\n        //         id: 'badb7313-a9d3-5c07-abd0-00f8b44199b1',\n        //         type: 'exchange_deposit',\n        //         status: 'completed',\n        //         amount: { amount: '-0.43704149', currency: 'BCH' },\n        //         native_amount: { amount: '-51.90', currency: 'GBP' },\n        //         description: null,\n        //         created_at: '2019-03-19T10:30:40Z',\n        //         updated_at: '2019-03-19T10:30:40Z',\n        //         resource: 'transaction',\n        //         resource_path: '/v2/accounts/c01d7364-edd7-5f3a-bd1d-de53d4cbb25e/transactions/badb7313-a9d3-5c07-abd0-00f8b44199b1',\n        //         instant_exchange: false,\n        //         details: { title: 'Transferred Bitcoin Cash', subtitle: 'To GDAX' }\n        //     }\n        //\n        // deposit transaction from gdax to coinbase\n        //\n        //     {\n        //         id: '9c4b642c-8688-58bf-8962-13cef64097de',\n        //         type: 'exchange_withdrawal',\n        //         status: 'completed',\n        //         amount: { amount: '0.57729420', currency: 'BTC' },\n        //         native_amount: { amount: '4418.72', currency: 'GBP' },\n        //         description: null,\n        //         created_at: '2018-02-17T11:33:33Z',\n        //         updated_at: '2018-02-17T11:33:33Z',\n        //         resource: 'transaction',\n        //         resource_path: '/v2/accounts/c6afbd34-4bd0-501e-8616-4862c193cd84/transactions/9c4b642c-8688-58bf-8962-13cef64097de',\n        //         instant_exchange: false,\n        //         details: { title: 'Transferred Bitcoin', subtitle: 'From GDAX' }\n        //     }\n        //\n        // deposit transaction from coinbasepro to coinbase\n        //\n        //     {\n        //         id: '8d6dd0b9-3416-568a-889d-8f112fae9e81',\n        //         type: 'pro_withdrawal',\n        //         status: 'completed',\n        //         amount: { amount: '0.40555386', currency: 'BTC' },\n        //         native_amount: { amount: '1140.27', currency: 'GBP' },\n        //         description: null,\n        //         created_at: '2019-03-04T19:41:58Z',\n        //         updated_at: '2019-03-04T19:41:58Z',\n        //         resource: 'transaction',\n        //         resource_path: '/v2/accounts/c6afbd34-4bd0-501e-8616-4862c193cd84/transactions/8d6dd0b9-3416-568a-889d-8f112fae9e81',\n        //         instant_exchange: false,\n        //         application: {\n        //             id: '5756ab6e-836b-553b-8950-5e389451225d',\n        //             resource: 'application',\n        //             resource_path: '/v2/applications/5756ab6e-836b-553b-8950-5e389451225d'\n        //         },\n        //         details: { title: 'Transferred Bitcoin', subtitle: 'From Coinbase Pro' }\n        //     }\n        //\n        // sell trade\n        //\n        //     {\n        //         id: 'a9409207-df64-585b-97ab-a50780d2149e',\n        //         type: 'sell',\n        //         status: 'completed',\n        //         amount: { amount: '-9.09922880', currency: 'BTC' },\n        //         native_amount: { amount: '-7285.73', currency: 'GBP' },\n        //         description: null,\n        //         created_at: '2017-03-27T15:38:34Z',\n        //         updated_at: '2017-03-27T15:38:34Z',\n        //         resource: 'transaction',\n        //         resource_path: '/v2/accounts/c6afbd34-4bd0-501e-8616-4862c193cd84/transactions/a9409207-df64-585b-97ab-a50780d2149e',\n        //         instant_exchange: false,\n        //         sell: {\n        //             id: 'e3550b4d-8ae6-5de3-95fe-1fb01ba83051',\n        //             resource: 'sell',\n        //             resource_path: '/v2/accounts/c6afbd34-4bd0-501e-8616-4862c193cd84/sells/e3550b4d-8ae6-5de3-95fe-1fb01ba83051'\n        //         },\n        //         details: {\n        //             title: 'Sold Bitcoin',\n        //             subtitle: 'Using EUR Wallet',\n        //             payment_method_name: 'EUR Wallet'\n        //         }\n        //     }\n        //\n        // buy trade\n        //\n        //     {\n        //         id: '63eeed67-9396-5912-86e9-73c4f10fe147',\n        //         type: 'buy',\n        //         status: 'completed',\n        //         amount: { amount: '2.39605772', currency: 'ETH' },\n        //         native_amount: { amount: '98.31', currency: 'GBP' },\n        //         description: null,\n        //         created_at: '2017-03-27T09:07:56Z',\n        //         updated_at: '2017-03-27T09:07:57Z',\n        //         resource: 'transaction',\n        //         resource_path: '/v2/accounts/8902f85d-4a69-5d74-82fe-8e390201bda7/transactions/63eeed67-9396-5912-86e9-73c4f10fe147',\n        //         instant_exchange: false,\n        //         buy: {\n        //             id: '20b25b36-76c6-5353-aa57-b06a29a39d82',\n        //             resource: 'buy',\n        //             resource_path: '/v2/accounts/8902f85d-4a69-5d74-82fe-8e390201bda7/buys/20b25b36-76c6-5353-aa57-b06a29a39d82'\n        //         },\n        //         details: {\n        //             title: 'Bought Ethereum',\n        //             subtitle: 'Using EUR Wallet',\n        //             payment_method_name: 'EUR Wallet'\n        //         }\n        //     }\n        //\n        // fiat deposit transaction\n        //\n        //     {\n        //         id: '04ed4113-3732-5b0c-af86-b1d2146977d0',\n        //         type: 'fiat_deposit',\n        //         status: 'completed',\n        //         amount: { amount: '114.02', currency: 'EUR' },\n        //         native_amount: { amount: '97.23', currency: 'GBP' },\n        //         description: null,\n        //         created_at: '2017-02-09T07:01:21Z',\n        //         updated_at: '2017-02-09T07:01:22Z',\n        //         resource: 'transaction',\n        //         resource_path: '/v2/accounts/91cd2d36-3a91-55b6-a5d4-0124cf105483/transactions/04ed4113-3732-5b0c-af86-b1d2146977d0',\n        //         instant_exchange: false,\n        //         fiat_deposit: {\n        //             id: 'f34c19f3-b730-5e3d-9f72-96520448677a',\n        //             resource: 'fiat_deposit',\n        //             resource_path: '/v2/accounts/91cd2d36-3a91-55b6-a5d4-0124cf105483/deposits/f34c19f3-b730-5e3d-9f72-96520448677a'\n        //         },\n        //         details: {\n        //             title: 'Deposited funds',\n        //             subtitle: 'From SEPA Transfer (GB47 BARC 20..., reference CBADVI)',\n        //             payment_method_name: 'SEPA Transfer (GB47 BARC 20..., reference CBADVI)'\n        //         }\n        //     }\n        //\n        // fiat withdrawal transaction\n        //\n        //     {\n        //         id: '957d98e2-f80e-5e2f-a28e-02945aa93079',\n        //         type: 'fiat_withdrawal',\n        //         status: 'completed',\n        //         amount: { amount: '-11000.00', currency: 'EUR' },\n        //         native_amount: { amount: '-9698.22', currency: 'GBP' },\n        //         description: null,\n        //         created_at: '2017-12-06T13:19:19Z',\n        //         updated_at: '2017-12-06T13:19:19Z',\n        //         resource: 'transaction',\n        //         resource_path: '/v2/accounts/91cd2d36-3a91-55b6-a5d4-0124cf105483/transactions/957d98e2-f80e-5e2f-a28e-02945aa93079',\n        //         instant_exchange: false,\n        //         fiat_withdrawal: {\n        //             id: 'f4bf1fd9-ab3b-5de7-906d-ed3e23f7a4e7',\n        //             resource: 'fiat_withdrawal',\n        //             resource_path: '/v2/accounts/91cd2d36-3a91-55b6-a5d4-0124cf105483/withdrawals/f4bf1fd9-ab3b-5de7-906d-ed3e23f7a4e7'\n        //         },\n        //         details: {\n        //             title: 'Withdrew funds',\n        //             subtitle: 'To HSBC BANK PLC (GB74 MIDL...)',\n        //             payment_method_name: 'HSBC BANK PLC (GB74 MIDL...)'\n        //         }\n        //     }\n        //\n        const amountInfo = this.safeValue (item, 'amount', {});\n        let amount = this.safeNumber (amountInfo, 'amount');\n        let direction = undefined;\n        if (amount < 0) {\n            direction = 'out';\n            amount = -amount;\n        } else {\n            direction = 'in';\n        }\n        const currencyId = this.safeString (amountInfo, 'currency');\n        const code = this.safeCurrencyCode (currencyId, currency);\n        //\n        // the address and txid do not belong to the unified ledger structure\n        //\n        //     let address = undefined;\n        //     if (item['to']) {\n        //         address = this.safeString (item['to'], 'address');\n        //     }\n        //     let txid = undefined;\n        //\n        let fee = undefined;\n        const networkInfo = this.safeValue (item, 'network', {});\n        // txid = network['hash']; // txid does not belong to the unified ledger structure\n        const feeInfo = this.safeValue (networkInfo, 'transaction_fee');\n        if (feeInfo !== undefined) {\n            const feeCurrencyId = this.safeString (feeInfo, 'currency');\n            const feeCurrencyCode = this.safeCurrencyCode (feeCurrencyId, currency);\n            const feeAmount = this.safeNumber (feeInfo, 'amount');\n            fee = {\n                'cost': feeAmount,\n                'currency': feeCurrencyCode,\n            };\n        }\n        const timestamp = this.parse8601 (this.safeValue (item, 'created_at'));\n        const id = this.safeString (item, 'id');\n        const type = this.parseLedgerEntryType (this.safeString (item, 'type'));\n        const status = this.parseLedgerEntryStatus (this.safeString (item, 'status'));\n        const path = this.safeString (item, 'resource_path');\n        let accountId = undefined;\n        if (path !== undefined) {\n            const parts = path.split ('/');\n            const numParts = parts.length;\n            if (numParts > 3) {\n                accountId = parts[3];\n            }\n        }\n        return {\n            'info': item,\n            'id': id,\n            'timestamp': timestamp,\n            'datetime': this.iso8601 (timestamp),\n            'direction': direction,\n            'account': accountId,\n            'referenceId': undefined,\n            'referenceAccount': undefined,\n            'type': type,\n            'currency': code,\n            'amount': amount,\n            'before': undefined,\n            'after': undefined,\n            'status': status,\n            'fee': fee,\n        };\n    }\n\n    async findAccountId (code) {\n        await this.loadMarkets ();\n        await this.loadAccounts ();\n        for (let i = 0; i < this.accounts.length; i++) {\n            const account = this.accounts[i];\n            if (account['code'] === code) {\n                return account['id'];\n            }\n        }\n        return undefined;\n    }\n\n    prepareAccountRequest (limit = undefined, params = {}) {\n        const accountId = this.safeString2 (params, 'account_id', 'accountId');\n        if (accountId === undefined) {\n            throw new ArgumentsRequired (this.id + ' method requires an account_id (or accountId) parameter');\n        }\n        const request = {\n            'account_id': accountId,\n        };\n        if (limit !== undefined) {\n            request['limit'] = limit;\n        }\n        return request;\n    }\n\n    async prepareAccountRequestWithCurrencyCode (code = undefined, limit = undefined, params = {}) {\n        let accountId = this.safeString2 (params, 'account_id', 'accountId');\n        if (accountId === undefined) {\n            if (code === undefined) {\n                throw new ArgumentsRequired (this.id + ' method requires an account_id (or accountId) parameter OR a currency code argument');\n            }\n            accountId = await this.findAccountId (code);\n            if (accountId === undefined) {\n                throw new ExchangeError (this.id + ' could not find account id for ' + code);\n            }\n        }\n        const request = {\n            'account_id': accountId,\n        };\n        if (limit !== undefined) {\n            request['limit'] = limit;\n        }\n        return request;\n    }\n\n    sign (path, api = 'public', method = 'GET', params = {}, headers = undefined, body = undefined) {\n        let fullPath = '/' + this.version + '/' + this.implodeParams (path, params);\n        const query = this.omit (params, this.extractParams (path));\n        if (method === 'GET') {\n            if (Object.keys (query).length) {\n                fullPath += '?' + this.urlencode (query);\n            }\n        }\n        const url = this.urls['api'] + fullPath;\n        if (api === 'private') {\n            this.checkRequiredCredentials ();\n            const nonce = this.nonce ().toString ();\n            let payload = '';\n            if (method !== 'GET') {\n                if (Object.keys (query).length) {\n                    body = this.json (query);\n                    payload = body;\n                }\n            }\n            const auth = nonce + method + fullPath + payload;\n            const signature = this.hmac (this.encode (auth), this.encode (this.secret));\n            headers = {\n                'CB-ACCESS-KEY': this.apiKey,\n                'CB-ACCESS-SIGN': signature,\n                'CB-ACCESS-TIMESTAMP': nonce,\n                'Content-Type': 'application/json',\n            };\n        }\n        return { 'url': url, 'method': method, 'body': body, 'headers': headers };\n    }\n\n    handleErrors (code, reason, url, method, headers, body, response, requestHeaders, requestBody) {\n        if (response === undefined) {\n            return; // fallback to default error handler\n        }\n        const feedback = this.id + ' ' + body;\n        //\n        //    {\"error\": \"invalid_request\", \"error_description\": \"The request is missing a required parameter, includes an unsupported parameter value, or is otherwise malformed.\"}\n        //\n        // or\n        //\n        //    {\n        //      \"errors\": [\n        //        {\n        //          \"id\": \"not_found\",\n        //          \"message\": \"Not found\"\n        //        }\n        //      ]\n        //    }\n        //\n        let errorCode = this.safeString (response, 'error');\n        if (errorCode !== undefined) {\n            const errorMessage = this.safeString (response, 'error_description');\n            this.throwExactlyMatchedException (this.exceptions['exact'], errorCode, feedback);\n            this.throwBroadlyMatchedException (this.exceptions['broad'], errorMessage, feedback);\n            throw new ExchangeError (feedback);\n        }\n        const errors = this.safeValue (response, 'errors');\n        if (errors !== undefined) {\n            if (Array.isArray (errors)) {\n                const numErrors = errors.length;\n                if (numErrors > 0) {\n                    errorCode = this.safeString (errors[0], 'id');\n                    const errorMessage = this.safeString (errors[0], 'message');\n                    if (errorCode !== undefined) {\n                        this.throwExactlyMatchedException (this.exceptions['exact'], errorCode, feedback);\n                        this.throwBroadlyMatchedException (this.exceptions['broad'], errorMessage, feedback);\n                        throw new ExchangeError (feedback);\n                    }\n                }\n            }\n        }\n        const data = this.safeValue (response, 'data');\n        if (data === undefined) {\n            throw new ExchangeError (this.id + ' failed due to a malformed response ' + this.json (response));\n        }\n    }\n};\n\n"]},"metadata":{},"sourceType":"script"}